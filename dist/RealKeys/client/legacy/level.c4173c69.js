import{b as e}from"./notes.be99bc8d.js";const t=new Map([["Semitone",1],["Tone",2],["Minor3rd",3],["Major3rd",4],["Perfect4th",5],["Augmented4th",6],["Perfect5th",7],["Minor6th",8],["Major6th",9],["Minor7th",10],["Major7th",11]]);class n{constructor(e,n){this.name=e,this.intervals=n.map(e=>{if(!t.has(e))throw new Error(`Interval name ${e} invalid`);return t.get(e)})}}class o{constructor(e,t){if(!s.has(t))throw new Error("There's no scale called "+t);let n=[e];s.get(t).intervals.forEach(e=>{let t=n[n.length-1];n.push(t.jump(e))}),this.notes=n}}function i(e,t){for(;t>0;)e.push(e.shift(0)),t--;return e}const s=new Map([["Lydian",new n("Lydian",i(["Tone","Tone","Semitone","Tone","Tone","Tone","Semitone"],3).slice(0,-1))],["Major",new n("Major",["Tone","Tone","Semitone","Tone","Tone","Tone","Semitone"].slice(0,-1))],["Mixolydian",new n("Mixolydian",i(["Tone","Tone","Semitone","Tone","Tone","Tone","Semitone"],4).slice(0,-1))],["Dorian",new n("Dorian",i(["Tone","Tone","Semitone","Tone","Tone","Tone","Semitone"],1).slice(0,-1))],["Minor",new n("Minor",i(["Tone","Tone","Semitone","Tone","Tone","Tone","Semitone"],5).slice(0,-1))],["Phrygian",new n("Phrygian",i(["Tone","Tone","Semitone","Tone","Tone","Tone","Semitone"],2).slice(0,-1))],["Locrian",new n("Locrian",i(["Tone","Tone","Semitone","Tone","Tone","Tone","Semitone"],6).slice(0,-1))],["Whole Tone",new n("Whole",new Array(5).fill("Tone"))],["Diminished",new n("Diminished",new Array(8).fill("").map((e,t)=>t%2==0?"Semitone":"Tone").slice(0,-1))],["Chromatic",new n("Chromatic",new Array(11).fill("Semitone"))]]);function r(){return Array.from(s.keys())}const h="historyKey";class a{constructor(t,n,i,s,r){this.key=t,this.tonality=n,this.phraseLength=i,this.notePoolSize=s,this.maxInterval=r,this.scale=new o(e(t,4),n);let h=function(e,t){let n=new Array,o=0;for(;o<t;){let t=o%e.length,i=Math.floor(o/e.length);n.push(e[t].jump(12*i)),o++}return n}(this.scale.notes,s);this.notes=h}newPhrase(){let e=[this.notes[0]],t=this.maxInterval,n=this.phraseLength-1;for(;n>0;){let o=e[e.length-1],i=this.notes.lastIndexOf(o);if(-1===i)throw new Error("Couldn't find previous note "+o.string());let s=this.notes.filter((e,n)=>i-t<n&&n<i+t),r=s[Math.floor(Math.random()*s.length)];e.push(r),n--}return e}playURL(){return"play?key="+this.key+"&tonality="+this.tonality+"&phraseLength="+this.phraseLength+"&notePoolSize="+this.notePoolSize+"&maxInterval="+this.maxInterval}longerPhrases(){return new a(this.key,this.tonality,this.phraseLength+1,this.notePoolSize,this.maxInterval)}shorterPhrases(){return new a(this.key,this.tonality,this.phraseLength-1,this.notePoolSize,this.maxInterval)}moreNotes(){return new a(this.key,this.tonality,this.phraseLength,this.notePoolSize+1,this.maxInterval)}fewerNotes(){return new a(this.key,this.tonality,this.phraseLength,this.notePoolSize-1,this.maxInterval)}longerIntervals(){return new a(this.key,this.tonality,this.phraseLength,this.notePoolSize,this.maxInterval+1)}shorterIntervals(){return new a(this.key,this.tonality,this.phraseLength+1,this.notePoolSize,this.maxInterval-1)}succeed(){let e=localStorage.getItem("historyKey");if(e){let t=JSON.parse(e);t.levels.push(this.definition()),localStorage.setItem("historyKey",JSON.stringify(t))}else localStorage.setItem("historyKey",JSON.stringify({levels:[this.definition()]}))}definition(){return{key:this.key,tonality:this.tonality,phraseLength:this.phraseLength,notePoolSize:this.notePoolSize,maxInterval:this.maxInterval,time:new Date}}}function l(e){return new a(e.key,e.tonality,parseInt(e.phraseLength),parseInt(e.notePoolSize),parseInt(e.maxInterval))}export{r as a,l as b,h,a as l};
