import{S as t,i as e,s as n,U as s,h as r,L as a,w as l,K as i,v as o,g as h,I as c,k as u,l as f,q as d,y as m,e as p,c as g,b as v,m as $,n as w,x as E,a as b,f as I,j as y,R as N,t as x,d as k,p as D,r as V,G as P,z as L,B as M,O as z,u as B,Q as S,M as j,A,W as C,X as R,E as H,C as q,H as F,Y as U}from"./client.5ee8e5bf.js";import{R as T,f as O}from"./ReccomendedButton.654cf851.js";import{O as W}from"./OptionButton.97516143.js";import{C as _,P as Z,s as G,n as K}from"./instrument.c8f15cd3.js";import{c as Q}from"./_commonjsHelpers.521bc219.js";import{n as X,l as Y,h as J}from"./notes.be99bc8d.js";import{b as tt}from"./level.c4173c69.js";import{g as et}from"./storage.4617e2a9.js";import"./webmidi.min.0a3878e3.js";function nt(t){let e,n;return e=new W({props:{text:t[0]}}),e.$on("click",t[2]),{c(){u(e.$$.fragment)},l(t){f(e.$$.fragment,t)},m(t,s){d(e,t,s),n=!0},p(t,n){const s={};1&n&&(s.text=t[0]),e.$set(s)},i(t){n||(o(e.$$.fragment,t),n=!0)},o(t){l(e.$$.fragment,t),n=!1},d(t){m(e,t)}}}function st(t){let e,n;return e=new T({props:{text:t[0],defaultAction:!0}}),e.$on("click",t[2]),{c(){u(e.$$.fragment)},l(t){f(e.$$.fragment,t)},m(t,s){d(e,t,s),n=!0},p(t,n){const s={};1&n&&(s.text=t[0]),e.$set(s)},i(t){n||(o(e.$$.fragment,t),n=!0)},o(t){l(e.$$.fragment,t),n=!1},d(t){m(e,t)}}}function rt(t){let e,n,c,u;const f=[st,nt],d=[];function m(t,e){return t[1]?0:1}return e=m(t),n=d[e]=f[e](t),{c(){n.c(),c=s()},l(t){n.l(t),c=s()},m(t,n){d[e].m(t,n),r(t,c,n),u=!0},p(t,[s]){let r=e;e=m(t),e===r?d[e].p(t,s):(a(),l(d[r],1,1,()=>{d[r]=null}),i(),n=d[e],n?n.p(t,s):(n=d[e]=f[e](t),n.c()),o(n,1),n.m(c.parentNode,c))},i(t){u||(o(n),u=!0)},o(t){l(n),u=!1},d(t){d[e].d(t),t&&h(c)}}}function at(t,e,n){let{text:s}=e,{reccomended:r=!1}=e,a=c();return t.$$set=t=>{"text"in t&&n(0,s=t.text),"reccomended"in t&&n(1,r=t.reccomended)},[s,r,function(t){a(t.type,t.detail)}]}class lt extends t{constructor(t){super(),e(this,t,at,rt,n,{text:0,reccomended:1})}}function it(t,e,n){const s=t.slice();return s[1]=e[n],s[3]=n,s}function ot(t){let e;return{c(){e=p("div"),this.h()},l(t){e=g(t,"DIV",{class:!0}),v(e).forEach(h),this.h()},h(){$(e,"class","white svelte-17fd0lp")},m(t,n){r(t,e,n)},d(t){t&&h(e)}}}function ht(t){let e,n,s,a,l;return{c(){e=p("div"),n=p("div"),s=b(),a=p("div"),l=b(),this.h()},l(t){e=g(t,"DIV",{class:!0});var r=v(e);n=g(r,"DIV",{class:!0}),v(n).forEach(h),s=I(r),a=g(r,"DIV",{class:!0}),v(a).forEach(h),l=I(r),r.forEach(h),this.h()},h(){$(n,"class","separator svelte-17fd0lp"),$(a,"class","white svelte-17fd0lp"),$(e,"class","sepholder svelte-17fd0lp")},m(t,i){r(t,e,i),y(e,n),y(e,s),y(e,a),y(e,l)},d(t){t&&h(e)}}}function ct(t){let e;return{c(){e=p("div"),this.h()},l(t){e=g(t,"DIV",{class:!0}),v(e).forEach(h),this.h()},h(){$(e,"class","black svelte-17fd0lp")},m(t,n){r(t,e,n)},d(t){t&&h(e)}}}function ut(t){let e,n,a;function l(t,s){return(null==e||1&s)&&(e=!!t[1].getAbstract().accidental),e?ct:((null==n||1&s)&&(n=!(!(t[3]>0)||t[0][t[3]-1].getAbstract().accidental)),n?ht:ot)}let i=l(t,-1),o=i(t);return{c(){o.c(),a=s()},l(t){o.l(t),a=s()},m(t,e){o.m(t,e),r(t,a,e)},p(t,e){i!==(i=l(t,e))&&(o.d(1),o=i(t),o&&(o.c(),o.m(a.parentNode,a)))},d(t){o.d(t),t&&h(a)}}}function ft(t){let e,n=t[0],s=[];for(let e=0;e<n.length;e+=1)s[e]=ut(it(t,n,e));return{c(){e=p("div");for(let t=0;t<s.length;t+=1)s[t].c();this.h()},l(t){e=g(t,"DIV",{class:!0});var n=v(e);for(let t=0;t<s.length;t+=1)s[t].l(n);n.forEach(h),this.h()},h(){$(e,"class","holder svelte-17fd0lp")},m(t,n){r(t,e,n);for(let t=0;t<s.length;t+=1)s[t].m(e,null)},p(t,[r]){if(1&r){let a;for(n=t[0],a=0;a<n.length;a+=1){const l=it(t,n,a);s[a]?s[a].p(l,r):(s[a]=ut(l),s[a].c(),s[a].m(e,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=n.length}},i:w,o:w,d(t){t&&h(e),E(s,t)}}}function dt(t,e,n){let{keys:s}=e;return t.$$set=t=>{"keys"in t&&n(0,s=t.keys)},[s]}Q((function(t,e){
/**
 * @license Fraction.js v4.0.12 09/09/2015
 * http://www.xarg.org/2014/03/rational-numbers-in-javascript/
 *
 * Copyright (c) 2015, Robert Eisele (robert@xarg.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/
!function(e){var n={s:1,n:0,d:1};function s(t){function e(){var e=Error.apply(this,arguments);e.name=this.name=t,this.stack=e.stack,this.message=e.message}function n(){}return n.prototype=Error.prototype,e.prototype=new n,e}var r=c.DivisionByZero=s("DivisionByZero"),a=c.InvalidParameter=s("InvalidParameter");function l(t,e){return isNaN(t=parseInt(t,10))&&i(),t*e}function i(){throw new a}var o=function(t,e){var s,a=0,o=1,h=1,c=0,u=0,f=0,d=1,m=1,p=0,g=1,v=1,$=1,w=1e7;if(null==t);else if(void 0!==e)h=(a=t)*(o=e);else switch(typeof t){case"object":"d"in t&&"n"in t?(a=t.n,o=t.d,"s"in t&&(a*=t.s)):0 in t?(a=t[0],1 in t&&(o=t[1])):i(),h=a*o;break;case"number":if(t<0&&(h=t,t=-t),t%1==0)a=t;else if(t>0){for(t>=1&&(t/=m=Math.pow(10,Math.floor(1+Math.log(t)/Math.LN10)));g<=w&&$<=w;){if(t===(s=(p+v)/(g+$))){g+$<=w?(a=p+v,o=g+$):$>g?(a=v,o=$):(a=p,o=g);break}t>s?(p+=v,g+=$):(v+=p,$+=g),g>w?(a=v,o=$):(a=p,o=g)}a*=m}else(isNaN(t)||isNaN(e))&&(o=a=NaN);break;case"string":if(null===(g=t.match(/\d+|./g))&&i(),"-"===g[p]?(h=-1,p++):"+"===g[p]&&p++,g.length===p+1?u=l(g[p++],h):"."===g[p+1]||"."===g[p]?("."!==g[p]&&(c=l(g[p++],h)),(++p+1===g.length||"("===g[p+1]&&")"===g[p+3]||"'"===g[p+1]&&"'"===g[p+3])&&(u=l(g[p],h),d=Math.pow(10,g[p].length),p++),("("===g[p]&&")"===g[p+2]||"'"===g[p]&&"'"===g[p+2])&&(f=l(g[p+1],h),m=Math.pow(10,g[p+1].length)-1,p+=3)):"/"===g[p+1]||":"===g[p+1]?(u=l(g[p],h),d=l(g[p+2],1),p+=3):"/"===g[p+3]&&" "===g[p+1]&&(c=l(g[p],h),u=l(g[p+2],h),d=l(g[p+4],1),p+=5),g.length<=p){h=a=f+(o=d*m)*c+m*u;break}default:i()}if(0===o)throw new r;n.s=h<0?-1:1,n.n=Math.abs(a),n.d=Math.abs(o)};function h(t,e){if(!t)return e;if(!e)return t;for(;;){if(!(t%=e))return e;if(!(e%=t))return t}}function c(t,e){if(!(this instanceof c))return new c(t,e);o(t,e),t=c.REDUCE?h(n.d,n.n):1,this.s=n.s,this.n=n.n/t,this.d=n.d/t}c.REDUCE=1,c.prototype={s:1,n:0,d:1,abs:function(){return new c(this.n,this.d)},neg:function(){return new c(-this.s*this.n,this.d)},add:function(t,e){return o(t,e),new c(this.s*this.n*n.d+n.s*this.d*n.n,this.d*n.d)},sub:function(t,e){return o(t,e),new c(this.s*this.n*n.d-n.s*this.d*n.n,this.d*n.d)},mul:function(t,e){return o(t,e),new c(this.s*n.s*this.n*n.n,this.d*n.d)},div:function(t,e){return o(t,e),new c(this.s*n.s*this.n*n.d,this.d*n.n)},clone:function(){return new c(this)},mod:function(t,e){return isNaN(this.n)||isNaN(this.d)?new c(NaN):void 0===t?new c(this.s*this.n%this.d,1):(o(t,e),0===n.n&&0===this.d&&c(0,0),new c(this.s*(n.d*this.n)%(n.n*this.d),n.d*this.d))},gcd:function(t,e){return o(t,e),new c(h(n.n,this.n)*h(n.d,this.d),n.d*this.d)},lcm:function(t,e){return o(t,e),0===n.n&&0===this.n?new c:new c(n.n*this.n,h(n.n,this.n)*h(n.d,this.d))},ceil:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new c(NaN):new c(Math.ceil(t*this.s*this.n/this.d),t)},floor:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new c(NaN):new c(Math.floor(t*this.s*this.n/this.d),t)},round:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new c(NaN):new c(Math.round(t*this.s*this.n/this.d),t)},inverse:function(){return new c(this.s*this.d,this.n)},pow:function(t){return t<0?new c(Math.pow(this.s*this.d,-t),Math.pow(this.n,-t)):new c(Math.pow(this.s*this.n,t),Math.pow(this.d,t))},equals:function(t,e){return o(t,e),this.s*this.n*n.d==n.s*n.n*this.d},compare:function(t,e){o(t,e);var s=this.s*this.n*n.d-n.s*n.n*this.d;return(0<s)-(s<0)},simplify:function(t){if(isNaN(this.n)||isNaN(this.d))return this;var e=this.abs().toContinued();function n(t){return 1===t.length?new c(t[0]):n(t.slice(1)).inverse().add(t[0])}t=t||.001;for(var s=0;s<e.length;s++){var r=n(e.slice(0,s+1));if(r.sub(this.abs()).abs().valueOf()<t)return r.mul(this.s)}return this},divisible:function(t,e){return o(t,e),!(!(n.n*this.d)||this.n*n.d%(n.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(t){var e,n="",s=this.n,r=this.d;return this.s<0&&(n+="-"),1===r?n+=s:(t&&(e=Math.floor(s/r))>0&&(n+=e,n+=" ",s%=r),n+=s,n+="/",n+=r),n},toLatex:function(t){var e,n="",s=this.n,r=this.d;return this.s<0&&(n+="-"),1===r?n+=s:(t&&(e=Math.floor(s/r))>0&&(n+=e,s%=r),n+="\\frac{",n+=s,n+="}{",n+=r,n+="}"),n},toContinued:function(){var t,e=this.n,n=this.d,s=[];if(isNaN(e)||isNaN(n))return s;do{s.push(Math.floor(e/n)),t=e%n,e=n,n=t}while(1!==e);return s},toString:function(t){var e,n=this.n,s=this.d;if(isNaN(n)||isNaN(s))return"NaN";c.REDUCE||(n/=e=h(n,s),s/=e),t=t||15;var r=function(t,e){for(;e%2==0;e/=2);for(;e%5==0;e/=5);if(1===e)return 0;for(var n=10%e,s=1;1!==n;s++)if(n=10*n%e,s>2e3)return 0;return s}(0,s),a=function(t,e,n){for(var s=1,r=function(t,e,n){for(var s=1;e>0;t=t*t%n,e>>=1)1&e&&(s=s*t%n);return s}(10,n,e),a=0;a<300;a++){if(s===r)return a;s=10*s%e,r=10*r%e}return 0}(0,s,r),l=-1===this.s?"-":"";if(l+=n/s|0,n%=s,(n*=10)&&(l+="."),r){for(var i=a;i--;)l+=n/s|0,n%=s,n*=10;l+="(";for(i=r;i--;)l+=n/s|0,n%=s,n*=10;l+=")"}else for(i=t;n&&i--;)l+=n/s|0,n%=s,n*=10;return l}},Object.defineProperty(c,"__esModule",{value:!0}),c.default=c,c.Fraction=c,t.exports=c}()}));class mt extends t{constructor(t){super(),e(this,t,dt,ft,n,{keys:0})}}function pt(t,e,n){const s=t.slice();return s[14]=e[n],s}function gt(t,e,n){const s=t.slice();return s[17]=e[n],s[19]=n,s}function vt(t,e,n){const s=t.slice();return s[20]=e[n],s}function $t(t){let e;return{c(){e=p("div"),this.h()},l(t){e=g(t,"DIV",{class:!0,style:!0}),v(e).forEach(h),this.h()},h(){$(e,"class","note svelte-1ew6a7t"),N(e,"--top",100*t[20].start/t[1]+"%"),N(e,"--height",100*(t[20].end-t[20].start)/t[1]+"%"),N(e,"--color",t[4].hex(t[19]))},m(t,n){r(t,e,n)},p(t,n){34&n&&N(e,"--top",100*t[20].start/t[1]+"%"),34&n&&N(e,"--height",100*(t[20].end-t[20].start)/t[1]+"%"),16&n&&N(e,"--color",t[4].hex(t[19]))},d(t){t&&h(e)}}}function wt(t){let e,n=t[20].note.equals(t[14]),a=n&&$t(t);return{c(){a&&a.c(),e=s()},l(t){a&&a.l(t),e=s()},m(t,n){a&&a.m(t,n),r(t,e,n)},p(t,s){40&s&&(n=t[20].note.equals(t[14])),n?a?a.p(t,s):(a=$t(t),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null)},d(t){a&&a.d(t),t&&h(e)}}}function Et(t){let e,n=t[17].notes,a=[];for(let e=0;e<n.length;e+=1)a[e]=wt(vt(t,n,e));return{c(){for(let t=0;t<a.length;t+=1)a[t].c();e=s()},l(t){for(let e=0;e<a.length;e+=1)a[e].l(t);e=s()},m(t,n){for(let e=0;e<a.length;e+=1)a[e].m(t,n);r(t,e,n)},p(t,s){if(58&s){let r;for(n=t[17].notes,r=0;r<n.length;r+=1){const l=vt(t,n,r);a[r]?a[r].p(l,s):(a[r]=wt(l),a[r].c(),a[r].m(e.parentNode,e))}for(;r<a.length;r+=1)a[r].d(1);a.length=n.length}},d(t){E(a,t),t&&h(e)}}}function bt(t){let e,n,s=Array.from(t[5].values()),a=[];for(let e=0;e<s.length;e+=1)a[e]=Et(gt(t,s,e));return{c(){e=p("div");for(let t=0;t<a.length;t+=1)a[t].c();n=b(),this.h()},l(t){e=g(t,"DIV",{class:!0});var s=v(e);for(let t=0;t<a.length;t+=1)a[t].l(s);n=I(s),s.forEach(h),this.h()},h(){$(e,"class","keyholder svelte-1ew6a7t")},m(t,s){r(t,e,s);for(let t=0;t<a.length;t+=1)a[t].m(e,null);y(e,n)},p(t,r){if(58&r){let l;for(s=Array.from(t[5].values()),l=0;l<s.length;l+=1){const i=gt(t,s,l);a[l]?a[l].p(i,r):(a[l]=Et(i),a[l].c(),a[l].m(e,n))}for(;l<a.length;l+=1)a[l].d(1);a.length=s.length}},d(t){t&&h(e),E(a,t)}}}function It(t){let e,n,s,a,l,i,o,c,u,f,d;return{c(){e=p("input"),n=x("\n    position "),s=x(t[0]),a=b(),l=p("br"),i=b(),o=p("input"),c=x("\n    zoom "),u=x(t[1]),this.h()},l(r){e=g(r,"INPUT",{type:!0,min:!0,max:!0,step:!0}),n=k(r,"\n    position "),s=k(r,t[0]),a=I(r),l=g(r,"BR",{}),i=I(r),o=g(r,"INPUT",{type:!0,min:!0,max:!0,step:!0}),c=k(r,"\n    zoom "),u=k(r,t[1]),this.h()},h(){$(e,"type","range"),$(e,"min","0"),$(e,"max","1"),$(e,"step","0.0001"),$(o,"type","range"),$(o,"min","0"),$(o,"max","1"),$(o,"step","0.0001")},m(h,m){r(h,e,m),D(e,t[0]),r(h,n,m),r(h,s,m),r(h,a,m),r(h,l,m),r(h,i,m),r(h,o,m),D(o,t[1]),r(h,c,m),r(h,u,m),f||(d=[V(e,"change",t[10]),V(e,"input",t[10]),V(o,"change",t[11]),V(o,"input",t[11])],f=!0)},p(t,n){1&n&&D(e,t[0]),1&n&&P(s,t[0]),2&n&&D(o,t[1]),2&n&&P(u,t[1])},d(t){t&&h(e),t&&h(n),t&&h(s),t&&h(a),t&&h(l),t&&h(i),t&&h(o),t&&h(c),t&&h(u),f=!1,L(d)}}}function yt(t){let e,n,a,i,c,w,x,k,D;n=new mt({props:{keys:t[3]}});let V=t[3],P=[];for(let e=0;e<V.length;e+=1)P[e]=bt(pt(t,V,e));let L=t[2]&&It(t);return{c(){e=p("div"),u(n.$$.fragment),a=b(),i=p("div"),c=b(),w=p("div");for(let t=0;t<P.length;t+=1)P[t].c();x=b(),L&&L.c(),k=s(),this.h()},l(t){e=g(t,"DIV",{class:!0});var r=v(e);f(n.$$.fragment,r),a=I(r),i=g(r,"DIV",{class:!0}),v(i).forEach(h),c=I(r),w=g(r,"DIV",{class:!0,style:!0});var l=v(w);for(let t=0;t<P.length;t+=1)P[t].l(l);l.forEach(h),r.forEach(h),x=I(t),L&&L.l(t),k=s(),this.h()},h(){$(i,"class","fader svelte-1ew6a7t"),$(w,"class","noteholder svelte-1ew6a7t"),N(w,"--top",100*t[0]/t[1]+"%"),$(e,"class","grandaddy svelte-1ew6a7t")},m(s,l){r(s,e,l),d(n,e,null),y(e,a),y(e,i),y(e,c),y(e,w);for(let t=0;t<P.length;t+=1)P[t].m(w,null);t[9](e),r(s,x,l),L&&L.m(s,l),r(s,k,l),D=!0},p(t,[e]){const s={};if(8&e&&(s.keys=t[3]),n.$set(s),58&e){let n;for(V=t[3],n=0;n<V.length;n+=1){const s=pt(t,V,n);P[n]?P[n].p(s,e):(P[n]=bt(s),P[n].c(),P[n].m(w,null))}for(;n<P.length;n+=1)P[n].d(1);P.length=V.length}(!D||3&e)&&N(w,"--top",100*t[0]/t[1]+"%"),t[2]?L?L.p(t,e):(L=It(t),L.c(),L.m(k.parentNode,k)):L&&(L.d(1),L=null)},i(t){D||(o(n.$$.fragment,t),D=!0)},o(t){l(n.$$.fragment,t),D=!1},d(s){s&&h(e),m(n),E(P,s),t[9](null),s&&h(x),L&&L.d(s),s&&h(k)}}}function Nt(t,e,n){let s,{debugSliders:r=!1}=e,{position:a=0}=e,{zoomWidth:l=1}=e,{keys:i}=e,{duration:o=5e3}=e,{colourer:h}=e,{tracks:c}=e,{heightElement:u}=e;return M(()=>{}),t.$$set=t=>{"debugSliders"in t&&n(2,r=t.debugSliders),"position"in t&&n(0,a=t.position),"zoomWidth"in t&&n(1,l=t.zoomWidth),"keys"in t&&n(3,i=t.keys),"duration"in t&&n(7,o=t.duration),"colourer"in t&&n(4,h=t.colourer),"tracks"in t&&n(5,c=t.tracks),"heightElement"in t&&n(8,u=t.heightElement)},t.$$.update=()=>{128&t.$$.dirty&&n(1,l=5e3/o),320&t.$$.dirty&&u&&s&&u.clientHeight&&u.clientHeight!=s.clientHeight&&n(6,s.style.height=u.clientHeight+"px",s)},[a,l,r,i,h,c,s,o,u,function(t){z[t?"unshift":"push"](()=>{s=t,n(6,s),n(8,u)})},function(){a=B(this.value),n(0,a)},function(){l=B(this.value),n(1,l),n(7,o)}]}class xt extends t{constructor(t){super(),e(this,t,Nt,yt,n,{debugSliders:2,position:0,zoomWidth:1,keys:3,duration:7,colourer:4,tracks:5,heightElement:8})}}class kt{constructor(t,e,n,s=1){if(t>=e)if(t>e){let t=this.start;this.start=this.end,this.end=t}else this.end+=.001;this.velocity=s,this.start=t,this.end=e,this.note=n}}class Dt{constructor(t){for(let e=1;e<t.length;e++)if(t[e-1].start>t[e].start)throw new Error("Notes out of order: "+t[e-1].note.string()+" starts at "+t[e-1].start+" and "+t[e].note.string()+" starts at "+t[e].start);let e=[];t.forEach((n,s)=>{for(var r=s+1;r<t.length&&!(n.end<t[r].start);r++)n.end>t[r].start&&t[r].note.equals(n.note)&&(n.start===t[r].start?e.push(r):n.end=t[r].start)}),t.forEach((t,n)=>{(t.note.lowerThan(Y)||J.lowerThan(t.note))&&e.push(n)}),e=[...new Set(e)],e.sort().reverse().forEach(e=>{t.splice(e,1)}),this.notes=t}notesFrom(t,e){if(t>=e)return[];if(0==this.notes.length)return[];if(this.notes[this.notes.length-1].start<t)return[];let n=0,s=this.notes.length-1,r=Math.trunc((n+s)/2);for(;n!=s;){this.notes[r].start<t?n=n==r?s:r:s=r,r=Math.trunc((n+s)/2)}let a=n,l=[];for(;a<this.notes.length&&this.notes[a].start<=e;)l.push(this.notes[a]),a++;return l}add(t){this.notes.push(t)}sort(){this.notes.sort((t,e)=>t.start-e.start)}untime(){return this.notes.map(t=>t.note)}untimeRemoveDupes(){let t=new Map;return this.notes.forEach(e=>{t.set(e.note.string(),!0)}),t}}function Vt(t){let e,n,s,a;return{c(){e=p("p"),n=x(t[2]),s=x("/"),a=x(t[3]),this.h()},l(r){e=g(r,"P",{class:!0});var l=v(e);n=k(l,t[2]),s=k(l,"/"),a=k(l,t[3]),l.forEach(h),this.h()},h(){$(e,"class","robotic svelte-1rzjcd5")},m(t,l){r(t,e,l),y(e,n),y(e,s),y(e,a)},p(t,e){4&e&&P(n,t[2]),8&e&&P(a,t[3])},d(t){t&&h(e)}}}function Pt(t){let e,n,s=t[1]&&Vt(t);return{c(){e=p("div"),s&&s.c(),this.h()},l(t){e=g(t,"DIV",{class:!0,style:!0});var n=v(e);s&&s.l(n),n.forEach(h),this.h()},h(){$(e,"class",n=S(t[0])+" svelte-1rzjcd5"),N(e,"--width",100*t[2]/t[3]+"%"),N(e,"--color",t[2]>=t[3]?"#1CBE02":"#FFA800")},m(t,n){r(t,e,n),s&&s.m(e,null)},p(t,[r]){t[1]?s?s.p(t,r):(s=Vt(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null),1&r&&n!==(n=S(t[0])+" svelte-1rzjcd5")&&$(e,"class",n),12&r&&N(e,"--width",100*t[2]/t[3]+"%"),12&r&&N(e,"--color",t[2]>=t[3]?"#1CBE02":"#FFA800")},i:w,o:w,d(t){t&&h(e),s&&s.d()}}}function Lt(t,e,n){let{size:s="small"}=e,{value:r=0}=e,{showValue:a=!1}=e,{denominator:l=100}=e;return"small"!==s&&"medium"!==s&&"large"!==s&&"flex"!==s&&(s="small"),"small"===s&&(a=!1),t.$$set=t=>{"size"in t&&n(0,s=t.size),"value"in t&&n(2,r=t.value),"showValue"in t&&n(1,a=t.showValue),"denominator"in t&&n(3,l=t.denominator)},[s,a,r,l]}class Mt extends t{constructor(t){super(),e(this,t,Lt,Pt,n,{size:0,value:2,showValue:1,denominator:3})}}function zt(t){let e,n,c,u;const f=[Ct,At],d=[];function m(t,e){return t[5]<=0?0:t[5]>=t[4]?1:-1}return~(e=m(t))&&(n=d[e]=f[e](t)),{c(){n&&n.c(),c=s()},l(t){n&&n.l(t),c=s()},m(t,n){~e&&d[e].m(t,n),r(t,c,n),u=!0},p(t,s){let r=e;e=m(t),e===r?~e&&d[e].p(t,s):(n&&(a(),l(d[r],1,1,()=>{d[r]=null}),i()),~e?(n=d[e],n?n.p(t,s):(n=d[e]=f[e](t),n.c()),o(n,1),n.m(c.parentNode,c)):n=null)},i(t){u||(o(n),u=!0)},o(t){l(n),u=!1},d(t){~e&&d[e].d(t),t&&h(c)}}}function Bt(t){let e,n,s,a,l,i,o,c,u,f=t[2][0].enharmonicEquivalent()+"";return{c(){e=p("div"),n=p("h3"),s=x("Play back the phrase you just heard"),a=b(),l=p("p"),i=x("(hint: it starts on "),o=x(f),c=x(")"),this.h()},l(t){e=g(t,"DIV",{class:!0});var r=v(e);n=g(r,"H3",{class:!0});var u=v(n);s=k(u,"Play back the phrase you just heard"),u.forEach(h),a=I(r),l=g(r,"P",{class:!0});var d=v(l);i=k(d,"(hint: it starts on "),o=k(d,f),c=k(d,")"),d.forEach(h),r.forEach(h),this.h()},h(){$(n,"class","svelte-r4lmbp"),$(l,"class","svelte-r4lmbp"),$(e,"class","svelte-r4lmbp")},m(t,h){r(t,e,h),y(e,n),y(n,s),y(e,a),y(e,l),y(l,i),y(l,o),y(l,c)},p(t,e){4&e&&f!==(f=t[2][0].enharmonicEquivalent()+"")&&P(o,f)},i(t){u||q(()=>{u=F(e,O,{}),u.start()})},o:w,d(t){t&&h(e)}}}function St(t){return{c:w,l:w,m:w,p:w,i:w,o:w,d:w}}function jt(t){let e,n,s,a;return n=new T({props:{text:"listen",defaultAction:!0}}),n.$on("click",t[16]),{c(){e=p("div"),u(n.$$.fragment),this.h()},l(t){e=g(t,"DIV",{class:!0});var s=v(e);f(n.$$.fragment,s),s.forEach(h),this.h()},h(){$(e,"class","svelte-r4lmbp")},m(t,s){r(t,e,s),d(n,e,null),a=!0},p:w,i(t){a||(o(n.$$.fragment,t),q(()=>{s||(s=U(e,O,{},!0)),s.run(1)}),a=!0)},o(t){l(n.$$.fragment,t),s||(s=U(e,O,{},!1)),s.run(0),a=!1},d(t){t&&h(e),m(n),t&&s&&s.end()}}}function At(t){let e,n,s,c,w,E,N,D,V,P,L,M,z,B,S,j,A,C,R,H,q,F,U,T;M=new lt({props:{reccomended:t[1].phraseLength<=t[1].maxInterval,text:"Longer Phrases"}}),M.$on("click",t[21]),S=new lt({props:{reccomended:t[1].phraseLength>t[1].maxInterval&&t[1].notePoolSize<=t[1].maxInterval,text:"More Notes"}}),S.$on("click",t[22]);let O=t[1].maxInterval<t[1].notePoolSize&&Rt(t);return U=new W({props:{text:"Retry"}}),U.$on("click",t[24]),{c(){e=p("div"),n=p("div"),s=p("h3"),c=x("Congratulations!"),w=b(),E=p("div"),N=p("h4"),D=x("Increase difficulty by trying"),V=b(),P=p("div"),L=p("div"),u(M.$$.fragment),z=b(),B=p("div"),u(S.$$.fragment),j=b(),O&&O.c(),A=b(),C=p("div"),R=p("p"),H=x("or"),q=b(),F=p("div"),u(U.$$.fragment),this.h()},l(t){e=g(t,"DIV",{class:!0});var r=v(e);n=g(r,"DIV",{class:!0});var a=v(n);s=g(a,"H3",{class:!0});var l=v(s);c=k(l,"Congratulations!"),l.forEach(h),a.forEach(h),w=I(r),E=g(r,"DIV",{class:!0});var i=v(E);N=g(i,"H4",{});var o=v(N);D=k(o,"Increase difficulty by trying"),o.forEach(h),i.forEach(h),V=I(r),P=g(r,"DIV",{class:!0});var u=v(P);L=g(u,"DIV",{class:!0});var d=v(L);f(M.$$.fragment,d),d.forEach(h),z=I(u),B=g(u,"DIV",{class:!0});var m=v(B);f(S.$$.fragment,m),m.forEach(h),j=I(u),O&&O.l(u),u.forEach(h),A=I(r),C=g(r,"DIV",{class:!0});var p=v(C);R=g(p,"P",{class:!0});var $=v(R);H=k($,"or"),$.forEach(h),p.forEach(h),q=I(r),F=g(r,"DIV",{class:!0});var b=v(F);f(U.$$.fragment,b),b.forEach(h),r.forEach(h),this.h()},h(){$(s,"class","svelte-r4lmbp"),$(n,"class","svelte-r4lmbp"),$(E,"class","svelte-r4lmbp"),$(L,"class","svelte-r4lmbp"),$(B,"class","svelte-r4lmbp"),$(P,"class","svelte-r4lmbp"),$(R,"class","svelte-r4lmbp"),$(C,"class","svelte-r4lmbp"),$(F,"class","svelte-r4lmbp"),$(e,"class","end svelte-r4lmbp")},m(t,a){r(t,e,a),y(e,n),y(n,s),y(s,c),y(e,w),y(e,E),y(E,N),y(N,D),y(e,V),y(e,P),y(P,L),d(M,L,null),y(P,z),y(P,B),d(S,B,null),y(P,j),O&&O.m(P,null),y(e,A),y(e,C),y(C,R),y(R,H),y(e,q),y(e,F),d(U,F,null),T=!0},p(t,e){const n={};2&e&&(n.reccomended=t[1].phraseLength<=t[1].maxInterval),M.$set(n);const s={};2&e&&(s.reccomended=t[1].phraseLength>t[1].maxInterval&&t[1].notePoolSize<=t[1].maxInterval),S.$set(s),t[1].maxInterval<t[1].notePoolSize?O?(O.p(t,e),2&e&&o(O,1)):(O=Rt(t),O.c(),o(O,1),O.m(P,null)):O&&(a(),l(O,1,1,()=>{O=null}),i())},i(t){T||(o(M.$$.fragment,t),o(S.$$.fragment,t),o(O),o(U.$$.fragment,t),T=!0)},o(t){l(M.$$.fragment,t),l(S.$$.fragment,t),l(O),l(U.$$.fragment,t),T=!1},d(t){t&&h(e),m(M),m(S),O&&O.d(),m(U)}}}function Ct(t){let e,n,s,c,w,E,N,D,V,P,L,M,z,B;N=new T({props:{defaultAction:!0,text:"Retry"}}),N.$on("click",t[17]);let S=(t[1].phraseLength>2||t[1].notePoolSize>2||t[1].maxInterval>2)&&Ht(),j=t[1].phraseLength>2&&qt(t),A=(t[1].notePoolSize>2||t[1].notePoolSize>t[1].maxInterval)&&Ft(t),C=t[1].maxInterval>2&&Ut(t);return{c(){e=p("div"),n=p("div"),s=p("h3"),c=x("Bad luck!"),w=b(),E=p("div"),u(N.$$.fragment),D=b(),V=p("div"),S&&S.c(),P=b(),L=p("div"),j&&j.c(),M=b(),A&&A.c(),z=b(),C&&C.c(),this.h()},l(t){e=g(t,"DIV",{class:!0});var r=v(e);n=g(r,"DIV",{class:!0});var a=v(n);s=g(a,"H3",{class:!0});var l=v(s);c=k(l,"Bad luck!"),l.forEach(h),a.forEach(h),w=I(r),E=g(r,"DIV",{class:!0});var i=v(E);f(N.$$.fragment,i),i.forEach(h),D=I(r),V=g(r,"DIV",{class:!0});var o=v(V);S&&S.l(o),o.forEach(h),P=I(r),L=g(r,"DIV",{class:!0});var u=v(L);j&&j.l(u),M=I(u),A&&A.l(u),z=I(u),C&&C.l(u),u.forEach(h),r.forEach(h),this.h()},h(){$(s,"class","svelte-r4lmbp"),$(n,"class","svelte-r4lmbp"),$(E,"class","svelte-r4lmbp"),$(V,"class","svelte-r4lmbp"),$(L,"class","svelte-r4lmbp"),$(e,"class","end svelte-r4lmbp")},m(t,a){r(t,e,a),y(e,n),y(n,s),y(s,c),y(e,w),y(e,E),d(N,E,null),y(e,D),y(e,V),S&&S.m(V,null),y(e,P),y(e,L),j&&j.m(L,null),y(L,M),A&&A.m(L,null),y(L,z),C&&C.m(L,null),B=!0},p(t,e){t[1].phraseLength>2||t[1].notePoolSize>2||t[1].maxInterval>2?S||(S=Ht(),S.c(),S.m(V,null)):S&&(S.d(1),S=null),t[1].phraseLength>2?j?(j.p(t,e),2&e&&o(j,1)):(j=qt(t),j.c(),o(j,1),j.m(L,M)):j&&(a(),l(j,1,1,()=>{j=null}),i()),t[1].notePoolSize>2||t[1].notePoolSize>t[1].maxInterval?A?(A.p(t,e),2&e&&o(A,1)):(A=Ft(t),A.c(),o(A,1),A.m(L,z)):A&&(a(),l(A,1,1,()=>{A=null}),i()),t[1].maxInterval>2?C?(C.p(t,e),2&e&&o(C,1)):(C=Ut(t),C.c(),o(C,1),C.m(L,null)):C&&(a(),l(C,1,1,()=>{C=null}),i())},i(t){B||(o(N.$$.fragment,t),o(j),o(A),o(C),B=!0)},o(t){l(N.$$.fragment,t),l(j),l(A),l(C),B=!1},d(t){t&&h(e),m(N),S&&S.d(),j&&j.d(),A&&A.d(),C&&C.d()}}}function Rt(t){let e,n,s;return n=new lt({props:{reccomended:t[1].phraseLength>t[1].maxInterval&&t[1].notePoolSize>t[1].maxInterval,text:"Longer Intervals"}}),n.$on("click",t[23]),{c(){e=p("div"),u(n.$$.fragment),this.h()},l(t){e=g(t,"DIV",{class:!0});var s=v(e);f(n.$$.fragment,s),s.forEach(h),this.h()},h(){$(e,"class","svelte-r4lmbp")},m(t,a){r(t,e,a),d(n,e,null),s=!0},p(t,e){const s={};2&e&&(s.reccomended=t[1].phraseLength>t[1].maxInterval&&t[1].notePoolSize>t[1].maxInterval),n.$set(s)},i(t){s||(o(n.$$.fragment,t),s=!0)},o(t){l(n.$$.fragment,t),s=!1},d(t){t&&h(e),m(n)}}}function Ht(t){let e,n;return{c(){e=p("p"),n=x("or"),this.h()},l(t){e=g(t,"P",{class:!0});var s=v(e);n=k(s,"or"),s.forEach(h),this.h()},h(){$(e,"class","svelte-r4lmbp")},m(t,s){r(t,e,s),y(e,n)},d(t){t&&h(e)}}}function qt(t){let e,n,s;return n=new W({props:{text:"Shorter Phrases"}}),n.$on("click",t[18]),{c(){e=p("div"),u(n.$$.fragment),this.h()},l(t){e=g(t,"DIV",{class:!0});var s=v(e);f(n.$$.fragment,s),s.forEach(h),this.h()},h(){$(e,"class","svelte-r4lmbp")},m(t,a){r(t,e,a),d(n,e,null),s=!0},p:w,i(t){s||(o(n.$$.fragment,t),s=!0)},o(t){l(n.$$.fragment,t),s=!1},d(t){t&&h(e),m(n)}}}function Ft(t){let e,n,s;return n=new W({props:{text:"Fewer Notes"}}),n.$on("click",t[19]),{c(){e=p("div"),u(n.$$.fragment),this.h()},l(t){e=g(t,"DIV",{class:!0});var s=v(e);f(n.$$.fragment,s),s.forEach(h),this.h()},h(){$(e,"class","svelte-r4lmbp")},m(t,a){r(t,e,a),d(n,e,null),s=!0},p:w,i(t){s||(o(n.$$.fragment,t),s=!0)},o(t){l(n.$$.fragment,t),s=!1},d(t){t&&h(e),m(n)}}}function Ut(t){let e,n,s;return n=new W({props:{text:"Shorter Intervals"}}),n.$on("click",t[20]),{c(){e=p("div"),u(n.$$.fragment),this.h()},l(t){e=g(t,"DIV",{class:!0});var s=v(e);f(n.$$.fragment,s),s.forEach(h),this.h()},h(){$(e,"class","svelte-r4lmbp")},m(t,a){r(t,e,a),d(n,e,null),s=!0},p:w,i(t){s||(o(n.$$.fragment,t),s=!0)},o(t){l(n.$$.fragment,t),s=!1},d(t){t&&h(e),m(n)}}}function Tt(t){let e,n,s,c,w,E,y,N,x,k,D,V,P;n=new Mt({props:{size:"medium",value:t[5],showValue:!0,denominator:t[4]}});const L=[jt,St,Bt,zt],M=[];function z(t,e){return t[12]===t[11].Before?0:t[12]===t[11].Listening?1:t[12]===t[11].Playing?2:t[12]===t[11].End?3:-1}return~(w=z(t))&&(E=M[w]=L[w](t)),x=new xt({props:{keys:t[15],tracks:t[9],colourer:new _(2),duration:Ot,position:0,heightElement:t[10]}}),V=new Z({props:{usedNotes:t[6],keys:t[15],instrument:t[7],on:t[12]!==t[11].Listening}}),V.$on("playingNotes",(function(){j(t[13])&&t[13].apply(this,arguments)})),{c(){e=p("div"),u(n.$$.fragment),s=b(),c=p("div"),E&&E.c(),y=b(),N=p("div"),u(x.$$.fragment),k=b(),D=p("div"),u(V.$$.fragment),this.h()},l(t){e=g(t,"DIV",{class:!0});var r=v(e);f(n.$$.fragment,r),r.forEach(h),s=I(t),c=g(t,"DIV",{class:!0});var a=v(c);E&&E.l(a),a.forEach(h),y=I(t),N=g(t,"DIV",{class:!0});var l=v(N);f(x.$$.fragment,l),l.forEach(h),k=I(t),D=g(t,"DIV",{class:!0});var i=v(D);f(V.$$.fragment,i),i.forEach(h),this.h()},h(){$(e,"class","score svelte-r4lmbp"),$(c,"class","content svelte-r4lmbp"),$(N,"class","roll svelte-r4lmbp"),$(D,"class","piano svelte-r4lmbp")},m(a,l){r(a,e,l),d(n,e,null),r(a,s,l),r(a,c,l),~w&&M[w].m(c,null),r(a,y,l),r(a,N,l),d(x,N,null),t[25](N),r(a,k,l),r(a,D,l),d(V,D,null),P=!0},p(e,[s]){t=e;const r={};32&s&&(r.value=t[5]),16&s&&(r.denominator=t[4]),n.$set(r);let h=w;w=z(t),w===h?~w&&M[w].p(t,s):(E&&(a(),l(M[h],1,1,()=>{M[h]=null}),i()),~w?(E=M[w],E?E.p(t,s):(E=M[w]=L[w](t),E.c()),o(E,1),E.m(c,null)):E=null);const u={};512&s&&(u.tracks=t[9]),1024&s&&(u.heightElement=t[10]),x.$set(u);const f={};64&s&&(f.usedNotes=t[6]),128&s&&(f.instrument=t[7]),6144&s&&(f.on=t[12]!==t[11].Listening),V.$set(f)},i(t){P||(o(n.$$.fragment,t),o(E),o(x.$$.fragment,t),o(V.$$.fragment,t),P=!0)},o(t){l(n.$$.fragment,t),l(E),l(x.$$.fragment,t),l(V.$$.fragment,t),P=!1},d(r){r&&h(e),m(n),r&&h(s),r&&h(c),~w&&M[w].d(),r&&h(y),r&&h(N),m(x),t[25](null),r&&h(k),r&&h(D),m(V)}}}let Ot=5e3;function Wt(t,e,n){let s;const{session:r,page:a}=A();C(t,a,t=>n(26,s=t));const l=s.query;let i=tt(l),o=i.notes,h=i.newPhrase(),c=2*i.phraseLength,u=5*i.phraseLength,f=c,d=new Map;let m=(p=o[0],g=o[o.length-1],p.getAbstract().accidental&&(p=p.nextLowest()),p.intervalTo(g)<12&&(g=p.jump(12)),g.getAbstract().accidental&&(g=g.jump(1)),X(p,g));var p,g;let v,$,w,E=new Map([["right",new Dt([])],["wrong",new Dt([])]]);var b;M(()=>{document.addEventListener("keypress",()=>{G()}),document.addEventListener("click",()=>{G()}),document.addEventListener("keydown",()=>{G()}),document.addEventListener("touchstart",()=>{G()}),et()||(r.set({redirect:s.path+"?"+R(s.query)}),H("/settings")),n(7,v=K("User Piano",()=>{})),n(8,$=K("MechanicalPiano",()=>{}))}),function(t){t.Before="Before",t.Listening="Listening",t.Playing="Playing",t.End="End"}(b||(b={}));let I=b.Before,y=t=>{};return t.$$.update=()=>{1&t.$$.dirty&&function(t){let e=new Map;t.forEach(t=>{e.set(t.string(),!0)}),n(6,d=e)}(o)},[o,i,h,c,u,f,d,v,$,E,w,b,I,y,a,m,()=>{n(9,E=new Map([["right",new Dt([])],["wrong",new Dt([])]])),n(2,h=i.newPhrase()),n(0,o=i.notes),n(3,c=2*i.phraseLength),n(4,u=5*i.phraseLength),H(i.playURL()),n(12,I=b.Listening);h.forEach((t,e)=>{setTimeout(()=>{$.play(t,1e3,1),e===h.length-1&&setTimeout(()=>{n(12,I=b.Playing);let t=0,e=1/h.length;n(13,y=s=>{let r=s.detail;if(1===r.length){E.get("right").notes.push(new kt(t*e,(t+1)*e,h[t]));let s=f;s++,r.forEach(n=>{h[t]!==n&&(E.get("wrong").notes.push(new kt(t*e,(t+1)*e,n)),s-=i.phraseLength)}),t++,n(5,f=s),n(9,E),t>=h.length&&(n(13,y=()=>{}),f<=0?n(12,I=b.End):f>=u?(i.succeed(),n(12,I=b.End)):n(12,I=b.Before))}})},1e3)},1e3*e)})},()=>{n(12,I=b.Before),n(5,f=c)},()=>{n(1,i=i.shorterPhrases()),n(12,I=b.Before),n(5,f=c)},()=>{n(1,i=i.fewerNotes()),n(12,I=b.Before),n(5,f=c)},()=>{n(1,i=i.shorterIntervals()),n(12,I=b.Before),n(5,f=c)},()=>{n(1,i=i.longerPhrases()),n(12,I=b.Before),n(5,f=c)},()=>{n(1,i=i.moreNotes()),n(12,I=b.Before),n(5,f=c)},()=>{n(1,i=i.longerIntervals()),n(12,I=b.Before),n(5,f=c)},()=>{n(12,I=b.Before),n(5,f=c)},function(t){z[t?"unshift":"push"](()=>{w=t,n(10,w)})}]}export default class extends t{constructor(t){super(),e(this,t,Wt,Tt,n,{})}}
