import{S as t,i as e,s as n,e as s,c as i,b as r,g as o,m as a,h as c,r as u,n as l,z as h,O as d,P as p,k as f,a as m,t as g,l as _,f as v,d as y,Q as b,R as w,q as x,j as T,T as C,G as k,v as A,w as S,y as O,I as M,L as E,K as D,U as I,x as N,B as R,V,J as P}from"./client.5ee8e5bf.js";import{w as q}from"./webmidi.min.0a3878e3.js";import{I as F,L as j,b as L,h as $,l as B}from"./notes.be99bc8d.js";import{g as W,i as U}from"./storage.4617e2a9.js";import{c as z,a as G}from"./_commonjsHelpers.521bc219.js";function Y(t,e,n,s){return e.get(t)&&s?X.active:n.get(t.string())?X.highlighted:X.inactive}var X;!function(t){t[t.active=0]="active",t[t.inactive=1]="inactive",t[t.highlighted=2]="highlighted"}(X||(X={}));var Z=z((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={sum:function(t){return t.reduce((function(t,e){return t+e}))}};e.default=n}));var H=function(t){return Object.prototype.toString.call(t).slice(8,-1)};var Q=function(t){return!!t&&"object"==typeof t&&t.constructor===Object};var J,K,tt=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};function et(t,e,n,s){return t.call(s,e[n],n,e)}var nt=function(t,e,n){var s,i=0;for(s in null==J&&function(){for(var t in K=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],J=!0,{toString:null})J=!1}(),t)if(!1===et(e,t,s,n))break;if(J)for(var r=t.constructor,o=!!r&&t===r.prototype;(s=K[i++])&&("constructor"===s&&(o||!tt(t,s))||t[s]===Object.prototype[s]||!1!==et(e,t,s,n)););};var st=function(t,e,n){nt(t,(function(s,i){if(tt(t,i))return e.call(n,t[i],i,t)}))};function it(t,e){this[e]=t}var rt=function(t,e){for(var n,s=0,i=arguments.length;++s<i;)null!=(n=arguments[s])&&st(n,it,t);return t};var ot=function(t){switch(H(t)){case"Object":return Q(s=t)?rt({},s):s;case"Array":return t.slice();case"RegExp":return n="",n+=(e=t).multiline?"m":"",n+=e.global?"g":"",n+=e.ignoreCase?"i":"",new RegExp(e.source,n);case"Date":return new Date(+t);default:return t}var e,n,s};function at(t,e){switch(H(t)){case"Object":return function(t,e){if(Q(t)){var n={};return st(t,(function(t,n){this[n]=at(t,e)}),n),n}return e?e(t):t}(t,e);case"Array":return function(t,e){var n=[],s=-1,i=t.length;for(;++s<i;)n[s]=at(t[s],e);return n}(t,e);default:return ot(t)}}var ct=at;var ut=function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e};var lt=function(t,e){return H(t)===e};var ht=function(t){return lt(t,"Object")},dt=Array.isArray||function(t){return lt(t,"Array")};var pt=function(t){return t};var ft=function(t){return function(e){return e[t]}};function mt(t,e){for(var n=-1,s=t.length;++n<s;)if(gt(t[n],e))return!0;return!1}function gt(t,e){return t&&"object"==typeof t&&e&&"object"==typeof e?dt(t)&&dt(e)?function(t,e){for(var n=-1,s=e.length;++n<s;)if(!mt(t,e[n]))return!1;return!0}(t,e):function(t,e){var n=!0;return st(e,(function(e,s){if(!gt(t[s],e))return n=!1})),n}(t,e):t===e}var _t=gt;var vt=function(t,e){if(null==t)return pt;switch(typeof t){case"function":return void 0!==e?function(n,s,i){return t.call(e,n,s,i)}:t;case"object":return function(e){return _t(e,t)};case"string":case"number":return ft(t)}};var yt=function(t,e,n){e=vt(e,n);var s=!0;return st(t,(function(n,i){if(!e(n,i,t))return s=!1,!1})),s};function bt(t,e){return tt(this,e)}var wt=function(t,e,n){return n=n||ut,ht(t)&&ht(e)?yt(t,function(t){return function(e,n){return tt(this,n)&&t(e,this[n])}}(n),e)&&yt(e,bt,t):n(t,e)};var xt=function(t,e,n){e=vt(e,n);var s=!0;if(null==t)return s;for(var i=-1,r=t.length;++i<r;)if(!e(t[i],i,t)){s=!1;break}return s};var Tt=function(t,e,n){return n=n||ut,dt(t)&&dt(e)?t.length===e.length&&xt(t,function(t){return function(e,n){return n in this&&t(e,this[n])}}(n),e):n(t,e)};var Ct=function t(e,n,s){s=s||ut;var i=ht(e)&&ht(n),r=!i&&dt(e)&&dt(n);return i||r?(i?wt:Tt)(e,n,(function(e,n){return t(e,n,s)})):s(e,n)},kt=z((function(t,e){
/**
 * chroma.js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2019, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 * derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -------------------------------------------------------
 *
 * chroma.js includes colors from colorbrewer2.org, which are released under
 * the following license:
 *
 * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
 * and The Pennsylvania State University.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 *
 * ------------------------------------------------------
 *
 * Named colors are taken from X11 Color Names.
 * http://www.w3.org/TR/css3-color/#svg-color
 *
 * @preserve
 */
t.exports=function(){for(var t=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=1),t<e?e:t>n?n:t},e={},n=0,s=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];n<s.length;n+=1){var i=s[n];e["[object "+i+"]"]=i.toLowerCase()}var r=function(t){return e[Object.prototype.toString.call(t)]||"object"},o=Math.PI,a={clip_rgb:function(e){e._clipped=!1,e._unclipped=e.slice(0);for(var n=0;n<=3;n++)n<3?((e[n]<0||e[n]>255)&&(e._clipped=!0),e[n]=t(e[n],0,255)):3===n&&(e[n]=t(e[n],0,1));return e},limit:t,type:r,unpack:function(t,e){return void 0===e&&(e=null),t.length>=3?Array.prototype.slice.call(t):"object"==r(t[0])&&e?e.split("").filter((function(e){return void 0!==t[0][e]})).map((function(e){return t[0][e]})):t[0]},last:function(t){if(t.length<2)return null;var e=t.length-1;return"string"==r(t[e])?t[e].toLowerCase():null},PI:o,TWOPI:2*o,PITHIRD:o/3,DEG2RAD:o/180,RAD2DEG:180/o},c={format:{},autodetect:[]},u=a.last,l=a.clip_rgb,h=a.type,d=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=this;if("object"===h(t[0])&&t[0].constructor&&t[0].constructor===this.constructor)return t[0];var s=u(t),i=!1;if(!s){i=!0,c.sorted||(c.autodetect=c.autodetect.sort((function(t,e){return e.p-t.p})),c.sorted=!0);for(var r=0,o=c.autodetect;r<o.length;r+=1){var a=o[r];if(s=a.test.apply(a,t))break}}if(!c.format[s])throw new Error("unknown format: "+t);var d=c.format[s].apply(null,i?t:t.slice(0,-1));n._rgb=l(d),3===n._rgb.length&&n._rgb.push(1)};d.prototype.toString=function(){return"function"==h(this.hex)?this.hex():"["+this._rgb.join(",")+"]"};var p=d,f=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(f.Color,[null].concat(t)))};f.Color=p,f.version="2.1.0";var m=f,g=a.unpack,_=Math.max,v=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=g(t,"rgb"),s=n[0],i=n[1],r=n[2],o=1-_(s/=255,_(i/=255,r/=255)),a=o<1?1/(1-o):0,c=(1-s-o)*a,u=(1-i-o)*a,l=(1-r-o)*a;return[c,u,l,o]},y=a.unpack,b=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=(t=y(t,"cmyk"))[0],s=t[1],i=t[2],r=t[3],o=t.length>4?t[4]:1;return 1===r?[0,0,0,o]:[n>=1?0:255*(1-n)*(1-r),s>=1?0:255*(1-s)*(1-r),i>=1?0:255*(1-i)*(1-r),o]},w=a.unpack,x=a.type;p.prototype.cmyk=function(){return v(this._rgb)},m.cmyk=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["cmyk"])))},c.format.cmyk=b,c.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=w(t,"cmyk"),"array"===x(t)&&4===t.length)return"cmyk"}});var T=a.unpack,C=a.last,k=function(t){return Math.round(100*t)/100},A=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=T(t,"hsla"),s=C(t)||"lsa";return n[0]=k(n[0]||0),n[1]=k(100*n[1])+"%",n[2]=k(100*n[2])+"%","hsla"===s||n.length>3&&n[3]<1?(n[3]=n.length>3?n[3]:1,s="hsla"):n.length=3,s+"("+n.join(",")+")"},S=a.unpack,O=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=(t=S(t,"rgba"))[0],s=t[1],i=t[2];n/=255,s/=255,i/=255;var r,o,a=Math.min(n,s,i),c=Math.max(n,s,i),u=(c+a)/2;return c===a?(r=0,o=Number.NaN):r=u<.5?(c-a)/(c+a):(c-a)/(2-c-a),n==c?o=(s-i)/(c-a):s==c?o=2+(i-n)/(c-a):i==c&&(o=4+(n-s)/(c-a)),(o*=60)<0&&(o+=360),t.length>3&&void 0!==t[3]?[o,r,u,t[3]]:[o,r,u]},M=a.unpack,E=a.last,D=Math.round,I=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=M(t,"rgba"),s=E(t)||"rgb";return"hsl"==s.substr(0,3)?A(O(n),s):(n[0]=D(n[0]),n[1]=D(n[1]),n[2]=D(n[2]),("rgba"===s||n.length>3&&n[3]<1)&&(n[3]=n.length>3?n[3]:1,s="rgba"),s+"("+n.slice(0,"rgb"===s?3:4).join(",")+")")},N=a.unpack,R=Math.round,V=function(){for(var t,e=[],n=arguments.length;n--;)e[n]=arguments[n];var s,i,r,o=(e=N(e,"hsl"))[0],a=e[1],c=e[2];if(0===a)s=i=r=255*c;else{var u=[0,0,0],l=[0,0,0],h=c<.5?c*(1+a):c+a-c*a,d=2*c-h,p=o/360;u[0]=p+1/3,u[1]=p,u[2]=p-1/3;for(var f=0;f<3;f++)u[f]<0&&(u[f]+=1),u[f]>1&&(u[f]-=1),6*u[f]<1?l[f]=d+6*(h-d)*u[f]:2*u[f]<1?l[f]=h:3*u[f]<2?l[f]=d+(h-d)*(2/3-u[f])*6:l[f]=d;s=(t=[R(255*l[0]),R(255*l[1]),R(255*l[2])])[0],i=t[1],r=t[2]}return e.length>3?[s,i,r,e[3]]:[s,i,r,1]},P=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,q=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,F=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,j=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,L=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,$=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,B=Math.round,W=function(t){var e;if(t=t.toLowerCase().trim(),c.format.named)try{return c.format.named(t)}catch(t){}if(e=t.match(P)){for(var n=e.slice(1,4),s=0;s<3;s++)n[s]=+n[s];return n[3]=1,n}if(e=t.match(q)){for(var i=e.slice(1,5),r=0;r<4;r++)i[r]=+i[r];return i}if(e=t.match(F)){for(var o=e.slice(1,4),a=0;a<3;a++)o[a]=B(2.55*o[a]);return o[3]=1,o}if(e=t.match(j)){for(var u=e.slice(1,5),l=0;l<3;l++)u[l]=B(2.55*u[l]);return u[3]=+u[3],u}if(e=t.match(L)){var h=e.slice(1,4);h[1]*=.01,h[2]*=.01;var d=V(h);return d[3]=1,d}if(e=t.match($)){var p=e.slice(1,4);p[1]*=.01,p[2]*=.01;var f=V(p);return f[3]=+e[4],f}};W.test=function(t){return P.test(t)||q.test(t)||F.test(t)||j.test(t)||L.test(t)||$.test(t)};var U=W,z=a.type;p.prototype.css=function(t){return I(this._rgb,t)},m.css=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["css"])))},c.format.css=U,c.autodetect.push({p:5,test:function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(!e.length&&"string"===z(t)&&U.test(t))return"css"}});var G=a.unpack;c.format.gl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=G(t,"rgba");return n[0]*=255,n[1]*=255,n[2]*=255,n},m.gl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["gl"])))},p.prototype.gl=function(){var t=this._rgb;return[t[0]/255,t[1]/255,t[2]/255,t[3]]};var Y=a.unpack,X=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n,s=Y(t,"rgb"),i=s[0],r=s[1],o=s[2],a=Math.min(i,r,o),c=Math.max(i,r,o),u=c-a,l=100*u/255,h=a/(255-u)*100;return 0===u?n=Number.NaN:(i===c&&(n=(r-o)/u),r===c&&(n=2+(o-i)/u),o===c&&(n=4+(i-r)/u),(n*=60)<0&&(n+=360)),[n,l,h]},Z=a.unpack,H=Math.floor,Q=function(){for(var t,e,n,s,i,r,o=[],a=arguments.length;a--;)o[a]=arguments[a];var c,u,l,h=(o=Z(o,"hcg"))[0],d=o[1],p=o[2];p*=255;var f=255*d;if(0===d)c=u=l=p;else{360===h&&(h=0),h>360&&(h-=360),h<0&&(h+=360);var m=H(h/=60),g=h-m,_=p*(1-d),v=_+f*(1-g),y=_+f*g,b=_+f;switch(m){case 0:c=(t=[b,y,_])[0],u=t[1],l=t[2];break;case 1:c=(e=[v,b,_])[0],u=e[1],l=e[2];break;case 2:c=(n=[_,b,y])[0],u=n[1],l=n[2];break;case 3:c=(s=[_,v,b])[0],u=s[1],l=s[2];break;case 4:c=(i=[y,_,b])[0],u=i[1],l=i[2];break;case 5:c=(r=[b,_,v])[0],u=r[1],l=r[2]}}return[c,u,l,o.length>3?o[3]:1]},J=a.unpack,K=a.type;p.prototype.hcg=function(){return X(this._rgb)},m.hcg=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["hcg"])))},c.format.hcg=Q,c.autodetect.push({p:1,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=J(t,"hcg"),"array"===K(t)&&3===t.length)return"hcg"}});var tt=a.unpack,et=a.last,nt=Math.round,st=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=tt(t,"rgba"),s=n[0],i=n[1],r=n[2],o=n[3],a=et(t)||"auto";void 0===o&&(o=1),"auto"===a&&(a=o<1?"rgba":"rgb");var c=(s=nt(s))<<16|(i=nt(i))<<8|(r=nt(r)),u="000000"+c.toString(16);u=u.substr(u.length-6);var l="0"+nt(255*o).toString(16);switch(l=l.substr(l.length-2),a.toLowerCase()){case"rgba":return"#"+u+l;case"argb":return"#"+l+u;default:return"#"+u}},it=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,rt=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,ot=function(t){if(t.match(it)){4!==t.length&&7!==t.length||(t=t.substr(1)),3===t.length&&(t=(t=t.split(""))[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=parseInt(t,16);return[e>>16,e>>8&255,255&e,1]}if(t.match(rt)){5!==t.length&&9!==t.length||(t=t.substr(1)),4===t.length&&(t=(t=t.split(""))[0]+t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);var n=parseInt(t,16);return[n>>24&255,n>>16&255,n>>8&255,Math.round((255&n)/255*100)/100]}throw new Error("unknown hex color: "+t)},at=a.type;p.prototype.hex=function(t){return st(this._rgb,t)},m.hex=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["hex"])))},c.format.hex=ot,c.autodetect.push({p:4,test:function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(!e.length&&"string"===at(t)&&[3,4,5,6,7,8,9].indexOf(t.length)>=0)return"hex"}});var ct=a.unpack,ut=a.TWOPI,lt=Math.min,ht=Math.sqrt,dt=Math.acos,pt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n,s=ct(t,"rgb"),i=s[0],r=s[1],o=s[2],a=lt(i/=255,r/=255,o/=255),c=(i+r+o)/3,u=c>0?1-a/c:0;return 0===u?n=NaN:(n=(i-r+(i-o))/2,n/=ht((i-r)*(i-r)+(i-o)*(r-o)),n=dt(n),o>r&&(n=ut-n),n/=ut),[360*n,u,c]},ft=a.unpack,mt=a.limit,gt=a.TWOPI,_t=a.PITHIRD,vt=Math.cos,yt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n,s,i,r=(t=ft(t,"hsi"))[0],o=t[1],a=t[2];return isNaN(r)&&(r=0),isNaN(o)&&(o=0),r>360&&(r-=360),r<0&&(r+=360),(r/=360)<1/3?s=1-((i=(1-o)/3)+(n=(1+o*vt(gt*r)/vt(_t-gt*r))/3)):r<2/3?i=1-((n=(1-o)/3)+(s=(1+o*vt(gt*(r-=1/3))/vt(_t-gt*r))/3)):n=1-((s=(1-o)/3)+(i=(1+o*vt(gt*(r-=2/3))/vt(_t-gt*r))/3)),[255*(n=mt(a*n*3)),255*(s=mt(a*s*3)),255*(i=mt(a*i*3)),t.length>3?t[3]:1]},bt=a.unpack,wt=a.type;p.prototype.hsi=function(){return pt(this._rgb)},m.hsi=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["hsi"])))},c.format.hsi=yt,c.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=bt(t,"hsi"),"array"===wt(t)&&3===t.length)return"hsi"}});var xt=a.unpack,Tt=a.type;p.prototype.hsl=function(){return O(this._rgb)},m.hsl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["hsl"])))},c.format.hsl=V,c.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=xt(t,"hsl"),"array"===Tt(t)&&3===t.length)return"hsl"}});var Ct=a.unpack,kt=Math.min,At=Math.max,St=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n,s,i,r=(t=Ct(t,"rgb"))[0],o=t[1],a=t[2],c=kt(r,o,a),u=At(r,o,a),l=u-c;return i=u/255,0===u?(n=Number.NaN,s=0):(s=l/u,r===u&&(n=(o-a)/l),o===u&&(n=2+(a-r)/l),a===u&&(n=4+(r-o)/l),(n*=60)<0&&(n+=360)),[n,s,i]},Ot=a.unpack,Mt=Math.floor,Et=function(){for(var t,e,n,s,i,r,o=[],a=arguments.length;a--;)o[a]=arguments[a];var c,u,l,h=(o=Ot(o,"hsv"))[0],d=o[1],p=o[2];if(p*=255,0===d)c=u=l=p;else{360===h&&(h=0),h>360&&(h-=360),h<0&&(h+=360);var f=Mt(h/=60),m=h-f,g=p*(1-d),_=p*(1-d*m),v=p*(1-d*(1-m));switch(f){case 0:c=(t=[p,v,g])[0],u=t[1],l=t[2];break;case 1:c=(e=[_,p,g])[0],u=e[1],l=e[2];break;case 2:c=(n=[g,p,v])[0],u=n[1],l=n[2];break;case 3:c=(s=[g,_,p])[0],u=s[1],l=s[2];break;case 4:c=(i=[v,g,p])[0],u=i[1],l=i[2];break;case 5:c=(r=[p,g,_])[0],u=r[1],l=r[2]}}return[c,u,l,o.length>3?o[3]:1]},Dt=a.unpack,It=a.type;p.prototype.hsv=function(){return St(this._rgb)},m.hsv=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["hsv"])))},c.format.hsv=Et,c.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=Dt(t,"hsv"),"array"===It(t)&&3===t.length)return"hsv"}});var Nt=18,Rt=.95047,Vt=1,Pt=1.08883,qt=.137931034,Ft=.206896552,jt=.12841855,Lt=.008856452,$t=a.unpack,Bt=Math.pow,Wt=function(t){return(t/=255)<=.04045?t/12.92:Bt((t+.055)/1.055,2.4)},Ut=function(t){return t>Lt?Bt(t,1/3):t/jt+qt},zt=function(t,e,n){return t=Wt(t),e=Wt(e),n=Wt(n),[Ut((.4124564*t+.3575761*e+.1804375*n)/Rt),Ut((.2126729*t+.7151522*e+.072175*n)/Vt),Ut((.0193339*t+.119192*e+.9503041*n)/Pt)]},Gt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=$t(t,"rgb"),s=n[0],i=n[1],r=n[2],o=zt(s,i,r),a=o[0],c=o[1],u=o[2],l=116*c-16;return[l<0?0:l,500*(a-c),200*(c-u)]},Yt=a.unpack,Xt=Math.pow,Zt=function(t){return 255*(t<=.00304?12.92*t:1.055*Xt(t,1/2.4)-.055)},Ht=function(t){return t>Ft?t*t*t:jt*(t-qt)},Qt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n,s,i,r=(t=Yt(t,"lab"))[0],o=t[1],a=t[2];return s=(r+16)/116,n=isNaN(o)?s:s+o/500,i=isNaN(a)?s:s-a/200,s=Vt*Ht(s),n=Rt*Ht(n),i=Pt*Ht(i),[Zt(3.2404542*n-1.5371385*s-.4985314*i),Zt(-.969266*n+1.8760108*s+.041556*i),Zt(.0556434*n-.2040259*s+1.0572252*i),t.length>3?t[3]:1]},Jt=a.unpack,Kt=a.type;p.prototype.lab=function(){return Gt(this._rgb)},m.lab=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["lab"])))},c.format.lab=Qt,c.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=Jt(t,"lab"),"array"===Kt(t)&&3===t.length)return"lab"}});var te=a.unpack,ee=a.RAD2DEG,ne=Math.sqrt,se=Math.atan2,ie=Math.round,re=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=te(t,"lab"),s=n[0],i=n[1],r=n[2],o=ne(i*i+r*r),a=(se(r,i)*ee+360)%360;return 0===ie(1e4*o)&&(a=Number.NaN),[s,o,a]},oe=a.unpack,ae=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=oe(t,"rgb"),s=n[0],i=n[1],r=n[2],o=Gt(s,i,r),a=o[0],c=o[1],u=o[2];return re(a,c,u)},ce=a.unpack,ue=a.DEG2RAD,le=Math.sin,he=Math.cos,de=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=ce(t,"lch"),s=n[0],i=n[1],r=n[2];return isNaN(r)&&(r=0),[s,he(r*=ue)*i,le(r)*i]},pe=a.unpack,fe=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=(t=pe(t,"lch"))[0],s=t[1],i=t[2],r=de(n,s,i),o=r[0],a=r[1],c=r[2],u=Qt(o,a,c),l=u[0],h=u[1],d=u[2];return[l,h,d,t.length>3?t[3]:1]},me=a.unpack,ge=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=me(t,"hcl").reverse();return fe.apply(void 0,n)},_e=a.unpack,ve=a.type;p.prototype.lch=function(){return ae(this._rgb)},p.prototype.hcl=function(){return ae(this._rgb).reverse()},m.lch=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["lch"])))},m.hcl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["hcl"])))},c.format.lch=fe,c.format.hcl=ge,["lch","hcl"].forEach((function(t){return c.autodetect.push({p:2,test:function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(e=_e(e,t),"array"===ve(e)&&3===e.length)return t}})}));var ye={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},be=a.type;p.prototype.name=function(){for(var t=st(this._rgb,"rgb"),e=0,n=Object.keys(ye);e<n.length;e+=1){var s=n[e];if(ye[s]===t)return s.toLowerCase()}return t},c.format.named=function(t){if(t=t.toLowerCase(),ye[t])return ot(ye[t]);throw new Error("unknown color name: "+t)},c.autodetect.push({p:5,test:function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(!e.length&&"string"===be(t)&&ye[t.toLowerCase()])return"named"}});var we=a.unpack,xe=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=we(t,"rgb"),s=n[0],i=n[1],r=n[2];return(s<<16)+(i<<8)+r},Te=a.type,Ce=function(t){if("number"==Te(t)&&t>=0&&t<=16777215)return[t>>16,t>>8&255,255&t,1];throw new Error("unknown num color: "+t)},ke=a.type;p.prototype.num=function(){return xe(this._rgb)},m.num=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["num"])))},c.format.num=Ce,c.autodetect.push({p:5,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(1===t.length&&"number"===ke(t[0])&&t[0]>=0&&t[0]<=16777215)return"num"}});var Ae=a.unpack,Se=a.type,Oe=Math.round;p.prototype.rgb=function(t){return void 0===t&&(t=!0),!1===t?this._rgb.slice(0,3):this._rgb.slice(0,3).map(Oe)},p.prototype.rgba=function(t){return void 0===t&&(t=!0),this._rgb.slice(0,4).map((function(e,n){return n<3?!1===t?e:Oe(e):e}))},m.rgb=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["rgb"])))},c.format.rgb=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=Ae(t,"rgba");return void 0===n[3]&&(n[3]=1),n},c.autodetect.push({p:3,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=Ae(t,"rgba"),"array"===Se(t)&&(3===t.length||4===t.length&&"number"==Se(t[3])&&t[3]>=0&&t[3]<=1))return"rgb"}});var Me=Math.log,Ee=function(t){var e,n,s,i=t/100;return i<66?(e=255,n=-155.25485562709179-.44596950469579133*(n=i-2)+104.49216199393888*Me(n),s=i<20?0:.8274096064007395*(s=i-10)-254.76935184120902+115.67994401066147*Me(s)):(e=351.97690566805693+.114206453784165*(e=i-55)-40.25366309332127*Me(e),n=325.4494125711974+.07943456536662342*(n=i-50)-28.0852963507957*Me(n),s=255),[e,n,s,1]},De=a.unpack,Ie=Math.round,Ne=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var n,s=De(t,"rgb"),i=s[0],r=s[2],o=1e3,a=4e4,c=.4;a-o>c;){var u=Ee(n=.5*(a+o));u[2]/u[0]>=r/i?a=n:o=n}return Ie(n)};p.prototype.temp=p.prototype.kelvin=p.prototype.temperature=function(){return Ne(this._rgb)},m.temp=m.kelvin=m.temperature=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(p,[null].concat(t,["temp"])))},c.format.temp=c.format.kelvin=c.format.temperature=Ee;var Re=a.type;p.prototype.alpha=function(t,e){return void 0===e&&(e=!1),void 0!==t&&"number"===Re(t)?e?(this._rgb[3]=t,this):new p([this._rgb[0],this._rgb[1],this._rgb[2],t],"rgb"):this._rgb[3]},p.prototype.clipped=function(){return this._rgb._clipped||!1},p.prototype.darken=function(t){void 0===t&&(t=1);var e=this.lab();return e[0]-=Nt*t,new p(e,"lab").alpha(this.alpha(),!0)},p.prototype.brighten=function(t){return void 0===t&&(t=1),this.darken(-t)},p.prototype.darker=p.prototype.darken,p.prototype.brighter=p.prototype.brighten,p.prototype.get=function(t){var e=t.split("."),n=e[0],s=e[1],i=this[n]();if(s){var r=n.indexOf(s);if(r>-1)return i[r];throw new Error("unknown channel "+s+" in mode "+n)}return i};var Ve=a.type,Pe=Math.pow;p.prototype.luminance=function(t){if(void 0!==t&&"number"===Ve(t)){if(0===t)return new p([0,0,0,this._rgb[3]],"rgb");if(1===t)return new p([255,255,255,this._rgb[3]],"rgb");var e=this.luminance(),n=20,s=function(e,i){var r=e.interpolate(i,.5,"rgb"),o=r.luminance();return Math.abs(t-o)<1e-7||!n--?r:o>t?s(e,r):s(r,i)},i=(e>t?s(new p([0,0,0]),this):s(this,new p([255,255,255]))).rgb();return new p(i.concat([this._rgb[3]]))}return qe.apply(void 0,this._rgb.slice(0,3))};var qe=function(t,e,n){return.2126*(t=Fe(t))+.7152*(e=Fe(e))+.0722*(n=Fe(n))},Fe=function(t){return(t/=255)<=.03928?t/12.92:Pe((t+.055)/1.055,2.4)},je={},Le=a.type,$e=function(t,e,n){void 0===n&&(n=.5);for(var s=[],i=arguments.length-3;i-- >0;)s[i]=arguments[i+3];var r=s[0]||"lrgb";if(je[r]||s.length||(r=Object.keys(je)[0]),!je[r])throw new Error("interpolation mode "+r+" is not defined");return"object"!==Le(t)&&(t=new p(t)),"object"!==Le(e)&&(e=new p(e)),je[r](t,e,n).alpha(t.alpha()+n*(e.alpha()-t.alpha()))};p.prototype.mix=p.prototype.interpolate=function(t,e){void 0===e&&(e=.5);for(var n=[],s=arguments.length-2;s-- >0;)n[s]=arguments[s+2];return $e.apply(void 0,[this,t,e].concat(n))},p.prototype.premultiply=function(t){void 0===t&&(t=!1);var e=this._rgb,n=e[3];return t?(this._rgb=[e[0]*n,e[1]*n,e[2]*n,n],this):new p([e[0]*n,e[1]*n,e[2]*n,n],"rgb")},p.prototype.saturate=function(t){void 0===t&&(t=1);var e=this.lch();return e[1]+=Nt*t,e[1]<0&&(e[1]=0),new p(e,"lch").alpha(this.alpha(),!0)},p.prototype.desaturate=function(t){return void 0===t&&(t=1),this.saturate(-t)};var Be=a.type;p.prototype.set=function(t,e,n){void 0===n&&(n=!1);var s=t.split("."),i=s[0],r=s[1],o=this[i]();if(r){var a=i.indexOf(r);if(a>-1){if("string"==Be(e))switch(e.charAt(0)){case"+":case"-":o[a]+=+e;break;case"*":o[a]*=+e.substr(1);break;case"/":o[a]/=+e.substr(1);break;default:o[a]=+e}else{if("number"!==Be(e))throw new Error("unsupported value for Color.set");o[a]=e}var c=new p(o,i);return n?(this._rgb=c._rgb,this):c}throw new Error("unknown channel "+r+" in mode "+i)}return o},je.rgb=function(t,e,n){var s=t._rgb,i=e._rgb;return new p(s[0]+n*(i[0]-s[0]),s[1]+n*(i[1]-s[1]),s[2]+n*(i[2]-s[2]),"rgb")};var We=Math.sqrt,Ue=Math.pow;je.lrgb=function(t,e,n){var s=t._rgb,i=s[0],r=s[1],o=s[2],a=e._rgb,c=a[0],u=a[1],l=a[2];return new p(We(Ue(i,2)*(1-n)+Ue(c,2)*n),We(Ue(r,2)*(1-n)+Ue(u,2)*n),We(Ue(o,2)*(1-n)+Ue(l,2)*n),"rgb")},je.lab=function(t,e,n){var s=t.lab(),i=e.lab();return new p(s[0]+n*(i[0]-s[0]),s[1]+n*(i[1]-s[1]),s[2]+n*(i[2]-s[2]),"lab")};var ze=function(t,e,n,s){var i,r,o,a,c,u,l,h,d,f,m,g;return"hsl"===s?(o=t.hsl(),a=e.hsl()):"hsv"===s?(o=t.hsv(),a=e.hsv()):"hcg"===s?(o=t.hcg(),a=e.hcg()):"hsi"===s?(o=t.hsi(),a=e.hsi()):"lch"!==s&&"hcl"!==s||(s="hcl",o=t.hcl(),a=e.hcl()),"h"===s.substr(0,1)&&(c=(i=o)[0],l=i[1],d=i[2],u=(r=a)[0],h=r[1],f=r[2]),isNaN(c)||isNaN(u)?isNaN(c)?isNaN(u)?g=Number.NaN:(g=u,1!=d&&0!=d||"hsv"==s||(m=h)):(g=c,1!=f&&0!=f||"hsv"==s||(m=l)):g=c+n*(u>c&&u-c>180?u-(c+360):u<c&&c-u>180?u+360-c:u-c),void 0===m&&(m=l+n*(h-l)),new p([g,m,d+n*(f-d)],s)},Ge=function(t,e,n){return ze(t,e,n,"lch")};je.lch=Ge,je.hcl=Ge,je.num=function(t,e,n){var s=t.num(),i=e.num();return new p(s+n*(i-s),"num")},je.hcg=function(t,e,n){return ze(t,e,n,"hcg")},je.hsi=function(t,e,n){return ze(t,e,n,"hsi")},je.hsl=function(t,e,n){return ze(t,e,n,"hsl")},je.hsv=function(t,e,n){return ze(t,e,n,"hsv")};var Ye=a.clip_rgb,Xe=Math.pow,Ze=Math.sqrt,He=Math.PI,Qe=Math.cos,Je=Math.sin,Ke=Math.atan2,tn=function(t,e){for(var n=t.length,s=[0,0,0,0],i=0;i<t.length;i++){var r=t[i],o=e[i]/n,a=r._rgb;s[0]+=Xe(a[0],2)*o,s[1]+=Xe(a[1],2)*o,s[2]+=Xe(a[2],2)*o,s[3]+=a[3]*o}return s[0]=Ze(s[0]),s[1]=Ze(s[1]),s[2]=Ze(s[2]),s[3]>.9999999&&(s[3]=1),new p(Ye(s))},en=a.type,nn=Math.pow,sn=function(t){var e="rgb",n=m("#ccc"),s=0,i=[0,1],r=[],o=[0,0],a=!1,c=[],u=!1,l=0,h=1,d=!1,p={},f=!0,g=1,_=function(t){if((t=t||["#fff","#000"])&&"string"===en(t)&&m.brewer&&m.brewer[t.toLowerCase()]&&(t=m.brewer[t.toLowerCase()]),"array"===en(t)){1===t.length&&(t=[t[0],t[0]]),t=t.slice(0);for(var e=0;e<t.length;e++)t[e]=m(t[e]);r.length=0;for(var n=0;n<t.length;n++)r.push(n/(t.length-1))}return w(),c=t},v=function(t){return t},y=function(t){return t},b=function(t,s){var i,u;if(null==s&&(s=!1),isNaN(t)||null===t)return n;u=s?t:a&&a.length>2?function(t){if(null!=a){for(var e=a.length-1,n=0;n<e&&t>=a[n];)n++;return n-1}return 0}(t)/(a.length-2):h!==l?(t-l)/(h-l):1,u=y(u),s||(u=v(u)),1!==g&&(u=nn(u,g)),u=o[0]+u*(1-o[0]-o[1]),u=Math.min(1,Math.max(0,u));var d=Math.floor(1e4*u);if(f&&p[d])i=p[d];else{if("array"===en(c))for(var _=0;_<r.length;_++){var b=r[_];if(u<=b){i=c[_];break}if(u>=b&&_===r.length-1){i=c[_];break}if(u>b&&u<r[_+1]){u=(u-b)/(r[_+1]-b),i=m.interpolate(c[_],c[_+1],u,e);break}}else"function"===en(c)&&(i=c(u));f&&(p[d]=i)}return i},w=function(){return p={}};_(t);var x=function(t){var e=m(b(t));return u&&e[u]?e[u]():e};return x.classes=function(t){if(null!=t){if("array"===en(t))a=t,i=[t[0],t[t.length-1]];else{var e=m.analyze(i);a=0===t?[e.min,e.max]:m.limits(e,"e",t)}return x}return a},x.domain=function(t){if(!arguments.length)return i;l=t[0],h=t[t.length-1],r=[];var e=c.length;if(t.length===e&&l!==h)for(var n=0,s=Array.from(t);n<s.length;n+=1){var o=s[n];r.push((o-l)/(h-l))}else{for(var a=0;a<e;a++)r.push(a/(e-1));if(t.length>2){var u=t.map((function(e,n){return n/(t.length-1)})),d=t.map((function(t){return(t-l)/(h-l)}));d.every((function(t,e){return u[e]===t}))||(y=function(t){if(t<=0||t>=1)return t;for(var e=0;t>=d[e+1];)e++;var n=(t-d[e])/(d[e+1]-d[e]);return u[e]+n*(u[e+1]-u[e])})}}return i=[l,h],x},x.mode=function(t){return arguments.length?(e=t,w(),x):e},x.range=function(t,e){return _(t),x},x.out=function(t){return u=t,x},x.spread=function(t){return arguments.length?(s=t,x):s},x.correctLightness=function(t){return null==t&&(t=!0),d=t,w(),v=d?function(t){for(var e=b(0,!0).lab()[0],n=b(1,!0).lab()[0],s=e>n,i=b(t,!0).lab()[0],r=e+(n-e)*t,o=i-r,a=0,c=1,u=20;Math.abs(o)>.01&&u-- >0;)s&&(o*=-1),o<0?(a=t,t+=.5*(c-t)):(c=t,t+=.5*(a-t)),i=b(t,!0).lab()[0],o=i-r;return t}:function(t){return t},x},x.padding=function(t){return null!=t?("number"===en(t)&&(t=[t,t]),o=t,x):o},x.colors=function(e,n){arguments.length<2&&(n="hex");var s=[];if(0===arguments.length)s=c.slice(0);else if(1===e)s=[x(.5)];else if(e>1){var r=i[0],o=i[1]-r;s=rn(0,e,!1).map((function(t){return x(r+t/(e-1)*o)}))}else{t=[];var u=[];if(a&&a.length>2)for(var l=1,h=a.length,d=1<=h;d?l<h:l>h;d?l++:l--)u.push(.5*(a[l-1]+a[l]));else u=i;s=u.map((function(t){return x(t)}))}return m[n]&&(s=s.map((function(t){return t[n]()}))),s},x.cache=function(t){return null!=t?(f=t,x):f},x.gamma=function(t){return null!=t?(g=t,x):g},x.nodata=function(t){return null!=t?(n=m(t),x):n},x};function rn(t,e,n){for(var s=[],i=t<e,r=n?i?e+1:e-1:e,o=t;i?o<r:o>r;i?o++:o--)s.push(o);return s}var on=function(t){var e,n,s,i,r,o,a;if(2===(t=t.map((function(t){return new p(t)}))).length)e=t.map((function(t){return t.lab()})),r=e[0],o=e[1],i=function(t){var e=[0,1,2].map((function(e){return r[e]+t*(o[e]-r[e])}));return new p(e,"lab")};else if(3===t.length)n=t.map((function(t){return t.lab()})),r=n[0],o=n[1],a=n[2],i=function(t){var e=[0,1,2].map((function(e){return(1-t)*(1-t)*r[e]+2*(1-t)*t*o[e]+t*t*a[e]}));return new p(e,"lab")};else if(4===t.length){var c;s=t.map((function(t){return t.lab()})),r=s[0],o=s[1],a=s[2],c=s[3],i=function(t){var e=[0,1,2].map((function(e){return(1-t)*(1-t)*(1-t)*r[e]+3*(1-t)*(1-t)*t*o[e]+3*(1-t)*t*t*a[e]+t*t*t*c[e]}));return new p(e,"lab")}}else if(5===t.length){var u=on(t.slice(0,3)),l=on(t.slice(2,5));i=function(t){return t<.5?u(2*t):l(2*(t-.5))}}return i},an=function(t,e,n){if(!an[n])throw new Error("unknown blend mode "+n);return an[n](t,e)},cn=function(t){return function(e,n){var s=m(n).rgb(),i=m(e).rgb();return m.rgb(t(s,i))}},un=function(t){return function(e,n){var s=[];return s[0]=t(e[0],n[0]),s[1]=t(e[1],n[1]),s[2]=t(e[2],n[2]),s}};an.normal=cn(un((function(t){return t}))),an.multiply=cn(un((function(t,e){return t*e/255}))),an.screen=cn(un((function(t,e){return 255*(1-(1-t/255)*(1-e/255))}))),an.overlay=cn(un((function(t,e){return e<128?2*t*e/255:255*(1-2*(1-t/255)*(1-e/255))}))),an.darken=cn(un((function(t,e){return t>e?e:t}))),an.lighten=cn(un((function(t,e){return t>e?t:e}))),an.dodge=cn(un((function(t,e){return 255===t||(t=e/255*255/(1-t/255))>255?255:t}))),an.burn=cn(un((function(t,e){return 255*(1-(1-e/255)/(t/255))})));for(var ln=an,hn=a.type,dn=a.clip_rgb,pn=a.TWOPI,fn=Math.pow,mn=Math.sin,gn=Math.cos,_n=Math.floor,vn=Math.random,yn=Math.log,bn=Math.pow,wn=Math.floor,xn=Math.abs,Tn=function(t,e){void 0===e&&(e=null);var n={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0};return"object"===r(t)&&(t=Object.values(t)),t.forEach((function(t){e&&"object"===r(t)&&(t=t[e]),null==t||isNaN(t)||(n.values.push(t),n.sum+=t,t<n.min&&(n.min=t),t>n.max&&(n.max=t),n.count+=1)})),n.domain=[n.min,n.max],n.limits=function(t,e){return Cn(n,t,e)},n},Cn=function(t,e,n){void 0===e&&(e="equal"),void 0===n&&(n=7),"array"==r(t)&&(t=Tn(t));var s=t.min,i=t.max,o=t.values.sort((function(t,e){return t-e}));if(1===n)return[s,i];var a=[];if("c"===e.substr(0,1)&&(a.push(s),a.push(i)),"e"===e.substr(0,1)){a.push(s);for(var c=1;c<n;c++)a.push(s+c/n*(i-s));a.push(i)}else if("l"===e.substr(0,1)){if(s<=0)throw new Error("Logarithmic scales are only possible for values > 0");var u=Math.LOG10E*yn(s),l=Math.LOG10E*yn(i);a.push(s);for(var h=1;h<n;h++)a.push(bn(10,u+h/n*(l-u)));a.push(i)}else if("q"===e.substr(0,1)){a.push(s);for(var d=1;d<n;d++){var p=(o.length-1)*d/n,f=wn(p);if(f===p)a.push(o[f]);else{var m=p-f;a.push(o[f]*(1-m)+o[f+1]*m)}}a.push(i)}else if("k"===e.substr(0,1)){var g,_=o.length,v=new Array(_),y=new Array(n),b=!0,w=0,x=null;(x=[]).push(s);for(var T=1;T<n;T++)x.push(s+T/n*(i-s));for(x.push(i);b;){for(var C=0;C<n;C++)y[C]=0;for(var k=0;k<_;k++)for(var A=o[k],S=Number.MAX_VALUE,O=void 0,M=0;M<n;M++){var E=xn(x[M]-A);E<S&&(S=E,O=M),y[O]++,v[k]=O}for(var D=new Array(n),I=0;I<n;I++)D[I]=null;for(var N=0;N<_;N++)null===D[g=v[N]]?D[g]=o[N]:D[g]+=o[N];for(var R=0;R<n;R++)D[R]*=1/y[R];b=!1;for(var V=0;V<n;V++)if(D[V]!==x[V]){b=!0;break}x=D,++w>200&&(b=!1)}for(var P={},q=0;q<n;q++)P[q]=[];for(var F=0;F<_;F++)P[g=v[F]].push(o[F]);for(var j=[],L=0;L<n;L++)j.push(P[L][0]),j.push(P[L][P[L].length-1]);j=j.sort((function(t,e){return t-e})),a.push(j[0]);for(var $=1;$<j.length;$+=2){var B=j[$];isNaN(B)||-1!==a.indexOf(B)||a.push(B)}}return a},kn={analyze:Tn,limits:Cn},An=Math.sqrt,Sn=Math.atan2,On=Math.abs,Mn=Math.cos,En=Math.PI,Dn={cool:function(){return sn([m.hsl(180,1,.9),m.hsl(250,.7,.4)])},hot:function(){return sn(["#000","#f00","#ff0","#fff"]).mode("rgb")}},In={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Nn=0,Rn=Object.keys(In);Nn<Rn.length;Nn+=1){var Vn=Rn[Nn];In[Vn.toLowerCase()]=In[Vn]}var Pn=In;return m.average=function(t,e,n){void 0===e&&(e="lrgb"),void 0===n&&(n=null);var s=t.length;n||(n=Array.from(new Array(s)).map((function(){return 1})));var i=s/n.reduce((function(t,e){return t+e}));if(n.forEach((function(t,e){n[e]*=i})),t=t.map((function(t){return new p(t)})),"lrgb"===e)return tn(t,n);for(var r=t.shift(),o=r.get(e),a=[],c=0,u=0,l=0;l<o.length;l++)if(o[l]=(o[l]||0)*n[0],a.push(isNaN(o[l])?0:n[0]),"h"===e.charAt(l)&&!isNaN(o[l])){var h=o[l]/180*He;c+=Qe(h)*n[0],u+=Je(h)*n[0]}var d=r.alpha()*n[0];t.forEach((function(t,s){var i=t.get(e);d+=t.alpha()*n[s+1];for(var r=0;r<o.length;r++)if(!isNaN(i[r]))if(a[r]+=n[s+1],"h"===e.charAt(r)){var l=i[r]/180*He;c+=Qe(l)*n[s+1],u+=Je(l)*n[s+1]}else o[r]+=i[r]*n[s+1]}));for(var f=0;f<o.length;f++)if("h"===e.charAt(f)){for(var m=Ke(u/a[f],c/a[f])/He*180;m<0;)m+=360;for(;m>=360;)m-=360;o[f]=m}else o[f]=o[f]/a[f];return d/=s,new p(o,e).alpha(d>.99999?1:d,!0)},m.bezier=function(t){var e=on(t);return e.scale=function(){return sn(e)},e},m.blend=ln,m.cubehelix=function(t,e,n,s,i){void 0===t&&(t=300),void 0===e&&(e=-1.5),void 0===n&&(n=1),void 0===s&&(s=1),void 0===i&&(i=[0,1]);var r,o=0;"array"===hn(i)?r=i[1]-i[0]:(r=0,i=[i,i]);var a=function(a){var c=pn*((t+120)/360+e*a),u=fn(i[0]+r*a,s),l=(0!==o?n[0]+a*o:n)*u*(1-u)/2,h=gn(c),d=mn(c);return m(dn([255*(u+l*(-.14861*h+1.78277*d)),255*(u+l*(-.29227*h-.90649*d)),255*(u+l*(1.97294*h)),1]))};return a.start=function(e){return null==e?t:(t=e,a)},a.rotations=function(t){return null==t?e:(e=t,a)},a.gamma=function(t){return null==t?s:(s=t,a)},a.hue=function(t){return null==t?n:("array"===hn(n=t)?0==(o=n[1]-n[0])&&(n=n[1]):o=0,a)},a.lightness=function(t){return null==t?i:("array"===hn(t)?(i=t,r=t[1]-t[0]):(i=[t,t],r=0),a)},a.scale=function(){return m.scale(a)},a.hue(n),a},m.mix=m.interpolate=$e,m.random=function(){for(var t="#",e=0;e<6;e++)t+="0123456789abcdef".charAt(_n(16*vn()));return new p(t,"hex")},m.scale=sn,m.analyze=kn.analyze,m.contrast=function(t,e){t=new p(t),e=new p(e);var n=t.luminance(),s=e.luminance();return n>s?(n+.05)/(s+.05):(s+.05)/(n+.05)},m.deltaE=function(t,e,n,s){void 0===n&&(n=1),void 0===s&&(s=1),t=new p(t),e=new p(e);for(var i=Array.from(t.lab()),r=i[0],o=i[1],a=i[2],c=Array.from(e.lab()),u=c[0],l=c[1],h=c[2],d=An(o*o+a*a),f=An(l*l+h*h),m=r<16?.511:.040975*r/(1+.01765*r),g=.0638*d/(1+.0131*d)+.638,_=d<1e-6?0:180*Sn(a,o)/En;_<0;)_+=360;for(;_>=360;)_-=360;var v=_>=164&&_<=345?.56+On(.2*Mn(En*(_+168)/180)):.36+On(.4*Mn(En*(_+35)/180)),y=d*d*d*d,b=An(y/(y+1900)),w=g*(b*v+1-b),x=d-f,T=o-l,C=a-h,k=(r-u)/(n*m),A=x/(s*g);return An(k*k+A*A+(T*T+C*C-x*x)/(w*w))},m.distance=function(t,e,n){void 0===n&&(n="lab"),t=new p(t),e=new p(e);var s=t.get(n),i=e.get(n),r=0;for(var o in s){var a=(s[o]||0)-(i[o]||0);r+=a*a}return Math.sqrt(r)},m.limits=kn.limits,m.valid=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];try{return new(Function.prototype.bind.apply(p,[null].concat(t))),!0}catch(t){return!1}},m.scales=Dn,m.colors=ye,m.brewer=Pn,m}()})),At=z((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(Z),s=o(ct),i=o(Ct),r=o(kt);function o(t){return t&&t.__esModule?t:{default:t}}function a(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i,r=!0,o=!1;return{s:function(){s=t[Symbol.iterator]()},n:function(){var t=s.next();return r=t.done,t},e:function(t){o=!0,i=t},f:function(){try{r||null==s.return||s.return()}finally{if(o)throw i}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){h(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var d={count:5,hueMin:0,hueMax:360,chromaMin:0,chromaMax:100,lightMin:0,lightMax:100,quality:50,samples:800},p=function(t,e){for(var n=Number.MAX_SAFE_INTEGER,s=0,i=0;i<t.length;i+=1){var r=t[i],o=Math.sqrt(Math.pow(Math.abs(r[0]-e[0]),2)+Math.pow(Math.abs(r[1]-e[1]),2)+Math.pow(Math.abs(r[2]-e[2]),2));o<n&&(n=o,s=i)}return s},f=function(t,e){var n=r.default.lab(t),s=n.hcl(),i=n.rgb(),o=r.default.rgb(i).lab();return s[0]>=e.hueMin&&s[0]<=e.hueMax&&s[1]>=e.chromaMin&&s[1]<=e.chromaMax&&s[2]>=e.lightMin&&s[2]<=e.lightMax&&o[0]>=t[0]-2&&o[0]<=t[0]+2&&o[1]>=t[1]-2&&o[1]<=t[1]+2&&o[2]>=t[2]-2&&o[2]<=t[2]+2},m=function(t){for(var e=t.slice(0),n=[e.shift()];e.length>0;){for(var s=n[n.length-1],i=0,r=Number.MIN_SAFE_INTEGER,o=0;o<e.length;o+=1){var a=Math.sqrt(Math.pow(Math.abs(s[0]-e[o][0]),2)+Math.pow(Math.abs(s[1]-e[o][1]),2)+Math.pow(Math.abs(s[2]-e[o][2]),2));a>r&&(r=a,i=o)}n.push(e.splice(i,1)[0])}return n},g=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=l({},d,{},t);if(e.count<=0)return[];e.samples<3*e.count&&(e.samples=Math.ceil(3*e.count));var o=[],c=[],u=new Set,h=Math.ceil(Math.cbrt(e.samples)),g=(e.hueMax-e.hueMin)/h,_=(e.chromaMax-e.chromaMin)/h,v=(e.lightMax-e.lightMin)/h;if(g<=0)throw new Error("hueMax must be greater than hueMin!");if(_<=0)throw new Error("chromaMax must be greater than chromaMin!");if(v<=0)throw new Error("lightMax must be greater than lightMin!");for(var y=e.hueMin+g/2;y<=e.hueMax;y+=g)for(var b=e.chromaMin+_/2;b<=e.chromaMax;b+=_)for(var w=e.lightMin+v/2;w<=e.lightMax;w+=v){var x=r.default.hcl(y,b,w).lab();f(x,e)&&u.add(x.toString())}if((u=(u=Array.from(u)).map((function(t){return t.split(",").map((function(t){return parseFloat(t)}))}))).length<e.count)throw new Error("Not enough samples to generate palette, increase sample count.");for(var T=Math.floor(u.length/e.count),C=0;C<u.length&&(o.push(u[C]),c.push([]),!(o.length>=e.count));C+=T);for(var k=1;k<=e.quality;k+=1){for(var A=(0,s.default)(c),S=(0,s.default)(u),O=0;O<o.length;O+=1){var M=p(S,o[O]);A[O].push(S[M]),S.splice(M,1)}for(var E=0;E<S.length;E+=1){var D=u[E],I=p(o,D);A[I].push(u[E])}for(var N=(0,s.default)(o),R=0;R<A.length;R+=1){var V,P=A[R],q=P.length,F=[],j=[],L=[],$=a(P);try{for($.s();!(V=$.n()).done;){var B=V.value;F.push(B[0]),j.push(B[1]),L.push(B[2])}}catch(t){$.e(t)}finally{$.f()}var W=n.default.sum(F)/q,U=n.default.sum(j)/q,z=n.default.sum(L)/q;o[R]=[W,U,z]}if((0,i.default)(N,o))break}return(o=m(o)).map((function(t){return r.default.lab(t)}))};e.default=g}));const St=[4376934,15417910,4773333,30194,16777090,14511682,2511659,10974882,16770516,1635584];class Ot{constructor(t){if(t>St.length){let e=At.hasOwnProperty("default")?At.default:At;this.extras=e({count:t-St.length,hueMin:100})}}trackColour(t){if(t<0||t!==Math.floor(t))throw new Error("track must be a positive integer");return t<St.length?St[t]:parseInt(this.extras[t-St.length].hex().slice(1),16)}hex(t){return"#"+this.trackColour(t).toString(16)}}function Mt(t,e){switch(t){case X.active:return"#38A3FA";case X.highlighted:return e?"#104979":"#dceefd";default:return e?"#000000":"#ffffff"}}function Et(t){let e,n,d;return{c(){e=s("div"),this.h()},l(t){e=i(t,"DIV",{class:!0}),r(e).forEach(o),this.h()},h(){a(e,"class","svelte-1ea0sjj")},m(s,i){c(s,e,i),n||(d=[u(e,"mousedown",t[0]),u(e,"mouseup",t[1]),u(e,"mouseleave",t[2]),u(e,"touchstart",t[3]),u(e,"touchend",t[4],{passive:!0})],n=!0)},p:l,i:l,o:l,d(t){t&&o(e),n=!1,h(d)}}}function Dt(t,e,n){let{active:s}=e,i=!1;return t.$$set=t=>{"active"in t&&n(5,s=t.active)},[function(){i?i=!1:n(5,s=!0)},function(){n(5,s=!1)},function(){n(5,s=!1)},function(t){t.preventDefault(),n(5,s=!0),i=!0},function(){n(5,s=!1)},s]}class It extends t{constructor(t){super(),e(this,t,Dt,Et,n,{active:5})}}function Nt(t){let e,n,u,l,h,M,E,D;function I(e){t[5](e)}let N={};return void 0!==t[3]&&(N.active=t[3]),n=new It({props:N}),d.push(()=>p(n,"active",I)),{c(){e=s("div"),f(n.$$.fragment),l=m(),h=s("p"),M=g(t[1]),this.h()},l(s){e=i(s,"DIV",{class:!0,style:!0});var a=r(e);_(n.$$.fragment,a),l=v(a),h=i(a,"P",{class:!0});var c=r(h);M=y(c,t[1]),c.forEach(o),a.forEach(o),this.h()},h(){a(h,"class","svelte-57gw3v"),a(e,"class",E=b(t[2]?"used":"")+" svelte-57gw3v"),w(e,"--color",Mt(t[0],!0))},m(t,s){c(t,e,s),x(n,e,null),T(e,l),T(e,h),T(h,M),D=!0},p(t,[s]){const i={};!u&&8&s&&(u=!0,i.active=t[3],C(()=>u=!1)),n.$set(i),(!D||2&s)&&k(M,t[1]),(!D||4&s&&E!==(E=b(t[2]?"used":"")+" svelte-57gw3v"))&&a(e,"class",E),(!D||1&s)&&w(e,"--color",Mt(t[0],!0))},i(t){D||(A(n.$$.fragment,t),D=!0)},o(t){S(n.$$.fragment,t),D=!1},d(t){t&&o(e),O(n)}}}function Rt(t,e,n){let s,{state:i}=e,{note:r}=e,{label:o=""}=e,{used:a=!1}=e;const c=M();return t.$$set=t=>{"state"in t&&n(0,i=t.state),"note"in t&&n(4,r=t.note),"label"in t&&n(1,o=t.label),"used"in t&&n(2,a=t.used)},t.$$.update=()=>{24&t.$$.dirty&&c(s?"noteOn":"noteOff",r)},[i,o,a,s,r,function(t){s=t,n(3,s)}]}class Vt extends t{constructor(t){super(),e(this,t,Rt,Nt,n,{state:0,note:4,label:1,used:2})}}function Pt(t){let e,n,u,l,h,M,E,D;function I(e){t[5](e)}let N={};return void 0!==t[3]&&(N.active=t[3]),n=new It({props:N}),d.push(()=>p(n,"active",I)),{c(){e=s("div"),f(n.$$.fragment),l=m(),h=s("p"),M=g(t[1]),this.h()},l(s){e=i(s,"DIV",{class:!0,style:!0});var a=r(e);_(n.$$.fragment,a),l=v(a),h=i(a,"P",{class:!0});var c=r(h);M=y(c,t[1]),c.forEach(o),a.forEach(o),this.h()},h(){a(h,"class","svelte-wxt78t"),a(e,"class",E=b(t[2]?"used":"")+" svelte-wxt78t"),w(e,"--color",Mt(t[0],!1))},m(t,s){c(t,e,s),x(n,e,null),T(e,l),T(e,h),T(h,M),D=!0},p(t,[s]){const i={};!u&&8&s&&(u=!0,i.active=t[3],C(()=>u=!1)),n.$set(i),(!D||2&s)&&k(M,t[1]),(!D||4&s&&E!==(E=b(t[2]?"used":"")+" svelte-wxt78t"))&&a(e,"class",E),(!D||1&s)&&w(e,"--color",Mt(t[0],!1))},i(t){D||(A(n.$$.fragment,t),D=!0)},o(t){S(n.$$.fragment,t),D=!1},d(t){t&&o(e),O(n)}}}function qt(t,e,n){let s,{state:i}=e,{note:r}=e,{label:o=""}=e,{used:a=!1}=e;const c=M();return t.$$set=t=>{"state"in t&&n(0,i=t.state),"note"in t&&n(4,r=t.note),"label"in t&&n(1,o=t.label),"used"in t&&n(2,a=t.used)},t.$$.update=()=>{24&t.$$.dirty&&c(s?"noteOn":"noteOff",r)},[i,o,a,s,r,function(t){s=t,n(3,s)}]}class Ft extends t{constructor(t){super(),e(this,t,qt,Pt,n,{state:0,note:4,label:1,used:2})}}function jt(t){let e;return{c(){e=s("div"),this.h()},l(t){e=i(t,"DIV",{class:!0}),r(e).forEach(o),this.h()},h(){a(e,"class","svelte-b4z542")},m(t,n){c(t,e,n)},p:l,i:l,o:l,d(t){t&&o(e)}}}class Lt extends t{constructor(t){super(),e(this,t,null,jt,n,{})}}function $t(t){let e,n;return e=new Vt({props:{note:t[1],label:t[4],used:t[5],state:t[2]}}),e.$on("noteOn",t[6]),e.$on("noteOff",t[6]),{c(){f(e.$$.fragment)},l(t){_(e.$$.fragment,t)},m(t,s){x(e,t,s),n=!0},p(t,n){const s={};2&n&&(s.note=t[1]),16&n&&(s.label=t[4]),32&n&&(s.used=t[5]),4&n&&(s.state=t[2]),e.$set(s)},i(t){n||(A(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){O(e,t)}}}function Bt(t){let e,n;return e=new Ft({props:{note:t[1],label:t[4],used:t[5],state:t[2]}}),e.$on("noteOn",t[6]),e.$on("noteOff",t[6]),{c(){f(e.$$.fragment)},l(t){_(e.$$.fragment,t)},m(t,s){x(e,t,s),n=!0},p(t,n){const s={};2&n&&(s.note=t[1]),16&n&&(s.label=t[4]),32&n&&(s.used=t[5]),4&n&&(s.state=t[2]),e.$set(s)},i(t){n||(A(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){O(e,t)}}}function Wt(t){let e,n;return e=new Lt({}),{c(){f(e.$$.fragment)},l(t){_(e.$$.fragment,t)},m(t,s){x(e,t,s),n=!0},p:l,i(t){n||(A(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){O(e,t)}}}function Ut(t){let e,n,u,l,h;const d=[Wt,Bt,$t],p=[];function f(t,e){return t[3]?0:(2&e&&(n=!("white"!=t[1].color())),n?1:2)}return u=f(t,-1),l=p[u]=d[u](t),{c(){e=s("div"),l.c(),this.h()},l(t){e=i(t,"DIV",{style:!0,class:!0});var n=r(e);l.l(n),n.forEach(o),this.h()},h(){w(e,"--width",t[0]+"%"),a(e,"class","svelte-toix9u")},m(t,n){c(t,e,n),p[u].m(e,null),h=!0},p(t,[n]){let s=u;u=f(t,n),u===s?p[u].p(t,n):(E(),S(p[s],1,1,()=>{p[s]=null}),D(),l=p[u],l?l.p(t,n):(l=p[u]=d[u](t),l.c()),A(l,1),l.m(e,null)),(!h||1&n)&&w(e,"--width",t[0]+"%")},i(t){h||(A(l),h=!0)},o(t){S(l),h=!1},d(t){t&&o(e),p[u].d()}}}function zt(t,e,n){let{width:s}=e,{note:i}=e,{active:r}=e,{state:o}=e,{ghost:a=!1}=e,{label:c=""}=e,{used:u=!1}=e,l=M();return t.$$set=t=>{"width"in t&&n(0,s=t.width),"note"in t&&n(1,i=t.note),"active"in t&&n(7,r=t.active),"state"in t&&n(2,o=t.state),"ghost"in t&&n(3,a=t.ghost),"label"in t&&n(4,c=t.label),"used"in t&&n(5,u=t.used)},[s,i,o,a,c,u,function(t){l(t.type,t.detail)},r]}class Gt extends t{constructor(t){super(),e(this,t,zt,Ut,n,{width:0,note:1,active:7,state:2,ghost:3,label:4,used:5})}}class Yt{}function Xt(t,e){let n=[];if(e.lowerThan(t)||e.equals(t))throw new Error("Low note must be lower than high note");for(e=e.next();t.lowerThan(e);)t.getAbstract().accidental?n.push(t):!t.next().getAbstract().accidental&&t.next().lowerThan(e)&&n.push(new Yt),t=t.next();return n}class Zt{constructor(t,e){this.note=t,this.width=e}}function Ht(t){let e=[],n=0;t.forEach((s,i)=>{if("white"!=s.color())throw new Error("Can only apply whiteWidths to white notes");let r=Qt(s,0==i,i==t.length-1);n+=r,e.push(new Zt(s,r))});let s=0;return e.forEach(t=>{t.width=t.width/n*100,s+=t.width}),e}function Qt(t,e,n){switch(t.getAbstract().letter){case"c":case"f":return n?2:3;case"b":case"e":return e?2:3;default:return n||e?3:4}}function Jt(t){let e=0;return t.forEach((n,s)=>{e+=Qt(n,0==s,s==t.length-1)}),4/e}let Kt=["a","s","d","f","g","h","j","k","l",";","'","Enter"],te=["w","e","r","t","y","u","i","o","p","[","]"];function ee(t,e,n){const s=t.slice();return s[21]=e[n],s}function ne(t,e,n){const s=t.slice();return s[21]=e[n].note,s[24]=e[n].width,s}function se(t){let e,n;return e=new Gt({props:{width:t[24],note:t[21],state:Y(t[21],t[3],t[0],t[1]),label:t[6](t[4],t[0],t[21])}}),e.$on("noteOn",t[5]),e.$on("noteOff",t[5]),{c(){f(e.$$.fragment)},l(t){_(e.$$.fragment,t)},m(t,s){x(e,t,s),n=!0},p(t,n){const s={};4&n&&(s.width=t[24]),4&n&&(s.note=t[21]),15&n&&(s.state=Y(t[21],t[3],t[0],t[1])),21&n&&(s.label=t[6](t[4],t[0],t[21])),e.$set(s)},i(t){n||(A(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){O(e,t)}}}function ie(t){let e,n;return e=new Gt({props:{width:100*Jt(t[2].white()),note:t[21],state:Y(t[21],t[3],t[0],t[1]),label:t[6](t[4],t[0],t[21])}}),e.$on("noteOn",t[5]),e.$on("noteOff",t[5]),{c(){f(e.$$.fragment)},l(t){_(e.$$.fragment,t)},m(t,s){x(e,t,s),n=!0},p(t,n){const s={};4&n&&(s.width=100*Jt(t[2].white())),4&n&&(s.note=t[21]),15&n&&(s.state=Y(t[21],t[3],t[0],t[1])),21&n&&(s.label=t[6](t[4],t[0],t[21])),e.$set(s)},i(t){n||(A(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){O(e,t)}}}function re(t){let e,n;return e=new Gt({props:{ghost:!0,width:100*Jt(t[2].white())*.5}}),{c(){f(e.$$.fragment)},l(t){_(e.$$.fragment,t)},m(t,s){x(e,t,s),n=!0},p(t,n){const s={};4&n&&(s.width=100*Jt(t[2].white())*.5),e.$set(s)},i(t){n||(A(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){O(e,t)}}}function oe(t){let e,n,s,i;const r=[re,ie],a=[];function u(t,e){return t[21]instanceof Yt?0:1}return e=u(t),n=a[e]=r[e](t),{c(){n.c(),s=I()},l(t){n.l(t),s=I()},m(t,n){a[e].m(t,n),c(t,s,n),i=!0},p(t,i){let o=e;e=u(t),e===o?a[e].p(t,i):(E(),S(a[o],1,1,()=>{a[o]=null}),D(),n=a[e],n?n.p(t,i):(n=a[e]=r[e](t),n.c()),A(n,1),n.m(s.parentNode,s))},i(t){i||(A(n),i=!0)},o(t){S(n),i=!1},d(t){a[e].d(t),t&&o(s)}}}function ae(t){let e,n,u,l,h,d=Ht(t[2].white()),p=[];for(let e=0;e<d.length;e+=1)p[e]=se(ne(t,d,e));const f=t=>S(p[t],1,1,()=>{p[t]=null});let g=Xt(t[2].lowest(),t[2].highest()),_=[];for(let e=0;e<g.length;e+=1)_[e]=oe(ee(t,g,e));const y=t=>S(_[t],1,1,()=>{_[t]=null});return{c(){e=s("div"),n=s("div");for(let t=0;t<p.length;t+=1)p[t].c();u=m(),l=s("div");for(let t=0;t<_.length;t+=1)_[t].c();this.h()},l(t){e=i(t,"DIV",{class:!0});var s=r(e);n=i(s,"DIV",{class:!0,id:!0});var a=r(n);for(let t=0;t<p.length;t+=1)p[t].l(a);a.forEach(o),u=v(s),l=i(s,"DIV",{style:!0,class:!0,id:!0});var c=r(l);for(let t=0;t<_.length;t+=1)_[t].l(c);c.forEach(o),s.forEach(o),this.h()},h(){a(n,"class","rapper svelte-1ffla7z"),a(n,"id","LilPeep"),w(l,"--blackMargin",100*Jt(t[2].white())/4+"%"),a(l,"class","rapper svelte-1ffla7z"),a(l,"id","JuiceWrld"),a(e,"class","svelte-1ffla7z")},m(t,s){c(t,e,s),T(e,n);for(let t=0;t<p.length;t+=1)p[t].m(n,null);T(e,u),T(e,l);for(let t=0;t<_.length;t+=1)_[t].m(l,null);h=!0},p(t,[e]){if(127&e){let s;for(d=Ht(t[2].white()),s=0;s<d.length;s+=1){const i=ne(t,d,s);p[s]?(p[s].p(i,e),A(p[s],1)):(p[s]=se(i),p[s].c(),A(p[s],1),p[s].m(n,null))}for(E(),s=d.length;s<p.length;s+=1)f(s);D()}if(127&e){let n;for(g=Xt(t[2].lowest(),t[2].highest()),n=0;n<g.length;n+=1){const s=ee(t,g,n);_[n]?(_[n].p(s,e),A(_[n],1)):(_[n]=oe(s),_[n].c(),A(_[n],1),_[n].m(l,null))}for(E(),n=g.length;n<_.length;n+=1)y(n);D()}(!h||4&e)&&w(l,"--blackMargin",100*Jt(t[2].white())/4+"%")},i(t){if(!h){for(let t=0;t<d.length;t+=1)A(p[t]);for(let t=0;t<g.length;t+=1)A(_[t]);h=!0}},o(t){p=p.filter(Boolean);for(let t=0;t<p.length;t+=1)S(p[t]);_=_.filter(Boolean);for(let t=0;t<_.length;t+=1)S(_[t]);h=!1},d(t){t&&o(e),N(p,t),N(_,t)}}}function ce(t,e,n){let s,i,{keys:r}=e,{usedNotes:o=new Map}=e,{sandbox:a=!1}=e,{instrument:c}=e,{position:u}=e,{midiOnly:l=!1}=e,{on:h=!0}=e,d=!1,p=!1;const f=M();function m(t){let e=t.detail;v.set(e,"noteOn"===t.type),n(3,v);let s=new Array;v.forEach((t,e)=>{t&&s.push(e)}),"noteOn"===t.type&&h?c.play(e):c.stop(e),f("playingNotes",s),f(t.type,e)}let g,_=new j(r),v=_.activeMap();g=()=>{let t=()=>{let t;t=()=>{try{q.inputs[0].addListener("noteon","all",t=>{m({type:"noteOn",detail:L(t.note.name,t.note.octave)})}),q.inputs[0].addListener("noteoff","all",t=>{m({type:"noteOff",detail:L(t.note.name,t.note.octave)})}),d=!0}catch(e){setTimeout(t,200)}},t()};q.enabled?t():q.enable((function(e){t()}))};const y=t=>{t.repeat||w(t.key,!0)},b=t=>{w(t.key,!1)};function w(t,e){if(!l){let n=function(t,e){var n=Kt.indexOf(t);if(-1!==n)return e.white()[n];if(-1!==(n=te.indexOf(t))){let t=Xt(e.notes[0],e.notes[e.notes.length-1])[n];if(F(t))return t}}(t,_);null!=n&&m({type:e?"noteOn":"noteOff",detail:n})}}return R(()=>{V(window),n(12,p=W()===U.qwerty),g(),document.addEventListener("keypress",y),document.addEventListener("keyup",b)}),P(()=>{"undefined"!=typeof document&&(document.removeEventListener("keypress",y),document.removeEventListener("keyup",b))}),t.$$set=t=>{"keys"in t&&n(7,r=t.keys),"usedNotes"in t&&n(0,o=t.usedNotes),"sandbox"in t&&n(8,a=t.sandbox),"instrument"in t&&n(9,c=t.instrument),"position"in t&&n(10,u=t.position),"midiOnly"in t&&n(11,l=t.midiOnly),"on"in t&&n(1,h=t.on)},t.$$.update=()=>{6144&t.$$.dirty&&n(13,s=p&&!l),8320&t.$$.dirty&&n(4,i=s?function(t){let e=new Map;return t.white().forEach((t,n)=>{n<Kt.length&&e.set(t.string(),Kt[n])}),Xt(t.notes[0],t.notes[t.notes.length-1]).forEach((t,n)=>{if(n<te.length&&F(t)){let s=t;e.set(s.string(),te[n])}}),e}(new j(r)):new Map),128&t.$$.dirty&&n(2,_=new j(r))},[o,h,_,v,i,function(t){l||m(t)},function(t,e,n){return 0==e.size?t.get(n.string())?t.get(n.string()):"":e.has(n.string())&&t.get(n.string())?t.get(n.string()):""},r,a,c,u,l,p,s]}class ue extends t{constructor(t){super(),e(this,t,ce,ae,n,{keys:7,usedNotes:0,sandbox:8,instrument:9,position:10,midiOnly:11,on:1})}}var le=z((function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.default=t.exports,t.exports.__esModule=!0})),he=z((function(t){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],s=!0,i=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(s=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);s=!0);}catch(t){i=!0,r=t}finally{try{s||null==a.return||a.return()}finally{if(i)throw r}}return n}},t.exports.default=t.exports,t.exports.__esModule=!0})),de=z((function(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s},t.exports.default=t.exports,t.exports.__esModule=!0})),pe=z((function(t){t.exports=function(t,e){if(t){if("string"==typeof t)return de(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?de(t,e):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0})),fe=z((function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0})),me=z((function(t){t.exports=function(t,e){return le(t)||he(t,e)||pe(t,e)||fe()},t.exports.default=t.exports,t.exports.__esModule=!0})),ge=z((function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0})),_e=z((function(t){function e(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}t.exports=function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t},t.exports.default=t.exports,t.exports.__esModule=!0})),ve=z((function(t,e){!function(t,e,n,s){function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=i(e),o=i(n),a=i(s),c=function(t,e,n){return{endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}},u=function(t,e,n){return{endTime:e,insertTime:n,type:"linearRampToValue",value:t}},l=function(t,e){return{startTime:e,type:"setValue",value:t}},h=function(t,e,n){return{duration:n,startTime:e,type:"setValueCurve",values:t}},d=function(t,e,n){var s=n.startTime,i=n.target,r=n.timeConstant;return i+(e-i)*Math.exp((s-t)/r)},p=function(t){return"exponentialRampToValue"===t.type},f=function(t){return"linearRampToValue"===t.type},m=function(t){return p(t)||f(t)},g=function(t){return"setValue"===t.type},_=function(t){return"setValueCurve"===t.type},v=function t(e,n,s,i){var r=e[n];return void 0===r?i:m(r)||g(r)?r.value:_(r)?r.values[r.values.length-1]:d(s,t(e,n-1,r.startTime,i),r)},y=function(t,e,n,s,i){return void 0===n?[s.insertTime,i]:m(n)?[n.endTime,n.value]:g(n)?[n.startTime,n.value]:_(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,v(t,e-1,n.startTime,i)]},b=function(t){return"cancelAndHold"===t.type},w=function(t){return"cancelScheduledValues"===t.type},x=function(t){return b(t)||w(t)?t.cancelTime:p(t)||f(t)?t.endTime:t.startTime},T=function(t,e,n,s){var i=s.endTime,r=s.value;return n===r?r:0<n&&0<r||n<0&&r<0?n*Math.pow(r/n,(t-e)/(i-e)):0},C=function(t,e,n,s){return n+(t-e)/(s.endTime-e)*(s.value-n)},k=function(t,e){var n=e.duration,s=e.startTime,i=e.values;return function(t,e){var n=Math.floor(e),s=Math.ceil(e);return n===s?t[n]:(1-(e-n))*t[n]+(1-(s-e))*t[s]}(i,(t-s)/n*(i.length-1))},A=function(t){return"setTarget"===t.type},S=function(){function t(e){o.default(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=e}return a.default(t,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(t){var e=x(t);if(b(t)||w(t)){var n=this._automationEvents.findIndex((function(n){return w(t)&&_(n)?n.startTime+n.duration>=e:x(n)>=e})),s=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),b(t)){var i=this._automationEvents[this._automationEvents.length-1];if(void 0!==s&&m(s)){if(A(i))throw new Error("The internal list is malformed.");var r=_(i)?i.startTime+i.duration:x(i),o=_(i)?i.values[i.values.length-1]:i.value,a=p(s)?T(e,r,o,s):C(e,r,o,s),d=p(s)?c(a,e,this._currenTime):u(a,e,this._currenTime);this._automationEvents.push(d)}void 0!==i&&A(i)&&this._automationEvents.push(l(this.getValue(e),e)),void 0!==i&&_(i)&&i.startTime+i.duration>e&&(this._automationEvents[this._automationEvents.length-1]=h(new Float32Array([6,7]),i.startTime,e-i.startTime))}}else{var g=this._automationEvents.findIndex((function(t){return x(t)>e})),v=-1===g?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[g-1];if(void 0!==v&&_(v)&&x(v)+v.duration>e)return!1;var y=p(t)?c(t.value,t.endTime,this._currenTime):f(t)?u(t.value,e,this._currenTime):t;if(-1===g)this._automationEvents.push(y);else{if(_(t)&&e+t.duration>x(this._automationEvents[g]))return!1;this._automationEvents.splice(g,0,y)}}return!0}},{key:"flush",value:function(t){var e=this._automationEvents.findIndex((function(e){return x(e)>t}));if(e>1){var n=this._automationEvents.slice(e-1),s=n[0];A(s)&&n.unshift(l(v(this._automationEvents,e-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(t){if(0===this._automationEvents.length)return this._defaultValue;var e=this._automationEvents.findIndex((function(e){return x(e)>t})),n=this._automationEvents[e],s=(-1===e?this._automationEvents.length:e)-1,i=this._automationEvents[s];if(void 0!==i&&A(i)&&(void 0===n||!m(n)||n.insertTime>t))return d(t,v(this._automationEvents,s-1,i.startTime,this._defaultValue),i);if(void 0!==i&&g(i)&&(void 0===n||!m(n)))return i.value;if(void 0!==i&&_(i)&&(void 0===n||!m(n)||i.startTime+i.duration>t))return t<i.startTime+i.duration?k(t,i):i.values[i.values.length-1];if(void 0!==i&&m(i)&&(void 0===n||!m(n)))return i.value;if(void 0!==n&&p(n)){var o=y(this._automationEvents,s,i,n,this._defaultValue),a=r.default(o,2),c=a[0],u=a[1];return T(t,c,u,n)}if(void 0!==n&&f(n)){var l=y(this._automationEvents,s,i,n,this._defaultValue),h=r.default(l,2),b=h[0],w=h[1];return C(t,b,w,n)}return this._defaultValue}}]),t}();t.AutomationEventList=S,t.createCancelAndHoldAutomationEvent=function(t){return{cancelTime:t,type:"cancelAndHold"}},t.createCancelScheduledValuesAutomationEvent=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},t.createExponentialRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},t.createLinearRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},t.createSetTargetAutomationEvent=function(t,e,n){return{startTime:e,target:t,timeConstant:n,type:"setTarget"}},t.createSetValueAutomationEvent=l,t.createSetValueCurveAutomationEvent=h,Object.defineProperty(t,"__esModule",{value:!0})}(e,me,ge,_e)}));const ye=new WeakSet,be=new WeakMap,we=new WeakMap,xe=new WeakMap,Te=new WeakMap,Ce=new WeakMap,ke=new WeakMap,Ae=new WeakMap,Se=new WeakMap,Oe=new WeakMap,Me={construct:()=>Me},Ee=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,De=(t,e)=>{const n=[];let s=t.replace(/^[\s]+/,""),i=s.match(Ee);for(;null!==i;){const t=i[1].slice(1,-1),r=i[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());n.push(r),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(Ee)}return[n.join(";"),s]},Ie=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Ne=t=>{if(!(t=>{try{new new Proxy(t,Me)}catch{return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},Re=(t,e)=>{const n=t.get(e);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},Ve=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[s]=n;return t.delete(s),s},Pe=(t,e,n,s)=>{const i=Re(t,e),r=Ve(i,t=>t[0]===n&&t[1]===s);return 0===i.size&&t.delete(e),r},qe=t=>Re(ke,t),Fe=t=>{if(ye.has(t))throw new Error("The AudioNode is already stored.");ye.add(t),qe(t).forEach(t=>t(!0))},je=t=>"port"in t,Le=t=>{if(!ye.has(t))throw new Error("The AudioNode is not stored.");ye.delete(t),qe(t).forEach(t=>t(!1))},$e=(t,e)=>{!je(t)&&e.every(t=>0===t.size)&&Le(t)},Be={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},We=(t,e)=>t.context===e,Ue=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},ze=()=>new DOMException("","IndexSizeError"),Ge=t=>{var e;t.getChannelData=(e=t.getChannelData,n=>{try{return e.call(t,n)}catch(t){if(12===t.code)throw ze();throw t}})},Ye={numberOfChannels:1},Xe=-34028234663852886e22,Ze=-Xe,He=t=>ye.has(t),Qe={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Je=t=>Re(be,t),Ke=t=>Re(xe,t),tn=(t,e)=>{const{activeInputs:n}=Je(t);n.forEach(n=>n.forEach(([n])=>{e.includes(t)||tn(n,[...e,t])}));const s=(t=>"playbackRate"in t)(t)?[t.playbackRate]:je(t)?Array.from(t.parameters.values()):(t=>"frequency"in t&&"gain"in t)(t)?[t.Q,t.detune,t.frequency,t.gain]:(t=>"offset"in t)(t)?[t.offset]:(t=>!("frequency"in t)&&"gain"in t)(t)?[t.gain]:(t=>"detune"in t&&"frequency"in t)(t)?[t.detune,t.frequency]:(t=>"pan"in t)(t)?[t.pan]:[];for(const t of s){const n=Ke(t);void 0!==n&&n.activeInputs.forEach(([t])=>tn(t,e))}He(t)&&Le(t)},en=t=>{tn(t.destination,[])},nn=t=>"context"in t,sn=t=>nn(t[0]),rn=(t,e,n,s)=>{for(const e of t)if(n(e)){if(s)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},on=(t,e,[n,s],i)=>{rn(t,[e,n,s],t=>t[0]===e&&t[1]===n,i)},an=(t,[e,n,s],i)=>{const r=t.get(e);void 0===r?t.set(e,new Set([[n,s]])):rn(r,[n,s],t=>t[0]===n,i)},cn=t=>"inputs"in t,un=(t,e,n,s)=>{if(cn(e)){const i=e.inputs[s];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,s),[e,n,s]},ln=(t,e,n)=>{for(const s of t)if(s[0]===e&&s[1]===n)return t.delete(s),s;return null},hn=(t,e)=>{if(!qe(t).delete(e))throw new Error("Missing the expected event listener.")},dn=(t,e,n)=>{const s=Re(t,e),i=Ve(s,t=>t[0]===n);return 0===s.size&&t.delete(e),i},pn=(t,e,n,s)=>{cn(e)?t.disconnect(e.inputs[s],n,0):t.disconnect(e,n,s)},fn=t=>Re(we,t),mn=t=>Re(Te,t),gn=t=>Ae.has(t),_n=t=>!ye.has(t),vn=t=>new Promise(e=>{const n=t.createScriptProcessor(256,1,1),s=t.createGain(),i=t.createBuffer(1,2,44100),r=i.getChannelData(0);r[0]=1,r[1]=1;const o=t.createBufferSource();o.buffer=i,o.loop=!0,o.connect(n).connect(t.destination),o.connect(s),o.disconnect(s),n.onaudioprocess=s=>{const i=s.inputBuffer.getChannelData(0);Array.prototype.some.call(i,t=>1===t)?e(!0):e(!1),o.stop(),n.onaudioprocess=null,o.disconnect(n),n.disconnect(t.destination)},o.start()}),yn=(t,e)=>{const n=new Map;for(const e of t)for(const t of e){const e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach((t,n)=>e(n,t))},bn=t=>"context"in t,wn=(t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=Ke(e),{outputs:o}=Je(t),a=qe(t),c=o=>{const a=fn(t),c=mn(e);if(o){const e=dn(r,t,n);on(i,t,e,!1),s||gn(t)||a.connect(c,n)}else{const e=((t,e,n)=>Ve(t,t=>t[0]===e&&t[1]===n))(i,t,n);an(r,e,!1),s||gn(t)||a.disconnect(c,n)}};return!!rn(o,[e,n],t=>t[0]===e&&t[1]===n,!0)&&(a.add(c),He(t)?on(i,t,[n,c],!0):an(r,[t,n,c],!0),!0)},xn=(t,e,n,s,i)=>{const[r,o]=((t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=Je(e),o=ln(i[s],t,n);if(null===o){return[Pe(r,t,n,s)[2],!1]}return[o[2],!0]})(t,n,s,i);if(null!==r&&(hn(t,r),!o||e||gn(t)||pn(fn(t),fn(n),s,i)),He(n)){const{activeInputs:t}=Je(n);$e(n,t)}},Tn=(t,e,n,s)=>{const[i,r]=((t,e,n)=>{const{activeInputs:s,passiveInputs:i}=Ke(e),r=ln(s,t,n);if(null===r){return[dn(i,t,n)[1],!1]}return[r[2],!0]})(t,n,s);null!==i&&(hn(t,i),!r||e||gn(t)||fn(t).disconnect(mn(n),s))};class Cn{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach((n,s)=>t.call(e,n,s,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const kn={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function An(t,e,n,s,i){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],s,i);else{const r=t.getChannelData(s);if(0===e[n].byteLength)e[n]=r.slice(i,i+128);else{const t=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}const Sn=(t,e,n,s,i)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],s,i):0!==e[n].byteLength&&t.getChannelData(s).set(e[n],i)},On=(t,e)=>{const n=[];for(let s=0;s<t;s+=1){const t=[],i="number"==typeof e?e:e[s];for(let e=0;e<i;e+=1)t.push(new Float32Array(128));n.push(t)}return n},Mn=async(t,e,n,s,i,r,o)=>{const a=null===e?128*Math.ceil(t.context.length/128):e.length,c=s.channelCount*s.numberOfInputs,u=i.reduce((t,e)=>t+e,0),l=0===u?null:n.createBuffer(u,a,n.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const h=Je(t),d=await((t,e)=>{const n=Re(Oe,t),s=fn(e);return Re(n,s)})(n,t),p=On(s.numberOfInputs,s.channelCount),f=On(s.numberOfOutputs,i),m=Array.from(t.parameters.keys()).reduce((t,e)=>({...t,[e]:new Float32Array(128)}),{});for(let u=0;u<a;u+=128){if(s.numberOfInputs>0&&null!==e)for(let t=0;t<s.numberOfInputs;t+=1)for(let n=0;n<s.channelCount;n+=1)An(e,p[t],n,n,u);void 0!==r.parameterDescriptors&&null!==e&&r.parameterDescriptors.forEach(({name:t},n)=>{An(e,m,t,c+n,u)});for(let t=0;t<s.numberOfInputs;t+=1)for(let e=0;e<i[t];e+=1)0===f[t][e].byteLength&&(f[t][e]=new Float32Array(128));try{const t=p.map((t,e)=>0===h.activeInputs[e].size?[]:t),e=o(u/n.sampleRate,n.sampleRate,()=>d.process(t,f,m));if(null!==l)for(let t=0,e=0;t<s.numberOfOutputs;t+=1){for(let n=0;n<i[t];n+=1)Sn(l,f[t],n,e+n,u);e+=i[t]}if(!e)break}catch(e){t.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}));break}}return l},En={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Dn={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},In={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Nn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Rn={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Vn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Pn=(t,e,n)=>{const s=e[n];if(void 0===s)throw t();return s},qn={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Fn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},jn=()=>new DOMException("","InvalidStateError"),Ln=()=>new DOMException("","InvalidAccessError"),$n={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Bn=(t,e,n,s,i,r,o,a,c,u,l)=>{const h=u.length;let d=a;for(let a=0;a<h;a+=1){let h=n[0]*u[a];for(let e=1;e<i;e+=1){const s=d-e&c-1;h+=n[e]*r[s],h-=t[e]*o[s]}for(let t=i;t<s;t+=1)h+=n[t]*r[d-t&c-1];for(let n=i;n<e;n+=1)h-=t[n]*o[d-n&c-1];r[d]=u[a],o[d]=h,d=d+1&c-1,l[a]=h}return d},Wn={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Un=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,()=>{});return void 0!==n&&(n.catch(()=>{}),!0)}catch{}return!1},zn=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n]&&(t[n]=s)},Gn=(t,e)=>{zn(t,e,"channelCount"),zn(t,e,"channelCountMode"),zn(t,e,"channelInterpretation")},Yn=t=>"function"==typeof t.getFloatTimeDomainData,Xn=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n].value&&(t[n].value=s)},Zn=t=>{t.start=(e=>(n=0,s=0,i)=>{if("number"==typeof i&&i<0||s<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,s,i)})(t.start)},Hn=t=>{var e;t.stop=(e=t.stop,(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})},Qn=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),Jn=async(t,e)=>new t(await(t=>new Promise((e,n)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:t})=>{s.close(),i.close(),e(t)},s.onmessageerror=({data:t})=>{s.close(),i.close(),n(t)},i.postMessage(t)}))(e)),Kn=(t,e)=>{const n=t.createBiquadFilter();return Gn(n,e),Xn(n,e,"Q"),Xn(n,e,"detune"),Xn(n,e,"frequency"),Xn(n,e,"gain"),zn(n,e,"type"),n},ts=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return Gn(n,e),(t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw jn()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw jn()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw jn()}})})(n),n},es=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),ns=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return Gn(n,e),Xn(n,e,"delayTime"),n},ss=(t,e)=>{const n=t.createGain();return Gn(n,e),Xn(n,e,"gain"),n};function is(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function rs(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)i=e,n=[(s=n)[0]*i[0]-s[1]*i[1],s[0]*i[1]+s[1]*i[0]],n[0]+=t[r];var s,i;return n}const os=(t,e,n,s)=>t.createScriptProcessor(e,n,s),as=()=>new DOMException("","NotSupportedError"),cs={numberOfChannels:1},us={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},ls={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},hs={disableNormalization:!1},ds={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},ps={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},fs=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},ms=(t,e,n,s)=>{let i=Object.getPrototypeOf(t);for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(r),set:s(o)})},gs=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(s){if(9!==s.code)throw s;gs(t,e,n+1e-7)}},_s=t=>{const e=t.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},vs=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},ys=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},bs=(t,e)=>{const n=e.createGain();t.connect(n);const s=(e=>()=>{e.call(t,n),t.removeEventListener("ended",s)})(t.disconnect);t.addEventListener("ended",s),es(t,n),t.stop=(e=>{let s=!1;return(i=0)=>{if(s)try{e.call(t,i)}catch{n.gain.setValueAtTime(0,i)}else e.call(t,i),s=!0}})(t.stop)},ws=(t,e)=>n=>{const s={value:t};return Object.defineProperties(n,{currentTarget:s,target:s}),"function"==typeof e?e.call(t,n):e.handleEvent.call(t,n)},xs=(t=>(e,n,[s,i,r],o)=>{t(e[i],[n,s,r],t=>t[0]===n&&t[1]===s,o)})(rn),Ts=(t=>(e,n,[s,i,r],o)=>{const a=e.get(s);void 0===a?e.set(s,new Set([[i,n,r]])):t(a,[i,n,r],t=>t[0]===i&&t[1]===n,o)})(rn),Cs=(t=>(e,n,s,i)=>t(e[i],t=>t[0]===n&&t[1]===s))(Ve),ks=new WeakMap,As=(t=>e=>{var n;return null!==(n=t.get(e))&&void 0!==n?n:0})(ks),Ss=(Os=new Map,Ms=new WeakMap,(t,e)=>{const n=Ms.get(t);if(void 0!==n)return n;const s=Os.get(t);if(void 0!==s)return s;try{const n=e();return n instanceof Promise?(Os.set(t,n),n.catch(()=>!1).then(e=>(Os.delete(t),Ms.set(t,e),e))):(Ms.set(t,n),n)}catch{return Ms.set(t,!1),!1}});var Os,Ms;const Es="undefined"==typeof window?null:window,Ds=((t,e)=>(n,s)=>{const i=n.createAnalyser();if(Gn(i,s),!(s.maxDecibels>s.minDecibels))throw e();return zn(i,s,"fftSize"),zn(i,s,"maxDecibels"),zn(i,s,"minDecibels"),zn(i,s,"smoothingTimeConstant"),t(Yn,()=>Yn(i))||(t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const s=Math.max(n.length,t.fftSize);for(let t=0;t<s;t+=1)e[t]=.0078125*(n[t]-128);return e}})(i),i})(Ss,ze),Is=(t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer})(Je),Ns=((t,e,n)=>async(s,i,r,o)=>{const a=t(s),c=[...o,s];await Promise.all(a.activeInputs.map((t,o)=>Array.from(t).filter(([t])=>!c.includes(t)).map(async([t,a])=>{const u=e(t),l=await u.render(t,i,c),h=s.context.destination;n(t)||s===h&&n(s)||l.connect(r,a,o)})).reduce((t,e)=>[...t,...e],[]))})(Je,Is,gn),Rs=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!We(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=t(r,e)}return s.set(r,a),await n(i,r,a,o),a})(i,r,o)}}})(Ds,fn,Ns),Vs=(Ps=Ce,t=>{const e=Ps.get(t);if(void 0===e)throw jn();return e});var Ps;const qs=(t=>null===t?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null)(Es),Fs=(t=>e=>null!==t&&e instanceof t)(qs),js=new WeakMap,Ls=(t=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(e,n,s){if(null!==n){let i=this._listeners.get(n);void 0===i&&(i=t(this,n),"function"==typeof n&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(e,i,s)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const s=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===s?null:s,n)}})(ws),$s=(t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null)(Es),Bs=(t=>e=>null!==t&&e instanceof t)($s),Ws=(t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode)(Es),Us=(t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam)(Es),zs=((t,e,n,s,i,r,o,a,c,u,l,h,d,p,f)=>class extends u{constructor(e,s,i,r){super(i),this._context=e,this._nativeAudioNode=i;const o=l(e);h(o)&&!0!==n(vn,()=>vn(o))&&(t=>{const e=new Map;t.connect=(t=>(n,s=0,i=0)=>{const r=bn(n)?t(n,s,i):t(n,s),o=e.get(n);return void 0===o?e.set(n,[{input:i,output:s}]):o.every(t=>t.input!==i||t.output!==s)&&o.push({input:i,output:s}),r})(t.connect.bind(t)),t.disconnect=(n=>(s,i,r)=>{if(n.apply(t),void 0===s)e.clear();else if("number"==typeof s)for(const[t,n]of e){const i=n.filter(t=>t.output!==s);0===i.length?e.delete(t):e.set(t,i)}else if(e.has(s))if(void 0===i)e.delete(s);else{const t=e.get(s);if(void 0!==t){const n=t.filter(t=>t.output!==i&&(t.input!==r||void 0===r));0===n.length?e.delete(s):e.set(s,n)}}for(const[n,s]of e)s.forEach(e=>{bn(n)?t.connect(n,e.output,e.input):t.connect(n,e.output)})})(t.disconnect)})(i),we.set(this,i),ke.set(this,new Set),"closed"!==e.state&&s&&Fe(this),t(this,r,i)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,n=0,a=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw i();const u=l(this._context),h=f(u);if(d(t)||p(t))throw r();if(nn(t)){const i=fn(t);try{const e=un(this._nativeAudioNode,i,n,a),s=_n(this);(h||s)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!s&&_n(t)&&Fe(t)}catch(t){if(12===t.code)throw r();throw t}if(e(this,t,n,a,h)){const e=c([this],t);yn(e,s(h))}return t}const m=mn(t);if("playbackRate"===m.name&&1024===m.maxValue)throw o();try{this._nativeAudioNode.connect(m,n),(h||_n(this))&&this._nativeAudioNode.disconnect(m,n)}catch(t){if(12===t.code)throw r();throw t}if(wn(this,t,n,h)){const e=c([this],t);yn(e,s(h))}}disconnect(t,e,n){let s;const o=l(this._context),u=f(o);if(void 0===t)s=((t,e)=>{const n=Je(t),s=[];for(const i of n.outputs)sn(i)?xn(t,e,...i):Tn(t,e,...i),s.push(i[0]);return n.outputs.clear(),s})(this,u);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw i();s=((t,e,n)=>{const s=Je(t),i=[];for(const r of s.outputs)r[1]===n&&(sn(r)?xn(t,e,...r):Tn(t,e,...r),i.push(r[0]),s.outputs.delete(r));return i})(this,u,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw i();if(nn(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw i();if(s=((t,e,n,s,i)=>{const r=Je(t);return Array.from(r.outputs).filter(t=>!(t[0]!==n||void 0!==s&&t[1]!==s||void 0!==i&&t[2]!==i)).map(n=>(sn(n)?xn(t,e,...n):Tn(t,e,...n),r.outputs.delete(n),n[0]))})(this,u,t,e,n),0===s.length)throw r()}for(const t of s){const e=c([this],t);yn(e,a)}}})((Gs=be,(t,e,n)=>{const s=[];for(let t=0;t<n.numberOfInputs;t+=1)s.push(new Set);Gs.set(t,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((t,e,n,s,i,r,o,a,c,u,l,h,d)=>{const p=new WeakMap;return(f,m,g,_,v)=>{const{activeInputs:y,passiveInputs:b}=r(m),{outputs:w}=r(f),x=a(f),T=r=>{const a=c(m),u=c(f);if(r){const e=Pe(b,f,g,_);t(y,f,e,!1),v||h(f)||n(u,a,g,_),d(m)&&Fe(m)}else{const t=s(y,f,g,_);e(b,_,t,!1),v||h(f)||i(u,a,g,_);const n=o(m);if(0===n)l(m)&&$e(m,y);else{const t=p.get(m);void 0!==t&&clearTimeout(t),p.set(m,setTimeout(()=>{l(m)&&$e(m,y)},1e3*n))}}};return!!u(w,[m,g,_],t=>t[0]===m&&t[1]===g&&t[2]===_,!0)&&(x.add(T),l(f)?t(y,f,[g,_,T],!0):e(b,_,[f,g,T],!0),!0)}})(xs,Ts,un,Cs,pn,Je,As,qe,fn,rn,He,gn,_n),Ss,((t,e,n,s,i,r)=>o=>(a,c)=>{const u=t.get(a);if(void 0===u){if(!o&&r(a)){const t=s(a),{outputs:r}=n(a);for(const n of r)if(sn(n)){const i=s(n[0]);e(t,i,n[1],n[2])}else{const e=i(n[0]);t.disconnect(e,n[1])}}t.set(a,c)}else t.set(a,u+c)})(Ae,pn,Je,fn,mn,He),ze,Ln,as,((t,e,n,s,i,r,o,a)=>(c,u)=>{const l=e.get(c);if(void 0===l)throw new Error("Missing the expected cycle count.");const h=r(c.context),d=a(h);if(l===u){if(e.delete(c),!d&&o(c)){const e=s(c),{outputs:r}=n(c);for(const n of r)if(sn(n)){const i=s(n[0]);t(e,i,n[1],n[2])}else{const t=i(n[0]);e.connect(t,n[1])}}}else e.set(c,l-u)})(un,Ae,Je,fn,mn,Vs,He,Fs),((t,e,n)=>function s(i,r){const o=nn(r)?r:n(t,r);if((t=>"delayTime"in t)(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(t=>s([...i,o],t[0])).reduce((t,e)=>t.concat(e),[])})(js,Je,Re),Ls,Vs,Bs,Ws,Us,Fs);var Gs;const Ys=((t,e,n,s,i,r)=>class extends t{constructor(t,n){const o=i(t),a={...Be,...n},c=s(o,a);super(t,!1,c,r(o)?e():null),this._nativeAnalyserNode=c}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}})(zs,Rs,ze,Ds,Vs,Fs),Xs=new WeakSet,Zs=(t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null)(Es),Hs=(Qs=new Uint32Array(1),t=>(Qs[0]=t,Qs[0]));var Qs;const Js=((t,e)=>n=>{n.copyFromChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,u=n.getChannelData(a),l=s.length;for(let t=o<0?-o:0;t+o<c&&t<l;t+=1)s[t]=u[t+o]},n.copyToChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,u=n.getChannelData(a),l=s.length;for(let t=o<0?-o:0;t+o<c&&t<l;t+=1)u[t+o]=s[t]}})(Hs,ze),Ks=(t=>e=>{e.copyFromChannel=(n=>(s,i,r=0)=>{const o=t(r),a=t(i);if(o<e.length)return n.call(e,s,a,o)})(e.copyFromChannel),e.copyToChannel=(n=>(s,i,r=0)=>{const o=t(r),a=t(i);if(o<e.length)return n.call(e,s,a,o)})(e.copyToChannel)})(Hs),ti=((t,e,n,s,i,r,o,a)=>{let c=null;return class u{constructor(u){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:l,numberOfChannels:h,sampleRate:d}={...Ye,...u};null===c&&(c=new i(1,1,44100));const p=null!==s&&e(r,r)?new s({length:l,numberOfChannels:h,sampleRate:d}):c.createBuffer(h,l,d);if(0===p.numberOfChannels)throw n();return"function"!=typeof p.copyFromChannel?(o(p),Ge(p)):e(Ue,()=>Ue(p))||a(p),t.add(p),p}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===u.prototype||t.has(e)}}})(Xs,Ss,as,Zs,qs,(t=>()=>{if(null===t)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0})(Zs),Js,Ks),ei=(t=>(e,n)=>{const s=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(s).connect(e.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(s),s.disconnect()};n.addEventListener("ended",i)})(ss),ni=((t,e,n)=>async(s,i,r,o)=>{const a=e(s);await Promise.all(Array.from(a.activeInputs).map(async([e,s])=>{const a=t(e),c=await a.render(e,i,o);n(e)||c.connect(r,s)}))})(Is,Ke,gn),si=(t=>(e,n,s,i)=>t(n,e,s,i))(ni),ii=((t,e,n,s,i,r,o,a,c,u,l)=>(h,d)=>{const p=h.createBufferSource();return Gn(p,d),Xn(p,d,"playbackRate"),zn(p,d,"buffer"),zn(p,d,"loop"),zn(p,d,"loopEnd"),zn(p,d,"loopStart"),e(n,()=>n(h))||(t=>{t.start=(e=>{let n=!1;return(s=0,i=0,r)=>{if(n)throw jn();e.call(t,s,i,r),n=!0}})(t.start)})(p),e(s,()=>s(h))||c(p),e(i,()=>i(h))||u(p,h),e(r,()=>r(h))||Zn(p),e(o,()=>o(h))||l(p,h),e(a,()=>a(h))||Hn(p),t(h,p),p})(ei,Ss,t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0},t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},_s,vs,ys,t=>{t.start=(e=>(n=0,s=0,i)=>{const r=t.buffer,o=null===r?s:Math.min(r.duration,s);null!==r&&o>r.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)})(t.start)},(t=>(e,n)=>{const s=n.createBuffer(1,1,44100);null===e.buffer&&(e.buffer=s),t(e,"buffer",t=>()=>{const n=t.call(e);return n===s?null:n},t=>n=>t.call(e,null===n?s:n))})(ms),bs),ri=((t,e)=>(n,s,i,r)=>(t(s).replay(i),e(s,n,i,r)))((t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(Ke),ni),oi=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(c,u,l){const h=r.get(u);return void 0!==h?Promise.resolve(h):(async(c,u,l)=>{let h=n(c);const d=We(h,u);if(!d){const t={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,t),null!==o&&h.start(...o),null!==a&&h.stop(a)}return r.set(u,h),d?await t(u,c.playbackRate,h.playbackRate,l):await s(u,c.playbackRate,h.playbackRate,l),await i(c,u,h,l),h})(c,u,l)}}})(si,ii,fn,ri,Ns),ai=((t,e,n,s,i,r,o,a,c,u,l,h,d)=>(p,f,m,g=null,_=null)=>{const v=new ve.AutomationEventList(m.defaultValue),y=f?s(v):null,b={get defaultValue(){return m.defaultValue},get maxValue(){return null===g?m.maxValue:g},get minValue(){return null===_?m.minValue:_},get value(){return m.value},set value(t){m.value=t,b.setValueAtTime(t,p.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof m.cancelAndHoldAtTime)null===y&&v.flush(p.context.currentTime),v.add(i(t)),m.cancelAndHoldAtTime(t);else{const e=Array.from(v).pop();null===y&&v.flush(p.context.currentTime),v.add(i(t));const n=Array.from(v).pop();m.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?m.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?m.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?m.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&m.setValueCurveAtTime(n.values,n.startTime,n.duration))}return b},cancelScheduledValues:t=>(null===y&&v.flush(p.context.currentTime),v.add(r(t)),m.cancelScheduledValues(t),b),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;return null===y&&v.flush(p.context.currentTime),v.add(o(t,e)),m.exponentialRampToValueAtTime(t,e),b},linearRampToValueAtTime:(t,e)=>(null===y&&v.flush(p.context.currentTime),v.add(a(t,e)),m.linearRampToValueAtTime(t,e),b),setTargetAtTime:(t,e,n)=>(null===y&&v.flush(p.context.currentTime),v.add(c(t,e,n)),m.setTargetAtTime(t,e,n),b),setValueAtTime:(t,e)=>(null===y&&v.flush(p.context.currentTime),v.add(u(t,e)),m.setValueAtTime(t,e),b),setValueCurveAtTime(t,e,n){const s=t instanceof Float32Array?t:new Float32Array(t);if(null!==h&&"webkitAudioContext"===h.name){const t=e+n,i=p.context.sampleRate,r=Math.ceil(e*i),o=Math.floor(t*i),a=o-r,c=new Float32Array(a);for(let t=0;t<a;t+=1){const o=(s.length-1)/n*((r+t)/i-e),a=Math.floor(o),u=Math.ceil(o);c[t]=a===u?s[a]:(1-(o-a))*s[a]+(1-(u-o))*s[u]}null===y&&v.flush(p.context.currentTime),v.add(l(c,e,n)),m.setValueCurveAtTime(c,e,n);const u=o/i;u<t&&d(b,c[c.length-1],u),d(b,s[s.length-1],t)}else null===y&&v.flush(p.context.currentTime),v.add(l(s,e,n)),m.setValueCurveAtTime(s,e,n);return b}};return n.set(b,m),e.set(b,p),t(b,y),b})((ci=xe,(t,e)=>{ci.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),js,Te,t=>({replay(e){for(const n of t)if("exponentialRampToValue"===n.type){const{endTime:t,value:s}=n;e.exponentialRampToValueAtTime(s,t)}else if("linearRampToValue"===n.type){const{endTime:t,value:s}=n;e.linearRampToValueAtTime(s,t)}else if("setTarget"===n.type){const{startTime:t,target:s,timeConstant:i}=n;e.setTargetAtTime(s,t,i)}else if("setValue"===n.type){const{startTime:t,value:s}=n;e.setValueAtTime(s,t)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:s,values:i}=n;e.setValueCurveAtTime(i,s,t)}}}}),ve.createCancelAndHoldAutomationEvent,ve.createCancelScheduledValuesAutomationEvent,ve.createExponentialRampToValueAutomationEvent,ve.createLinearRampToValueAutomationEvent,ve.createSetTargetAutomationEvent,ve.createSetValueAutomationEvent,ve.createSetValueCurveAutomationEvent,$s,gs);var ci;const ui=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const a=r(t),c={...Qe,...s},u=i(a,c),l=o(a),h=l?e():null;super(t,!1,u,h),this._audioBufferSourceNodeRenderer=h,this._isBufferNullified=!1,this._isBufferSet=null!==c.buffer,this._nativeAudioBufferSourceNode=u,this._onended=null,this._playbackRate=n(this,l,u.playbackRate,Ze,Xe)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){Fe(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),He(this)&&Le(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}})(zs,oi,ai,jn,ii,Vs,Fs,ws),li=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,n){const s=r(t),c=o(s),u=i(s,n,c);super(t,!1,u,c?e(a):null),this._isNodeOfNativeOfflineAudioContext=c,this._nativeAudioDestinationNode=u}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(zs,t=>{let e=null;return{render:(n,s,i)=>(null===e&&(e=(async(e,n,s)=>{const i=n.destination;return await t(e,n,i,s),i})(n,s,i)),e)}},ze,jn,((t,e)=>(n,s,i)=>{const r=n.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=t(n,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",t=>()=>t.call(o),t=>e=>{t.call(o,e);try{r.channelCount=e}catch(t){if(e>r.maxChannelCount)throw t}}),e(o,"channelCountMode",t=>()=>t.call(o),t=>e=>{t.call(o,e),r.channelCountMode=e}),e(o,"channelInterpretation",t=>()=>t.call(o),t=>e=>{t.call(o,e),r.channelInterpretation=e}),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o})(ss,ms),Vs,Fs,Ns),hi=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,c){const u=r.get(a);return void 0!==u?Promise.resolve(u):(async(o,a,c)=>{let u=n(o);const l=We(u,a);if(!l){const t={Q:u.Q.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,detune:u.detune.value,frequency:u.frequency.value,gain:u.gain.value,type:u.type};u=e(a,t)}return r.set(a,u),l?(await t(a,o.Q,u.Q,c),await t(a,o.detune,u.detune,c),await t(a,o.frequency,u.frequency,c),await t(a,o.gain,u.gain,c)):(await s(a,o.Q,u.Q,c),await s(a,o.detune,u.detune,c),await s(a,o.frequency,u.frequency,c),await s(a,o.gain,u.gain,c)),await i(o,a,u,c),u})(o,a,c)}}})(si,Kn,fn,ri,Ns),di=(t=>(e,n)=>t.set(e,n))(ks),pi=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const c=r(t),u={...En,...s},l=i(c,u),h=o(c);super(t,!1,l,h?n():null),this._Q=e(this,h,l.Q,Ze,Xe),this._detune=e(this,h,l.detune,1200*Math.log2(Ze),-1200*Math.log2(Ze)),this._frequency=e(this,h,l.frequency,t.sampleRate/2,0),this._gain=e(this,h,l.gain,40*Math.log10(Ze),Xe),this._nativeBiquadFilterNode=l,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n)}catch(t){if(11===t.code)throw s();throw t}if(t.length!==e.length||e.length!==n.length)throw s()}})(zs,ai,hi,Ln,Kn,Vs,Fs,di),fi=((t,e)=>(n,s,i)=>{const r=new Set;return n.connect=(i=>(o,a=0,c=0)=>{const u=0===r.size;if(e(o))return i.call(n,o,a,c),t(r,[o,a,c],t=>t[0]===o&&t[1]===a&&t[2]===c,!0),u&&s(),o;i.call(n,o,a),t(r,[o,a],t=>t[0]===o&&t[1]===a,!0),u&&s()})(n.connect),n.disconnect=(t=>(s,o,a)=>{const c=r.size>0;if(void 0===s)t.apply(n),r.clear();else if("number"==typeof s){t.call(n,s);for(const t of r)t[1]===s&&r.delete(t)}else{e(s)?t.call(n,s,o,a):t.call(n,s,o);for(const t of r)t[0]!==s||void 0!==o&&t[1]!==o||void 0!==a&&t[2]!==a||r.delete(t)}const u=0===r.size;c&&u&&i()})(n.disconnect),n})(rn,Ws),mi=((t,e)=>(n,s)=>{const i=n.createChannelMerger(s.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(n,i),Gn(i,s),i})($s,((t,e)=>(n,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=n.createBufferSource();e(s,()=>{const t=s.numberOfInputs;for(let e=0;e<t;e+=1)i.connect(s,0,e)},()=>i.disconnect(s))})(jn,fi)),gi=((t,e,n,s,i)=>class extends t{constructor(t,r){const o=s(t),a={...Dn,...r};super(t,!1,n(o,a),i(o)?e():null)}})(zs,((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!We(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=t(r,e)}return s.set(r,a),await n(i,r,a,o),a})(i,r,o)}}})(mi,fn,Ns),mi,Vs,Fs),_i=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),c=r({...In,...o});super(t,!1,n(a,c),i(a)?e():null)}})(zs,((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!We(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=t(r,e)}return s.set(r,a),await n(i,r,a,o),a})(i,r,o)}}})(ts,fn,Ns),ts,Vs,Fs,t=>({...t,channelCount:t.numberOfOutputs})),vi=((t,e,n,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),u=n(i,{...o,gain:r}),l=a.getChannelData(0);l[0]=1,l[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(t){u.channelCount=t},get channelCountMode(){return u.channelCountMode},set channelCountMode(t){u.channelCountMode=t},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(t){u.channelInterpretation=t},get context(){return u.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get offset(){return u.gain},get onended(){return c.onended},set onended(t){c.onended=t},addEventListener:(...t)=>c.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>c.dispatchEvent(t[0]),removeEventListener:(...t)=>c.removeEventListener(t[0],t[1],t[2]),start(t=0){c.start.call(c,t)},stop(t=0){c.stop.call(c,t)}};return t(i,c),s(es(h,u),()=>c.connect(u),()=>c.disconnect(u))})(ei,ii,ss,fi),yi=((t,e,n,s,i)=>(r,o)=>{if(void 0===r.createConstantSource)return n(r,o);const a=r.createConstantSource();return Gn(a,o),Xn(a,o,"offset"),e(s,()=>s(r))||Zn(a),e(i,()=>i(r))||Hn(a),t(r,a),a})(ei,Ss,vi,_s,ys),bi=((t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),c={...Nn,...o},u=s(a,c),l=r(a),h=l?n():null;super(t,!1,u,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=u,this._offset=e(this,l,u.offset,Ze,Xe),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeConstantSourceNode.onended=e;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){Fe(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),He(this)&&Le(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}})(zs,ai,((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(c,u,l){const h=r.get(u);return void 0!==h?Promise.resolve(h):(async(c,u,l)=>{let h=n(c);const d=We(h,u);if(!d){const t={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,t),null!==o&&h.start(o),null!==a&&h.stop(a)}return r.set(u,h),d?await t(u,c.offset,h.offset,l):await s(u,c.offset,h.offset,l),await i(c,u,h,l),h})(c,u,l)}}})(si,yi,fn,ri,Ns),yi,Vs,Fs,ws),wi=((t,e)=>(n,s)=>{const i=n.createConvolver();if(Gn(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),zn(i,s,"buffer"),s.channelCount>2)throw t();if(e(i,"channelCount",t=>()=>t.call(i),e=>n=>{if(n>2)throw t();return e.call(i,n)}),"max"===s.channelCountMode)throw t();return e(i,"channelCountMode",t=>()=>t.call(i),e=>n=>{if("max"===n)throw t();return e.call(i,n)}),i})(as,ms),xi=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),c={...Rn,...o},u=n(a,c);super(t,!1,u,i(a)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=u,null!==c.buffer&&r(this,c.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,44100),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}})(zs,((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!We(a,r)){const e={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=t(r,e)}return s.set(r,a),cn(a)?await n(i,r,a.inputs[0],o):await n(i,r,a,o),a})(i,r,o)}}})(wi,fn,Ns),wi,Vs,Fs,di),Ti=((t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const c=i(t),u={...Vn,...a},l=s(c,u),h=r(c);super(t,!1,l,h?n(u.maxDelayTime):null),this._delayTime=e(this,h,l.delayTime),o(this,u.maxDelayTime)}get delayTime(){return this._delayTime}})(zs,ai,((t,e,n,s,i)=>r=>{const o=new WeakMap;return{render(a,c,u){const l=o.get(c);return void 0!==l?Promise.resolve(l):(async(a,c,u)=>{let l=n(a);const h=We(l,c);if(!h){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,delayTime:l.delayTime.value,maxDelayTime:r};l=e(c,t)}return o.set(c,l),h?await t(c,a.delayTime,l.delayTime,u):await s(c,a.delayTime,l.delayTime,u),await i(a,c,l,u),l})(a,c,u)}}})(si,ns,fn,ri,Ns),ns,Vs,Fs,di),Ci=(t=>(e,n)=>{const s=e.createDynamicsCompressor();if(Gn(s,n),n.channelCount>2)throw t();if("max"===n.channelCountMode)throw t();return Xn(s,n,"attack"),Xn(s,n,"knee"),Xn(s,n,"ratio"),Xn(s,n,"release"),Xn(s,n,"threshold"),s})(as),ki=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,i){const c=r(t),u={...qn,...i},l=s(c,u),h=o(c);super(t,!1,l,h?n():null),this._attack=e(this,h,l.attack),this._knee=e(this,h,l.knee),this._nativeDynamicsCompressorNode=l,this._ratio=e(this,h,l.ratio),this._release=e(this,h,l.release),this._threshold=e(this,h,l.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(zs,ai,((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,c){const u=r.get(a);return void 0!==u?Promise.resolve(u):(async(o,a,c)=>{let u=n(o);const l=We(u,a);if(!l){const t={attack:u.attack.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,knee:u.knee.value,ratio:u.ratio.value,release:u.release.value,threshold:u.threshold.value};u=e(a,t)}return r.set(a,u),l?(await t(a,o.attack,u.attack,c),await t(a,o.knee,u.knee,c),await t(a,o.ratio,u.ratio,c),await t(a,o.release,u.release,c),await t(a,o.threshold,u.threshold,c)):(await s(a,o.attack,u.attack,c),await s(a,o.knee,u.knee,c),await s(a,o.ratio,u.ratio,c),await s(a,o.release,u.release,c),await s(a,o.threshold,u.threshold,c)),await i(o,a,u,c),u})(o,a,c)}}})(si,Ci,fn,ri,Ns),Ci,as,Vs,Fs,di),Ai=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),c={...Fn,...o},u=s(a,c),l=r(a);super(t,!1,u,l?n():null),this._gain=e(this,l,u.gain,Ze,Xe)}get gain(){return this._gain}})(zs,ai,((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,c){const u=r.get(a);return void 0!==u?Promise.resolve(u):(async(o,a,c)=>{let u=n(o);const l=We(u,a);if(!l){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,gain:u.gain.value};u=e(a,t)}return r.set(a,u),l?await t(a,o.gain,u.gain,c):await s(a,o.gain,u.gain,c),await i(o,a,u,c),u})(o,a,c)}}})(si,ss,fn,ri,Ns),ss,Vs,Fs),Si=((t,e,n,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:u,feedforward:l})=>{const h=Qn(r,i.sampleRate),d=u instanceof Float64Array?u:new Float64Array(u),p=l instanceof Float64Array?l:new Float64Array(l),f=d.length,m=p.length,g=Math.min(f,m);if(0===f||f>20)throw s();if(0===d[0])throw e();if(0===m||m>20)throw s();if(0===p[0])throw e();if(1!==d[0]){for(let t=0;t<m;t+=1)p[t]/=d[0];for(let t=1;t<f;t+=1)d[t]/=d[0]}const _=n(i,h,o,o);_.channelCount=o,_.channelCountMode=a,_.channelInterpretation=c;const v=[],y=[],b=[];for(let t=0;t<o;t+=1){v.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),y.push(t),b.push(e)}_.onaudioprocess=t=>{const e=t.inputBuffer,n=t.outputBuffer,s=e.numberOfChannels;for(let t=0;t<s;t+=1){const s=e.getChannelData(t),i=n.getChannelData(t);v[t]=Bn(d,f,p,m,g,y[t],b[t],v[t],32,s,i)}};const w=i.sampleRate/2;return es({get bufferSize(){return h},get channelCount(){return _.channelCount},set channelCount(t){_.channelCount=t},get channelCountMode(){return _.channelCountMode},set channelCountMode(t){_.channelCountMode=t},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(t){_.channelInterpretation=t},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener:(...t)=>_.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>_.dispatchEvent(t[0]),getFrequencyResponse(e,n,s){if(e.length!==n.length||n.length!==s.length)throw t();const i=e.length;for(let t=0;t<i;t+=1){const i=-Math.PI*(e[t]/w),r=[Math.cos(i),Math.sin(i)],o=is(rs(p,r),rs(d,r));n[t]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),s[t]=Math.atan2(o[1],o[0])}},removeEventListener:(...t)=>_.removeEventListener(t[0],t[1],t[2])},_)})(Ln,jn,os,as),Oi=((t,e,n,s)=>i=>t(Un,()=>Un(i))?Promise.resolve(t(s,s)).then(t=>{if(!t){const t=n(i,512,0,1);i.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>i.currentTime,t.connect(i.destination)}return i.startRendering()}):new Promise(t=>{const n=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=e=>{n.disconnect(),t(e.renderedBuffer)},n.connect(i.destination),i.startRendering()}))(Ss,ss,os,((t,e)=>()=>{if(null===e)return Promise.resolve(!1);const n=new e(1,1,44100),s=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(t=>{n.oncomplete=()=>{s.disconnect(),t(0!==n.currentTime)},n.startRendering()})})(ss,qs)),Mi=((t,e,n,s,i)=>(r,o)=>{const a=new WeakMap;let c=null;const u=async(u,l,h)=>{let d=null,p=e(u);const f=We(p,l);if(void 0===l.createIIRFilter?d=t(l,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):f||(p=l.createIIRFilter(o,r)),a.set(l,null===d?p:d),null!==d){if(null===c){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new n(u.context.destination.channelCount,u.context.length,l.sampleRate);c=(async()=>{await s(u,t,t.destination,h);return((t,e,n,s)=>{const i=n instanceof Float64Array?n:new Float64Array(n),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,c=Math.min(o,a);if(1!==i[0]){for(let t=0;t<o;t+=1)r[t]/=i[0];for(let t=1;t<a;t+=1)i[t]/=i[0]}const u=new Float32Array(32),l=new Float32Array(32),h=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),d=t.numberOfChannels;for(let e=0;e<d;e+=1){const n=t.getChannelData(e),s=h.getChannelData(e);u.fill(0),l.fill(0),Bn(i,o,r,a,c,u,l,0,32,n,s)}return h})(await i(t),l,r,o)})()}const t=await c;return d.buffer=t,d.start(0),d}return await s(u,l,p,h),p};return{render(t,e,n){const s=a.get(e);return void 0!==s?Promise.resolve(s):u(t,e,n)}}})(ii,fn,qs,Ns,Oi),Ei=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),c=i(a),u={...$n,...o},l=e(a,c?null:t.baseLatency,u);super(t,!1,l,c?n(u.feedback,u.feedforward):null),(t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(n,s,i)=>{if(n.length!==s.length||s.length!==i.length)throw Ln();return e.call(t,n,s,i)})})(l),this._nativeIIRFilterNode=l,r(this,1)}getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}})(zs,(t=>(e,n,s)=>{if(void 0===e.createIIRFilter)return t(e,n,s);const i=e.createIIRFilter(s.feedforward,s.feedback);return Gn(i,s),i})(Si),Mi,Vs,Fs,di),Di=((t,e,n,s,i)=>(r,o)=>{const a=o.listener,{forwardX:c,forwardY:u,forwardZ:l,positionX:h,positionY:d,positionZ:p,upX:f,upY:m,upZ:g}=void 0===a.forwardX?(()=>{const c=e(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),u=i(o),l=s(o,256,9,0),h=(e,s)=>{const i=n(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:s});return i.connect(c,0,e),i.start(),Object.defineProperty(i.offset,"defaultValue",{get:()=>s}),t({context:r},u,i.offset,Ze,Xe)};let d=[0,0,-1,0,1,0],p=[0,0,0];return l.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0],t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];e.some((t,e)=>t!==d[e])&&(a.setOrientation(...e),d=e);const n=[t.getChannelData(6)[0],t.getChannelData(7)[0],t.getChannelData(8)[0]];n.some((t,e)=>t!==p[e])&&(a.setPosition(...n),p=n)},c.connect(l),{forwardX:h(0,0),forwardY:h(1,0),forwardZ:h(2,-1),positionX:h(6,0),positionY:h(7,0),positionZ:h(8,0),upX:h(3,0),upY:h(4,1),upZ:h(5,0)}})():a;return{get forwardX(){return c},get forwardY(){return u},get forwardZ(){return l},get positionX(){return h},get positionY(){return d},get positionZ(){return p},get upX(){return f},get upY(){return m},get upZ(){return g}}})(ai,mi,yi,os,Fs),Ii=new WeakMap,Ni=((t,e,n,s,i,r)=>class extends n{constructor(n,r){super(n),this._nativeContext=n,Ce.set(this,n),s(n)&&i.set(n,new Set),this._destination=new t(this,r),this._listener=e(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?r(this,t):null;this._nativeContext.onstatechange=e;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(li,Di,Ls,Fs,Ii,ws),Ri=((t,e,n,s,i,r)=>(o,a)=>{const c=o.createOscillator();return Gn(c,a),Xn(c,a,"detune"),Xn(c,a,"frequency"),void 0!==a.periodicWave?c.setPeriodicWave(a.periodicWave):zn(c,a,"type"),e(n,()=>n(o))||Zn(c),e(s,()=>s(o))||r(c,o),e(i,()=>i(o))||Hn(c),t(o,c),c})(ei,Ss,_s,vs,ys,bs),Vi=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,c=null;return{set periodicWave(t){o=t},set start(t){a=t},set stop(t){c=t},render(u,l,h){const d=r.get(l);return void 0!==d?Promise.resolve(d):(async(u,l,h)=>{let d=n(u);const p=We(d,l);if(!p){const t={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:null===o?void 0:o,type:d.type};d=e(l,t),null!==a&&d.start(a),null!==c&&d.stop(c)}return r.set(l,d),p?(await t(l,u.detune,d.detune,h),await t(l,u.frequency,d.frequency,h)):(await s(l,u.detune,d.detune,h),await s(l,u.frequency,d.frequency,h)),await i(u,l,d,h),d})(u,l,h)}}})(si,Ri,fn,ri,Ns),Pi=((t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),c={...us,...o},u=n(a,c),l=r(a),h=l?s():null,d=t.sampleRate/2;super(t,!1,u,h),this._detune=e(this,l,u.detune,153600,-153600),this._frequency=e(this,l,u.frequency,d,-d),this._nativeOscillatorNode=u,this._onended=null,this._oscillatorNodeRenderer=h,null!==this._oscillatorNodeRenderer&&void 0!==c.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=c.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeOscillatorNode.onended=e;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){Fe(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),He(this)&&Le(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}})(zs,ai,Ri,Vi,Vs,Fs,ws),qi=(t=>(e,n)=>{const s=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(n),s.start(),()=>{s.stop(),s.disconnect(n)}})(ii),Fi=((t,e,n,s,i)=>(r,{curve:o,oversample:a,...c})=>{const u=r.createWaveShaper(),l=r.createWaveShaper();Gn(u,c),Gn(l,c);const h=n(r,{...c,gain:1}),d=n(r,{...c,gain:-1}),p=n(r,{...c,gain:1}),f=n(r,{...c,gain:-1});let m=null,g=!1,_=null;const v={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(t){h.channelCount=t,d.channelCount=t,u.channelCount=t,p.channelCount=t,l.channelCount=t,f.channelCount=t},get channelCountMode(){return u.channelCountMode},set channelCountMode(t){h.channelCountMode=t,d.channelCountMode=t,u.channelCountMode=t,p.channelCountMode=t,l.channelCountMode=t,f.channelCountMode=t},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(t){h.channelInterpretation=t,d.channelInterpretation=t,u.channelInterpretation=t,p.channelInterpretation=t,l.channelInterpretation=t,f.channelInterpretation=t},get context(){return u.context},get curve(){return _},set curve(n){if(null!==n&&n.length<2)throw e();if(null===n)u.curve=n,l.curve=n;else{const t=n.length,e=new Float32Array(t+2-t%2),s=new Float32Array(t+2-t%2);e[0]=n[0],s[0]=-n[t-1];const i=Math.ceil((t+1)/2),r=(t+1)/2-1;for(let o=1;o<i;o+=1){const a=o/i*r,c=Math.floor(a),u=Math.ceil(a);e[o]=c===u?n[c]:(1-(a-c))*n[c]+(1-(u-a))*n[u],s[o]=c===u?-n[t-1-c]:-(1-(a-c))*n[t-1-c]-(1-(u-a))*n[t-1-u]}e[i]=t%2==1?n[i-1]:(n[i-2]+n[i-1])/2,u.curve=e,l.curve=s}_=n,g&&(s(_)&&null===m?m=t(r,h):null!==m&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get oversample(){return u.oversample},set oversample(t){u.oversample=t,l.oversample=t},addEventListener:(...t)=>h.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>h.dispatchEvent(t[0]),removeEventListener:(...t)=>h.removeEventListener(t[0],t[1],t[2])};null!==o&&(v.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==v.oversample&&(v.oversample=a);return i(es(v,p),()=>{h.connect(u).connect(p),h.connect(d).connect(l).connect(f).connect(p),g=!0,s(_)&&(m=t(r,h))},()=>{h.disconnect(u),u.disconnect(p),h.disconnect(d),d.disconnect(l),l.disconnect(f),f.disconnect(p),g=!1,null!==m&&(m(),m=null)})})(qi,jn,ss,fs,fi),ji=((t,e,n,s,i,r,o)=>(a,c)=>{const u=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return n(a,c);Gn(u,c);const l=null===c.curve||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(null!==l&&l.length<2)throw e();zn(u,{curve:l},"curve"),zn(u,c,"oversample");let h=null,d=!1;o(u,"curve",t=>()=>t.call(u),e=>n=>(e.call(u,n),d&&(s(n)&&null===h?h=t(a,u):s(n)||null===h||(h(),h=null)),n));return i(u,()=>{d=!0,s(u.curve)&&(h=t(a,u))},()=>{d=!1,null!==h&&(h(),h=null)})})(qi,jn,Fi,fs,fi,$s,ms),Li=(t=>(e,n)=>{const s=e.createPanner();return void 0===s.orientationX?t(e,n):(Gn(s,n),Xn(s,n,"orientationX"),Xn(s,n,"orientationY"),Xn(s,n,"orientationZ"),Xn(s,n,"positionX"),Xn(s,n,"positionY"),Xn(s,n,"positionZ"),zn(s,n,"coneInnerAngle"),zn(s,n,"coneOuterAngle"),zn(s,n,"coneOuterGain"),zn(s,n,"distanceModel"),zn(s,n,"maxDistance"),zn(s,n,"panningModel"),zn(s,n,"refDistance"),zn(s,n,"rolloffFactor"),s)})(((t,e,n,s,i,r,o,a,c)=>(u,{coneInnerAngle:l,coneOuterAngle:h,coneOuterGain:d,distanceModel:p,maxDistance:f,orientationX:m,orientationY:g,orientationZ:_,panningModel:v,positionX:y,positionY:b,positionZ:w,refDistance:x,rolloffFactor:T,...C})=>{const k=u.createPanner();if(C.channelCount>2)throw o();if("max"===C.channelCountMode)throw o();Gn(k,C);const A={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},S=n(u,{...A,channelInterpretation:"speakers",numberOfInputs:6}),O=s(u,{...C,gain:1}),M=s(u,{...A,gain:1}),E=s(u,{...A,gain:0}),D=s(u,{...A,gain:0}),I=s(u,{...A,gain:0}),N=s(u,{...A,gain:0}),R=s(u,{...A,gain:0}),V=i(u,256,6,1),P=r(u,{...A,curve:new Float32Array([1,1]),oversample:"none"});let q=[m,g,_],F=[y,b,w];V.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0]];e.some((t,e)=>t!==q[e])&&(k.setOrientation(...e),q=e);const n=[t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];n.some((t,e)=>t!==F[e])&&(k.setPosition(...n),F=n)},Object.defineProperty(E.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0});const j={get bufferSize(){},get channelCount(){return k.channelCount},set channelCount(t){if(t>2)throw o();O.channelCount=t,k.channelCount=t},get channelCountMode(){return k.channelCountMode},set channelCountMode(t){if("max"===t)throw o();O.channelCountMode=t,k.channelCountMode=t},get channelInterpretation(){return k.channelInterpretation},set channelInterpretation(t){O.channelInterpretation=t,k.channelInterpretation=t},get coneInnerAngle(){return k.coneInnerAngle},set coneInnerAngle(t){k.coneInnerAngle=t},get coneOuterAngle(){return k.coneOuterAngle},set coneOuterAngle(t){k.coneOuterAngle=t},get coneOuterGain(){return k.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();k.coneOuterGain=t},get context(){return k.context},get distanceModel(){return k.distanceModel},set distanceModel(t){k.distanceModel=t},get inputs(){return[O]},get maxDistance(){return k.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;k.maxDistance=t},get numberOfInputs(){return k.numberOfInputs},get numberOfOutputs(){return k.numberOfOutputs},get orientationX(){return M.gain},get orientationY(){return E.gain},get orientationZ(){return D.gain},get panningModel(){return k.panningModel},set panningModel(t){k.panningModel=t},get positionX(){return I.gain},get positionY(){return N.gain},get positionZ(){return R.gain},get refDistance(){return k.refDistance},set refDistance(t){if(t<0)throw new RangeError;k.refDistance=t},get rolloffFactor(){return k.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;k.rolloffFactor=t},addEventListener:(...t)=>O.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>O.dispatchEvent(t[0]),removeEventListener:(...t)=>O.removeEventListener(t[0],t[1],t[2])};l!==j.coneInnerAngle&&(j.coneInnerAngle=l),h!==j.coneOuterAngle&&(j.coneOuterAngle=h),d!==j.coneOuterGain&&(j.coneOuterGain=d),p!==j.distanceModel&&(j.distanceModel=p),f!==j.maxDistance&&(j.maxDistance=f),m!==j.orientationX.value&&(j.orientationX.value=m),g!==j.orientationY.value&&(j.orientationY.value=g),_!==j.orientationZ.value&&(j.orientationZ.value=_),v!==j.panningModel&&(j.panningModel=v),y!==j.positionX.value&&(j.positionX.value=y),b!==j.positionY.value&&(j.positionY.value=b),w!==j.positionZ.value&&(j.positionZ.value=w),x!==j.refDistance&&(j.refDistance=x),T!==j.rolloffFactor&&(j.rolloffFactor=T),1===q[0]&&0===q[1]&&0===q[2]||k.setOrientation(...q),0===F[0]&&0===F[1]&&0===F[2]||k.setPosition(...F);return c(es(j,k),()=>{O.connect(k),t(O,P,0,0),P.connect(M).connect(S,0,0),P.connect(E).connect(S,0,1),P.connect(D).connect(S,0,2),P.connect(I).connect(S,0,3),P.connect(N).connect(S,0,4),P.connect(R).connect(S,0,5),S.connect(V).connect(u.destination)},()=>{O.disconnect(k),a(O,P,0,0),P.disconnect(M),M.disconnect(S),P.disconnect(E),E.disconnect(S),P.disconnect(D),D.disconnect(S),P.disconnect(I),I.disconnect(S),P.disconnect(N),N.disconnect(S),P.disconnect(R),R.disconnect(S),S.disconnect(V),V.disconnect(u.destination)})})(un,jn,mi,ss,os,ji,as,pn,fi)),$i=((t,e,n,s,i,r,o,a,c,u)=>()=>{const l=new WeakMap;let h=null;return{render(d,p,f){const m=l.get(p);return void 0!==m?Promise.resolve(m):(async(d,p,f)=>{let m=null,g=r(d);const _={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},v={..._,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},y=We(g,p);if("bufferSize"in g)m=s(p,{..._,gain:1});else if(!y){const t={...v,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=i(p,t)}if(l.set(p,null===m?g:m),null!==m){if(null===h){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new o(6,d.context.length,p.sampleRate),s=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});s.connect(t.destination),h=(async()=>{const e=await Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map(async(e,s)=>{const i=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===s?1:0});return await a(t,e,i.offset,f),i}));for(let t=0;t<6;t+=1)e[t].connect(s,0,t),e[t].start(0);return u(t)})()}const t=await h,r=s(p,{..._,gain:1});await c(d,p,r,f);const l=[];for(let e=0;e<t.numberOfChannels;e+=1)l.push(t.getChannelData(e));let g=[l[0][0],l[1][0],l[2][0]],y=[l[3][0],l[4][0],l[5][0]],b=s(p,{..._,gain:1}),w=i(p,{...v,orientationX:g[0],orientationY:g[1],orientationZ:g[2],positionX:y[0],positionY:y[1],positionZ:y[2]});r.connect(b).connect(w.inputs[0]),w.connect(m);for(let e=128;e<t.length;e+=128){const t=[l[0][e],l[1][e],l[2][e]],n=[l[3][e],l[4][e],l[5][e]];if(t.some((t,e)=>t!==g[e])||n.some((t,e)=>t!==y[e])){g=t,y=n;const o=e/p.sampleRate;b.gain.setValueAtTime(0,o),b=s(p,{..._,gain:0}),w=i(p,{...v,orientationX:g[0],orientationY:g[1],orientationZ:g[2],positionX:y[0],positionY:y[1],positionZ:y[2]}),b.gain.setValueAtTime(1,o),r.connect(b).connect(w.inputs[0]),w.connect(m)}}return m}return y?(await t(p,d.orientationX,g.orientationX,f),await t(p,d.orientationY,g.orientationY,f),await t(p,d.orientationZ,g.orientationZ,f),await t(p,d.positionX,g.positionX,f),await t(p,d.positionY,g.positionY,f),await t(p,d.positionZ,g.positionZ,f)):(await a(p,d.orientationX,g.orientationX,f),await a(p,d.orientationY,g.orientationY,f),await a(p,d.orientationZ,g.orientationZ,f),await a(p,d.positionX,g.positionX,f),await a(p,d.positionY,g.positionY,f),await a(p,d.positionZ,g.positionZ,f)),cn(g)?await c(d,p,g.inputs[0],f):await c(d,p,g,f),g})(d,p,f)}}})(si,mi,yi,ss,Li,fn,qs,ri,Ns,Oi),Bi=((t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const c=i(t),u={...ls,...a},l=n(c,u),h=r(c);super(t,!1,l,h?s():null),this._nativePannerNode=l,this._orientationX=e(this,h,l.orientationX,Ze,Xe),this._orientationY=e(this,h,l.orientationY,Ze,Xe),this._orientationZ=e(this,h,l.orientationZ,Ze,Xe),this._positionX=e(this,h,l.positionX,Ze,Xe),this._positionY=e(this,h,l.positionY,Ze,Xe),this._positionZ=e(this,h,l.positionZ,Ze,Xe),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}})(zs,ai,Li,$i,Vs,Fs,di),Wi=((t,e,n,s)=>class i{constructor(i,r){const o=e(i),a=s({...hs,...r}),c=t(o,a);return n.add(c),c}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===i.prototype||n.has(t)}})((t=>(e,{disableNormalization:n,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:n});if(Array.from(s).length<2)throw t();return a})(ze),Vs,new WeakSet,t=>{const{imag:e,real:n}=t;return void 0===e?void 0===n?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,()=>0),real:n}:void 0===n?{...t,imag:e,real:Array.from(e,()=>0)}:{...t,imag:e,real:n}}),Ui=((t,e)=>(n,s)=>{const i=s.channelCountMode;if("clamped-max"===i)throw e();if(void 0===n.createStereoPanner)return t(n,s);const r=n.createStereoPanner();return Gn(r,s),Xn(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:t=>{if(t!==i)throw e()}}),r})(((t,e,n,s,i,r)=>{const o=new Float32Array([1,1]),a=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...c,oversample:"none"},l=(t,r,l,h,d)=>{if(1===r)return((t,e,i,r)=>{const l=new Float32Array(16385),h=new Float32Array(16385);for(let t=0;t<16385;t+=1){const e=t/16384*a;l[t]=Math.cos(e),h[t]=Math.sin(e)}const d=n(t,{...c,gain:0}),p=s(t,{...u,curve:l}),f=s(t,{...u,curve:o}),m=n(t,{...c,gain:0}),g=s(t,{...u,curve:h});return{connectGraph(){e.connect(d),e.connect(void 0===f.inputs?f:f.inputs[0]),e.connect(m),f.connect(i),i.connect(void 0===p.inputs?p:p.inputs[0]),i.connect(void 0===g.inputs?g:g.inputs[0]),p.connect(d.gain),g.connect(m.gain),d.connect(r,0,0),m.connect(r,0,1)},disconnectGraph(){e.disconnect(d),e.disconnect(void 0===f.inputs?f:f.inputs[0]),e.disconnect(m),f.disconnect(i),i.disconnect(void 0===p.inputs?p:p.inputs[0]),i.disconnect(void 0===g.inputs?g:g.inputs[0]),p.disconnect(d.gain),g.disconnect(m.gain),d.disconnect(r,0,0),m.disconnect(r,0,1)}}})(t,l,h,d);if(2===r)return((t,i,r,l)=>{const h=new Float32Array(16385),d=new Float32Array(16385),p=new Float32Array(16385),f=new Float32Array(16385),m=Math.floor(8192.5);for(let t=0;t<16385;t+=1)if(t>m){const e=(t-m)/(16384-m)*a;h[t]=Math.cos(e),d[t]=Math.sin(e),p[t]=0,f[t]=1}else{const e=t/(16384-m)*a;h[t]=1,d[t]=0,p[t]=Math.cos(e),f[t]=Math.sin(e)}const g=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),_=n(t,{...c,gain:0}),v=s(t,{...u,curve:h}),y=n(t,{...c,gain:0}),b=s(t,{...u,curve:d}),w=s(t,{...u,curve:o}),x=n(t,{...c,gain:0}),T=s(t,{...u,curve:p}),C=n(t,{...c,gain:0}),k=s(t,{...u,curve:f});return{connectGraph(){i.connect(g),i.connect(void 0===w.inputs?w:w.inputs[0]),g.connect(_,0),g.connect(y,0),g.connect(x,1),g.connect(C,1),w.connect(r),r.connect(void 0===v.inputs?v:v.inputs[0]),r.connect(void 0===b.inputs?b:b.inputs[0]),r.connect(void 0===T.inputs?T:T.inputs[0]),r.connect(void 0===k.inputs?k:k.inputs[0]),v.connect(_.gain),b.connect(y.gain),T.connect(x.gain),k.connect(C.gain),_.connect(l,0,0),x.connect(l,0,0),y.connect(l,0,1),C.connect(l,0,1)},disconnectGraph(){i.disconnect(g),i.disconnect(void 0===w.inputs?w:w.inputs[0]),g.disconnect(_,0),g.disconnect(y,0),g.disconnect(x,1),g.disconnect(C,1),w.disconnect(r),r.disconnect(void 0===v.inputs?v:v.inputs[0]),r.disconnect(void 0===b.inputs?b:b.inputs[0]),r.disconnect(void 0===T.inputs?T:T.inputs[0]),r.disconnect(void 0===k.inputs?k:k.inputs[0]),v.disconnect(_.gain),b.disconnect(y.gain),T.disconnect(x.gain),k.disconnect(C.gain),_.disconnect(l,0,0),x.disconnect(l,0,0),y.disconnect(l,0,1),C.disconnect(l,0,1)}}})(t,l,h,d);throw i()};return(e,{channelCount:s,channelCountMode:o,pan:a,...c})=>{if("max"===o)throw i();const u=t(e,{...c,channelCount:1,channelCountMode:o,numberOfInputs:2}),h=n(e,{...c,channelCount:s,channelCountMode:o,gain:1}),d=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:p,disconnectGraph:f}=l(e,s,h,d,u);Object.defineProperty(d.gain,"defaultValue",{get:()=>0}),Object.defineProperty(d.gain,"maxValue",{get:()=>1}),Object.defineProperty(d.gain,"minValue",{get:()=>-1});const m={get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(t){h.channelCount!==t&&(g&&f(),({connectGraph:p,disconnectGraph:f}=l(e,t,h,d,u)),g&&p()),h.channelCount=t},get channelCountMode(){return h.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw i();h.channelCountMode=t},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(t){h.channelInterpretation=t},get context(){return h.context},get inputs(){return[h]},get numberOfInputs(){return h.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get pan(){return d.gain},addEventListener:(...t)=>h.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>h.dispatchEvent(t[0]),removeEventListener:(...t)=>h.removeEventListener(t[0],t[1],t[2])};let g=!1;return r(es(m,u),()=>{p(),g=!0},()=>{f(),g=!1})}})(mi,ts,ss,ji,as,fi),as),zi=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,c){const u=r.get(a);return void 0!==u?Promise.resolve(u):(async(o,a,c)=>{let u=n(o);const l=We(u,a);if(!l){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,pan:u.pan.value};u=e(a,t)}return r.set(a,u),l?await t(a,o.pan,u.pan,c):await s(a,o.pan,u.pan,c),cn(u)?await i(o,a,u.inputs[0],c):await i(o,a,u,c),u})(o,a,c)}}})(si,Ui,fn,ri,Ns),Gi=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),c={...ds,...o},u=n(a,c),l=r(a);super(t,!1,u,l?s():null),this._pan=e(this,l,u.pan)}get pan(){return this._pan}})(zs,ai,Ui,zi,Vs,Fs),Yi=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!We(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=t(r,e)}return s.set(r,a),cn(a)?await n(i,r,a.inputs[0],o):await n(i,r,a,o),a})(i,r,o)}}})(ji,fn,Ns),Xi=((t,e,n,s,i,r,o)=>class extends t{constructor(t,e){const a=i(t),c={...ps,...e},u=n(a,c);super(t,!0,u,r(a)?s():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=u,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}})(zs,jn,ji,Yi,Vs,Fs,di),Zi=(t=>null!==t&&t.isSecureContext)(Es),Hi=(t=>(e,n,s)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*n)},currentTime:{configurable:!0,get:()=>e}});try{return s()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}})(Es),Qi=new WeakMap,Ji=((t,e)=>n=>{let s=t.get(n);if(void 0!==s)return s;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,8e3),t.set(n,s),s})(Qi,qs),Ki=(t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null)(Es),tr=Zi?((t,e,n,s,i,r,o,a,c,u,l,h)=>(d,p,f={credentials:"omit"})=>{const m=r(d);if(void 0!==m.audioWorklet)return Promise.all([i(p),Promise.resolve(t(l,l))]).then(([[t,e],n])=>{const[s,i]=De(t,e),r=n?i:i.replace(/\s+extends\s+AudioWorkletProcessor\s*{/," extends (class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}){"),c=new Blob([`${s};(registerProcessor=>{${r}\n})((n,p)=>registerProcessor(n,class extends p{${n?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${n?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}))`],{type:"application/javascript; charset=utf-8"}),u=URL.createObjectURL(c);return m.audioWorklet.addModule(u,f).then(()=>{if(a(m))return;return o(m).audioWorklet.addModule(u,f)}).finally(()=>URL.revokeObjectURL(u))});const g=u.get(d);if(void 0!==g&&g.has(p))return Promise.resolve();const _=c.get(d);if(void 0!==_){const t=_.get(p);if(void 0!==t)return t}const v=i(p).then(([t,e])=>{const[s,i]=De(t,e);return n(`${s};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`)}).then(()=>{const t=h._AWGS.pop();if(void 0===t)throw new SyntaxError;s(m.currentTime,m.sampleRate,()=>t(class{},void 0,(t,n)=>{if(""===t.trim())throw e();const s=Se.get(m);if(void 0!==s){if(s.has(t))throw e();Ne(n),Ie(n.parameterDescriptors),s.set(t,n)}else Ne(n),Ie(n.parameterDescriptors),Se.set(m,new Map([[t,n]]))},m.sampleRate,void 0,void 0))});return void 0===_?c.set(d,new Map([[p,v]])):_.set(p,v),v.then(()=>{const t=u.get(d);void 0===t?u.set(d,new Set([p])):t.add(p)}).finally(()=>{const t=c.get(d);void 0!==t&&t.delete(p)}),v})(Ss,as,(t=>e=>new Promise((n,s)=>{if(null===t)return void s(new SyntaxError);const i=t.document.head;if(null===i)s(new SyntaxError);else{const r=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=t.onerror,u=()=>{t.onerror=c,URL.revokeObjectURL(a)};t.onerror=(e,n,i,r,o)=>n===a||n===t.location.href&&1===i&&1===r?(u(),s(o),!1):null!==c?c(e,n,i,r,o):void 0,r.onerror=()=>{u(),s(new SyntaxError)},r.onload=()=>{u(),n()},r.src=a,r.type="module",i.appendChild(r)}}))(Es),Hi,(t=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw t()})(()=>new DOMException("","AbortError")),Vs,Ji,Fs,new WeakMap,new WeakMap,((t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,8e3),i=URL.createObjectURL(n);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const e=new t(s,"a",{numberOfOutputs:0}),n=s.createOscillator();e.port.onmessage=()=>r=!0,e.onprocessorerror=()=>o=!0,n.connect(e),await s.startRendering()}catch{}finally{URL.revokeObjectURL(i)}return r&&!o})(Ki,qs),Es):void 0,er=((t,e)=>n=>t(n)||e(n))(Bs,Fs),nr=((t,e,n,s,i,r,o,a,c,u,l,h,d,p,f,m,g,_,v,y)=>class extends f{constructor(e,n){super(e,n),this._nativeContext=e,this._audioWorklet=void 0===t?void 0:{addModule:(e,n)=>t(this,e,n)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(t,e,s){return new n({length:e,numberOfChannels:t,sampleRate:s})}createBufferSource(){return new s(this)}createChannelMerger(t=6){return new r(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new o(this,{numberOfOutputs:t})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(t=1){return new l(this,{maxDelayTime:t})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(t,e){return new p(this,{feedback:e,feedforward:t})}createOscillator(){return new m(this)}createPanner(){return new g(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new _(this,{...n,imag:e,real:t})}createStereoPanner(){return new v(this)}createWaveShaper(){return new y(this)}decodeAudioData(t,e,n){return u(this._nativeContext,t).then(t=>("function"==typeof e&&e(t),t)).catch(t=>{throw"function"==typeof n&&n(t),t})}})(tr,Ys,ti,ui,pi,gi,_i,bi,xi,((t,e,n,s,i,r,o,a,c,u,l)=>(h,d)=>{const p=o(h)?h:r(h);if(i.has(d)){const t=n();return Promise.reject(t)}try{i.add(d)}catch{}return e(c,()=>c(p))?p.decodeAudioData(d).then(n=>(e(a,()=>a(n))||l(n),t.add(n),n)):new Promise((e,n)=>{const i=async()=>{try{await(t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise(s=>{n.onmessage=()=>{e.close(),n.close(),s()},e.postMessage(t,[t])})})(d)}catch{}},r=t=>{n(t),i()};try{p.decodeAudioData(d,n=>{"function"!=typeof n.copyFromChannel&&(u(n),Ge(n)),t.add(n),i().then(()=>e(n))},t=>{r(null===t?s():t)})}catch(t){r(t)}})})(Xs,Ss,()=>new DOMException("","DataCloneError"),()=>new DOMException("","EncodingError"),new WeakSet,Vs,er,Ue,Un,Js,Ks),Ti,ki,Ai,Ei,Ni,Pi,Bi,Wi,Gi,Xi),sr=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t),o=e(r,i);if(s(r))throw TypeError();super(t,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(zs,(t,e)=>t.createMediaElementSource(e.mediaElement),Vs,Fs),ir=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t);if(s(r))throw new TypeError;const o={...Wn,...i},a=e(r,o);super(t,!1,a,null),this._nativeMediaStreamAudioDestinationNode=a}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(zs,(t,e)=>{const n=t.createMediaStreamDestination();return Gn(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n},Vs,Fs),rr=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t),o=e(r,i);if(s(r))throw new TypeError;super(t,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(zs,(t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort((t,e)=>t.id<e.id?-1:t.id>e.id?1:0);const s=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:e}),i},Vs,Fs),or=((t,e,n)=>class extends t{constructor(t,s){const i=n(t);super(t,!0,e(i,s),null)}})(zs,((t,e)=>(n,{mediaStreamTrack:s})=>{if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=n.createMediaStreamSource(i);if("audio"!==s.kind)throw t();if(e(n))throw new TypeError;return r})(jn,Fs),Vs),ar=((t,e,n,s,i,r,o,a,c)=>class extends t{constructor(t={}){if(null===c)throw new Error("Missing the native AudioContext constructor.");const e=new c(t);if(null===e)throw s();if(!(t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t))(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:i}=t,{sampleRate:r}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===i?512/r:"interactive"===i||void 0===i?256/r:"playback"===i?1024/r:128*Math.max(2,Math.min(128,Math.round(i*r/128)))/r,this._nativeAudioContext=e,"webkitAudioContext"===c.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then(()=>{throw e()}):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then(()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),en(this)}))}createMediaElementSource(t){return new i(this,{mediaElement:t})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(t){return new o(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new a(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)}):this._nativeAudioContext.resume().catch(t=>{if(void 0===t||15===t.code)throw e();throw t})}suspend(){return this._nativeAudioContext.suspend().catch(t=>{if(void 0===t)throw e();throw t})}})(nr,jn,as,()=>new DOMException("","UnknownError"),sr,ir,rr,or,$s),cr=(t=>e=>{const n=t.get(e);if(void 0===n)throw new Error("The context has no set of AudioWorkletNodes.");return n})(Ii),ur=(t=>(e,n)=>{t(e).add(n)})(cr),lr=(t=>(e,n,s=0,i=0)=>{const r=e[s];if(void 0===r)throw t();return bn(n)?r.connect(n,0,i):r.connect(n,0)})(ze),hr=(t=>(e,n)=>{t(e).delete(n)})(cr),dr=(t=>(e,n,s,i=0)=>void 0===n?e.forEach(t=>t.disconnect()):"number"==typeof n?Pn(t,e,n).disconnect():bn(n)?void 0===s?e.forEach(t=>t.disconnect(n)):void 0===i?Pn(t,e,s).disconnect(n,0):Pn(t,e,s).disconnect(n,0,i):void 0===s?e.forEach(t=>t.disconnect(n)):Pn(t,e,s).disconnect(n,0))(ze),pr=new WeakMap,fr=((t,e)=>n=>e(t,n))(pr,Re),mr=((t,e,n,s,i,r,o,a,c,u,l,h,d)=>(p,f,m,g)=>{if(0===g.numberOfInputs&&0===g.numberOfOutputs)throw c();const _=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(_.some(t=>t<1))throw c();if(_.length!==g.numberOfOutputs)throw e();if("explicit"!==g.channelCountMode)throw c();const v=g.channelCount*g.numberOfInputs,y=_.reduce((t,e)=>t+e,0),b=void 0===m.parameterDescriptors?0:m.parameterDescriptors.length;if(v+b>6||y>6)throw c();const w=new MessageChannel,x=[],T=[];for(let t=0;t<g.numberOfInputs;t+=1)x.push(o(p,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),T.push(i(p,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const C=[];if(void 0!==m.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:n,name:s}of m.parameterDescriptors){const i=r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==g.parameterData[s]?g.parameterData[s]:void 0===t?0:t});Object.defineProperties(i.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?Ze:e},minValue:{get:()=>void 0===n?Xe:n}}),C.push(i)}const k=s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,v+b)}),A=Qn(f,p.sampleRate),S=a(p,A,v+b,Math.max(1,y)),O=i(p,{channelCount:Math.max(1,y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,y)}),M=[];for(let t=0;t<g.numberOfOutputs;t+=1)M.push(s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_[t]}));for(let t=0;t<g.numberOfInputs;t+=1){x[t].connect(T[t]);for(let e=0;e<g.channelCount;e+=1)T[t].connect(k,e,t*g.channelCount+e)}const E=new Cn(void 0===m.parameterDescriptors?[]:m.parameterDescriptors.map(({name:t},e)=>{const n=C[e];return n.connect(k,0,v+e),n.start(0),[t,n.offset]}));k.connect(S);let D=g.channelInterpretation,I=null;const N=0===g.numberOfOutputs?[S]:M,R={get bufferSize(){return A},get channelCount(){return g.channelCount},set channelCount(t){throw n()},get channelCountMode(){return g.channelCountMode},set channelCountMode(t){throw n()},get channelInterpretation(){return D},set channelInterpretation(t){for(const e of x)e.channelInterpretation=t;D=t},get context(){return S.context},get inputs(){return x},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return I},set onprocessorerror(t){"function"==typeof I&&R.removeEventListener("processorerror",I),I="function"==typeof t?t:null,"function"==typeof I&&R.addEventListener("processorerror",I)},get parameters(){return E},get port(){return w.port2},addEventListener:(...t)=>S.addEventListener(t[0],t[1],t[2]),connect:t.bind(null,N),disconnect:u.bind(null,N),dispatchEvent:(...t)=>S.dispatchEvent(t[0]),removeEventListener:(...t)=>S.removeEventListener(t[0],t[1],t[2])},V=new Map;var P,q;w.port1.addEventListener=(P=w.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=V.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{l(p.currentTime,p.sampleRate,()=>e(t))},V.set(e,t[1]))}}return P.call(w.port1,t[0],t[1],t[2])}),w.port1.removeEventListener=(q=w.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=V.get(t[1]);void 0!==e&&(V.delete(t[1]),t[1]=e)}return q.call(w.port1,t[0],t[1],t[2])});let F=null;Object.defineProperty(w.port1,"onmessage",{get:()=>F,set:t=>{"function"==typeof F&&w.port1.removeEventListener("message",F),F="function"==typeof t?t:null,"function"==typeof F&&(w.port1.addEventListener("message",F),w.port1.start())}}),m.prototype.port=w.port1;let j=null;((t,e,n,s)=>{let i=Oe.get(t);void 0===i&&(i=new WeakMap,Oe.set(t,i));const r=Jn(n,s);return i.set(e,r),r})(p,R,m,g).then(t=>j=t);const L=On(g.numberOfInputs,g.channelCount),$=On(g.numberOfOutputs,_),B=void 0===m.parameterDescriptors?[]:m.parameterDescriptors.reduce((t,{name:e})=>({...t,[e]:new Float32Array(128)}),{});let W=!0;const U=()=>{g.numberOfOutputs>0&&S.disconnect(O);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const n=M[t];for(let s=0;s<_[t];s+=1)O.disconnect(n,e+s,s);e+=_[t]}},z=new Map;S.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==j){const n=h(R);for(let s=0;s<A;s+=128){for(let e=0;e<g.numberOfInputs;e+=1)for(let n=0;n<g.channelCount;n+=1)An(t,L[e],n,n,s);void 0!==m.parameterDescriptors&&m.parameterDescriptors.forEach(({name:e},n)=>{An(t,B,e,v+n,s)});for(let t=0;t<g.numberOfInputs;t+=1)for(let e=0;e<_[t];e+=1)0===$[t][e].byteLength&&($[t][e]=new Float32Array(128));try{const t=L.map((t,e)=>{if(n[e].size>0)return z.set(e,A/128),t;const s=z.get(e);return void 0===s?[]:(t.every(t=>t.every(t=>0===t))&&(1===s?z.delete(e):z.set(e,s-1)),t)}),i=l(p.currentTime+s/p.sampleRate,p.sampleRate,()=>j.process(t,$,B));W=i;for(let t=0,n=0;t<g.numberOfOutputs;t+=1){for(let i=0;i<_[t];i+=1)Sn(e,$[t],i,n+i,s);n+=_[t]}}catch(t){W=!1,R.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}))}if(!W){for(let t=0;t<g.numberOfInputs;t+=1){x[t].disconnect(T[t]);for(let e=0;e<g.channelCount;e+=1)T[s].disconnect(k,e,t*g.channelCount+e)}if(void 0!==m.parameterDescriptors){const t=m.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=C[e];t.disconnect(k,0,v+e),t.stop()}}k.disconnect(S),S.onaudioprocess=null,G?U():Z();break}}}};let G=!1;const Y=o(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),X=()=>S.connect(Y).connect(p.destination),Z=()=>{S.disconnect(Y),Y.disconnect()};return X(),d(R,()=>{if(W){Z(),g.numberOfOutputs>0&&S.connect(O);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const n=M[t];for(let s=0;s<_[t];s+=1)O.connect(n,e+s,s);e+=_[t]}}G=!0},()=>{W&&(X(),U()),G=!1})})(lr,ze,jn,mi,ts,yi,ss,os,as,dr,Hi,fr,fi),gr=((t,e,n,s,i)=>(r,o,a,c,u,l)=>{if(null!==a)try{const e=new a(r,c,l),s=new Map;let o=null;if(Object.defineProperties(e,{channelCount:{get:()=>l.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>o,set:t=>{"function"==typeof o&&e.removeEventListener("processorerror",o),o="function"==typeof t?t:null,"function"==typeof o&&e.addEventListener("processorerror",o)}}}),e.addEventListener=(d=e.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=s.get(t[1]);void 0!==n?t[1]=n:(t[1]=n=>{"error"===n.type?(Object.defineProperties(n,{type:{value:"processorerror"}}),e(n)):e(new ErrorEvent(t[0],{...n}))},s.set(e,t[1]))}}return d.call(e,"error",t[1],t[2]),d.call(e,...t)}),e.removeEventListener=(h=e.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=s.get(t[1]);void 0!==e&&(s.delete(t[1]),t[1]=e)}return h.call(e,"error",t[1],t[2]),h.call(e,t[0],t[1],t[2])}),0!==l.numberOfOutputs){const t=n(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(t).connect(r.destination);return i(e,()=>t.disconnect(),()=>t.connect(r.destination))}return e}catch(t){if(11===t.code)throw s();throw t}var h,d;if(void 0===u)throw s();return(t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}})(l),e(r,o,u,l)})(jn,mr,ss,as,fi),_r=((t,e,n,s,i,r,o,a,c,u,l,h,d,p,f,m)=>(g,_,v)=>{const y=new WeakMap;let b=null;return{render(w,x,T){a(x,w);const C=y.get(x);return void 0!==C?Promise.resolve(C):(async(a,w,x)=>{let T=l(a),C=null;const k=We(T,w),A=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(null===h){const t=A.reduce((t,e)=>t+e,0),n=i(w,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),r=[];for(let t=0;t<a.numberOfOutputs;t+=1)r.push(s(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:A[t]}));const u=o(w,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});u.connect=e.bind(null,r),u.disconnect=c.bind(null,r),C=[n,r,u]}else k||(T=new h(w,g));if(y.set(w,null===C?T:C[2]),null!==C){if(null===b){if(void 0===v)throw new Error("Missing the processor constructor.");if(null===d)throw new Error("Missing the native OfflineAudioContext constructor.");const t=a.channelCount*a.numberOfInputs,e=void 0===v.parameterDescriptors?0:v.parameterDescriptors.length,n=t+e,c=async()=>{const c=new d(n,128*Math.ceil(a.context.length/128),w.sampleRate),u=[],l=[];for(let t=0;t<_.numberOfInputs;t+=1)u.push(o(c,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),l.push(i(c,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const h=await Promise.all(Array.from(a.parameters.values()).map(async t=>{const e=r(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await p(c,t,e.offset,x),e})),g=s(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<_.numberOfInputs;t+=1){u[t].connect(l[t]);for(let e=0;e<_.channelCount;e+=1)l[t].connect(g,e,t*_.channelCount+e)}for(const[e,n]of h.entries())n.connect(g,0,t+e),n.start(0);return g.connect(c.destination),await Promise.all(u.map(t=>f(a,c,t,x))),m(c)};b=Mn(a,0===n?null:await c(),w,_,A,v,u)}const t=await b,e=n(w,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[c,l,h]=C;null!==t&&(e.buffer=t,e.start(0)),e.connect(c);for(let t=0,e=0;t<a.numberOfOutputs;t+=1){const n=l[t];for(let s=0;s<A[t];s+=1)c.connect(n,e+s,s);e+=A[t]}return h}if(k)for(const[e,n]of a.parameters.entries())await t(w,n,T.parameters.get(e),x);else for(const[t,e]of a.parameters.entries())await p(w,e,T.parameters.get(t),x);return await f(a,w,T,x),T})(w,x,T)}}})(si,lr,ii,mi,ts,yi,ss,hr,dr,Hi,fn,Ki,qs,ri,Ns,Oi),vr=(t=>e=>t.get(e))(Qi),yr=(t=>(e,n)=>{t.set(e,n)})(pr),br=Zi?((t,e,n,s,i,r,o,a,c,u,l,h,d)=>class extends e{constructor(e,d,p){var f;const m=a(e),g=c(m),_=l({...kn,...p}),v=Se.get(m),y=null==v?void 0:v.get(d),b=g||"closed"!==m.state?m:null!==(f=o(m))&&void 0!==f?f:m,w=i(b,g?null:e.baseLatency,u,d,y,_);super(e,!0,w,g?s(d,_,y):null);const x=[];w.parameters.forEach((t,e)=>{const s=n(this,g,t);x.push([e,s])}),this._nativeAudioWorkletNode=w,this._onprocessorerror=null,this._parameters=new Cn(x),g&&t(m,this);const{activeInputs:T}=r(this);h(w,T)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?d(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(ur,zs,ai,_r,gr,Je,vr,Vs,Fs,Ki,t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},()=>1)}),yr,ws):void 0,wr=((t,e)=>(n,s,i)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,s,i)}catch(e){if("SyntaxError"===e.name)throw t();throw e}})(as,qs),xr=((t,e,n,s,i,r,o,a)=>{const c=[];return(u,l)=>n(u).render(u,l,c).then(()=>Promise.all(Array.from(s(l)).map(t=>n(t).render(t,l,c)))).then(()=>i(l)).then(n=>("function"!=typeof n.copyFromChannel?(o(n),Ge(n)):e(r,()=>r(n))||a(n),t.add(n),n))})(Xs,Ss,Is,cr,Oi,Ue,Js,Ks),Tr=((t,e,n,s,i)=>class extends t{constructor(t,n,i){let r;if("number"==typeof t&&void 0!==n&&void 0!==i)r={length:n,numberOfChannels:t,sampleRate:i};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");r=t}const{length:o,numberOfChannels:a,sampleRate:c}={...cs,...r},u=s(a,o,c);e(Un,()=>Un(u))||u.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(u.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(u,a),this._length=o,this._nativeOfflineAudioContext=u,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,en(this)}))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout(()=>this._waitForThePromiseToSettle(t))}})(nr,Ss,jn,wr,xr),Cr=((t,e)=>n=>{const s=t.get(n);return e(s)||e(n)})(Ce,Bs),kr=((t,e)=>n=>t.has(n)||e(n))(we,Ws),Ar=((t,e)=>n=>t.has(n)||e(n))(Te,Us),Sr=((t,e)=>n=>{const s=t.get(n);return e(s)||e(n)})(Ce,Fs);function Or(t,e){if(!t)throw new Error(e)}function Mr(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function Er(t){t.isOffline||"running"===t.state||Ir('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Dr=console;function Ir(...t){Dr.warn(...t)}function Nr(t){return void 0===t}function Rr(t){return!Nr(t)}function Vr(t){return"number"==typeof t}function Pr(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function qr(t){return Array.isArray(t)}function Fr(t){return"string"==typeof t}function jr(t){return Fr(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}const Lr="object"==typeof self?self:null,$r=Lr&&(Lr.hasOwnProperty("AudioContext")||Lr.hasOwnProperty("webkitAudioContext"));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function Br(t,e,n,s){var i,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(r<3?i(o):r>3?i(e,n,o):i(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}function Wr(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{c(s.next(t))}catch(t){r(t)}}function a(t){try{c(s.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((s=s.apply(t,e||[])).next())}))}class Ur{constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function zr(t){return Ar(t)}function Gr(t){return kr(t)}function Yr(t){return Sr(t)}function Xr(t){return Cr(t)}function Zr(t){return t instanceof AudioBuffer}function Hr(t,e){return"value"===t||zr(e)||Gr(e)||Zr(e)}function Qr(t,...e){if(!e.length)return t;const n=e.shift();if(Pr(t)&&Pr(n))for(const e in n)Hr(e,n[e])?t[e]=n[e]:Pr(n[e])?(t[e]||Object.assign(t,{[e]:{}}),Qr(t[e],n[e])):Object.assign(t,{[e]:n[e]});return Qr(t,...e)}function Jr(t,e,n=[],s){const i={},r=Array.from(e);if(Pr(r[0])&&s&&!Reflect.has(r[0],s)){Object.keys(r[0]).some(e=>Reflect.has(t,e))||(Qr(i,{[s]:r[0]}),n.splice(n.indexOf(s),1),r.shift())}if(1===r.length&&Pr(r[0]))Qr(i,r[0]);else for(let t=0;t<n.length;t++)Rr(r[t])&&(i[n[t]]=r[t]);return Qr(t,i)}function Kr(t,e){return Nr(t)?e:t}function to(t,e){return e.forEach(e=>{Reflect.has(t,e)&&delete t[e]}),t}
/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class eo{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||Lr&&this.toString()===Lr.TONE_DEBUG_CLASS)&&function(...t){Dr.log(...t)}(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}eo.version="14.7.77";function no(t,e){return t>e+1e-6}function so(t,e){return no(t,e)||ro(t,e)}function io(t,e){return t+1e-6<e}function ro(t,e){return Math.abs(t-e)<1e-6}class oo extends eo{constructor(){super(),this.name="Timeline",this._timeline=[];const t=Jr(oo.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(Or(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];Or(so(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const n=this._search(t,e);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const n=this._search(t,e);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const n=this._search(t);return n-1>=0?this._timeline[n-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(ro(this._timeline[e].time,t)){for(let n=e;n>=0&&ro(this._timeline[n].time,t);n--)e=n;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&so(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let n=0;const s=this._timeline.length;let i=s;if(s>0&&this._timeline[s-1][e]<=t)return s-1;for(;n<i;){let s=Math.floor(n+(i-n)/2);const r=this._timeline[s],o=this._timeline[s+1];if(ro(r[e],t)){for(let n=s;n<this._timeline.length;n++){if(!ro(this._timeline[n][e],t))break;s=n}return s}if(io(r[e],t)&&no(o[e],t))return s;no(r[e],t)?i=s:n=s+1}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const n=this._search(t);return-1!==n&&this._iterate(e,0,n),this}forEachAfter(t,e){const n=this._search(t);return this._iterate(e,n+1),this}forEachBetween(t,e,n){let s=this._search(t),i=this._search(e);return-1!==s&&-1!==i?(this._timeline[s].time!==t&&(s+=1),this._timeline[i].time===e&&(i-=1),this._iterate(n,s,i)):-1===s&&this._iterate(n,0,i),this}forEachFrom(t,e){let n=this._search(t);for(;n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this}forEachAtTime(t,e){const n=this._search(t);if(-1!==n&&ro(this._timeline[n].time,t)){let s=n;for(let e=n;e>=0&&ro(this._timeline[e].time,t);e--)s=e;this._iterate(t=>{e(t)},s,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const ao=[];function co(t){ao.push(t)}const uo=[];function lo(t){uo.push(t)}class ho extends eo{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach(t=>{Nr(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)}),this}once(t,e){const n=(...s)=>{e(...s),this.off(t,n)};return this.on(t,n),this}off(t,e){return t.split(/\W+/).forEach(n=>{if(Nr(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Nr(e))this._events[t]=[];else{const n=this._events[t];for(let t=n.length-1;t>=0;t--)n[t]===e&&n.splice(t,1)}}),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const n=this._events[t].slice(0);for(let t=0,s=n.length;t<s;t++)n[t].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach(e=>{const n=Object.getOwnPropertyDescriptor(ho.prototype,e);Object.defineProperty(t.prototype,e,n)})}dispose(){return super.dispose(),this._events=void 0,this}}class po extends ho{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class fo extends po{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new oo,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=Jr(fo.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=function(t){return new ar(t)}({latencyHint:t.latencyHint}),this._ticker=new Ur(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,ao.forEach(e=>e(t)),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){Or(Xr(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(t)}createMediaElementSource(t){Or(Xr(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(t)}createMediaStreamDestination(){Or(Xr(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){Or(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){Or(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){Or(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){Or(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return function(t,e,n){return Or(Rr(br),"This node only works in a secure context (https or localhost)"),new br(t,e,n)}(this.rawContext,t,e)}addAudioWorkletModule(t,e){return Wr(this,void 0,void 0,(function*(){Or(Rr(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)}))}workletsAreReady(){return Wr(this,void 0,void 0,(function*(){const t=[];this._workletModules.forEach(e=>t.push(e)),yield Promise.all(t)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,Fr(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return Xr(this._context)?this._context.resume():Promise.resolve()}close(){return Wr(this,void 0,void 0,(function*(){var t;Xr(this._context)&&(yield this._context.close()),this._initialized&&(t=this,uo.forEach(e=>e(t)))}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let e=0;e<n.length;e++)n[e]=t;const s=this._context.createBufferSource();return s.channelCount=1,s.channelCountMode="explicit",s.buffer=e,s.loop=!0,s.start(0),this._constants.set(t,s),s}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach(e=>{e.id===t&&this._timeouts.remove(e)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const n=++this._timeoutIds,s=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),s()},id:n,time:i+e})};return s(),n}}function mo(t,e){qr(e)?e.forEach(e=>mo(t,e)):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}const go=()=>{};class _o extends eo{constructor(){super(),this.name="ToneAudioBuffer",this.onload=go;const t=Jr(_o.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&Zr(t.url)||t.url instanceof _o?this.set(t.url):Fr(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:go,onload:go,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:wo().sampleRate}set(t){return t instanceof _o?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return Wr(this,void 0,void 0,(function*(){const e=_o.load(t).then(t=>{this.set(t),this.onload(this)});_o.downloads.push(e);try{yield e}finally{const t=_o.downloads.indexOf(e);_o.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=qr(t)&&t[0].length>0,n=e?t.length:1,s=e?t[0].length:t.length,i=wo(),r=i.createBuffer(n,s,i.sampleRate),o=e||1!==n?t:[t];for(let t=0;t<n;t++)r.copyToChannel(o[t],t);return this._buffer=r,this}toMono(t){if(Vr(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let n=0;n<e;n++){const e=this.toArray(n);for(let n=0;n<e.length;n++)t[n]+=e[n]}t=t.map(t=>t/e),this.fromArray(t)}return this}toArray(t){if(Vr(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){const n=Math.floor(t*this.sampleRate),s=Math.floor(e*this.sampleRate);Or(n<s,"The start time must be less than the end time");const i=s-n,r=wo().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let t=0;t<this.numberOfChannels;t++)r.copyToChannel(this.getChannelData(t).subarray(n,s),t);return new _o(r)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new _o).fromArray(t)}static fromUrl(t){return Wr(this,void 0,void 0,(function*(){const e=new _o;return yield e.load(t)}))}static load(t){return Wr(this,void 0,void 0,(function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const n=e[1].split("|");let s=n[0];for(const t of n)if(_o.supportsType(t)){s=t;break}t=t.replace(e[0],s)}const n=""===_o.baseUrl||_o.baseUrl.endsWith("/")?_o.baseUrl:_o.baseUrl+"/",s=yield fetch(n+t);if(!s.ok)throw new Error("could not load url: "+t);const i=yield s.arrayBuffer();return yield wo().decodeAudioData(i)}))}static supportsType(t){const e=t.split("."),n=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return Wr(this,void 0,void 0,(function*(){for(yield Promise.resolve();_o.downloads.length;)yield _o.downloads[0]}))}}_o.baseUrl="",_o.downloads=[];class vo extends fo{constructor(){var t,e,n;super({clockSource:"offline",context:Yr(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],n=arguments[2],new Tr(t,e,n)),lookAhead:0,updateInterval:Yr(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Yr(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return Wr(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const n=Math.floor(this.sampleRate/128);t&&e%n==0&&(yield new Promise(t=>setTimeout(t,1)))}}))}render(t=!0){return Wr(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new _o(e)}))}close(){return Promise.resolve()}}const yo=new class extends po{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return Wr(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}};let bo=yo;function wo(){var t;return bo===yo&&$r&&(t=new fo,bo=Xr(t)?new fo(t):Yr(t)?new vo(t):t),bo}function xo(){return bo.resume()}if(Lr&&!Lr.TONE_SILENCE_LOGGING){const t=` * Tone.js ${"v"}14.7.77 * `;console.log("%c"+t,"background: #000; color: #fff")}function To(t){return Math.pow(2,t/12)}let Co=440;function ko(t){return Math.round(Ao(t))}function Ao(t){return 69+12*Math.log2(t/Co)}function So(t){return Co*Math.pow(2,(t-69)/12)}class Oo extends eo{constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const n=parseInt(t,10),s="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*s:this._beatsToUnits(4/n)*s},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let s=0;return t&&"0"!==t&&(s+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s+=this._beatsToUnits(parseFloat(n)/4)),s},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Oo&&this.fromType(this._val),Nr(this._val))return this._noArg();if(Fr(this._val)&&Nr(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Pr(this._val)){let t=0;for(const e in this._val)if(Rr(this._val[e])){const n=this._val[e];t+=new this.constructor(this.context,e).valueOf()*n}return t}if(Rr(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return Fr(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Mo extends Oo{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new Mo(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const n=new this.constructor(this.context,t).valueOf(),s=this.valueOf();return s+(Math.round(s/n)*n-s)*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let t=1;t<9;t++){const n=Math.pow(2,t);e.push(n+"n."),e.push(n+"n"),e.push(n+"t")}e.push("0");let n=e[0],s=new Mo(this.context,e[0]).toSeconds();return e.forEach(e=>{const i=new Mo(this.context,e).toSeconds();Math.abs(i-t)<Math.abs(s-t)&&(n=e,s=i)}),n}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const n=Math.floor(e/this._getTimeSignature());let s=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=s.toString();i.length>3&&(s=parseFloat(parseFloat(i).toFixed(3)));return[n,e,s].join(":")}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return ko(this.toFrequency())}_now(){return this.context.now()}}class Eo extends Mo{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Co}static set A4(t){!function(t){Co=t}(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:Eo.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){const n=Do[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?n:Eo.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let s=1;return t&&"0"!==t&&(s*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s*=this._beatsToUnits(parseFloat(n)/4)),s}}})}transpose(t){return new Eo(this.context,this.valueOf()*To(t))}harmonize(t){return t.map(t=>this.transpose(t))}toMidi(){return ko(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/Eo.A4);let n=Math.round(12*e)+57;const s=Math.floor(n/12);s<0&&(n+=-12*s);return Io[n%12]+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return So(t)}static ftom(t){return ko(t)}}const Do={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},Io=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class No extends Mo{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Ro extends eo{constructor(){super();const t=Jr(Ro.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:wo()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new Mo(this.context,t).toSeconds()}toFrequency(t){return new Eo(this.context,t).toFrequency()}toTicks(t){return new No(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach(n=>{Nr(t[n])&&delete e[n]}),e}get(){const t=function(t){return t.constructor.getDefaults()}(this);return Object.keys(t).forEach(e=>{if(Reflect.has(this,e)){const n=this[e];Rr(n)&&Rr(n.value)&&Rr(n.setValueAtTime)?t[e]=n.value:n instanceof Ro?t[e]=n._getPartialProperties(t[e]):qr(n)||Vr(n)||Fr(n)||"boolean"==typeof n?t[e]=n:delete t[e]}}),t}set(t){return Object.keys(t).forEach(e=>{Reflect.has(this,e)&&Rr(this[e])&&(this[e]&&Rr(this[e].value)&&Rr(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof Ro?this[e].set(t[e]):this[e]=t[e])}),this}}class Vo extends oo{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,n){return Mr(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(t,e){for(let n=this._search(e);n>=0;n--){const e=this._timeline[n];if(e.state===t)return e}}getNextState(t,e){const n=this._search(e);if(-1!==n)for(let e=n;e<this._timeline.length;e++){const n=this._timeline[e];if(n.state===t)return n}}}class Po extends Ro{constructor(){super(Jr(Po.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=Jr(Po.getDefaults(),arguments,["param","units","convert"]);for(Or(Rr(t.param)&&(zr(t.param)||t.param instanceof Po),"param must be an AudioParam");!zr(t.param);)t.param=t.param._param;this._swappable=!!Rr(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new oo(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,Rr(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Ro.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return Rr(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return Rr(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return Rr(this.maxValue)&&Rr(this.minValue)&&Mr(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?(e=t,Math.pow(10,e/20)):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t;var e}_toType(t){return this.convert&&"decibels"===this.units?(e=t,Math.log(e)/Math.LN10*20):t;var e}setValueAtTime(t,e){const n=this.toSeconds(e),s=this._fromType(t);return Or(isFinite(s)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),n=this._events.getAfter(e),s=this._events.get(e);let i=this._initialValue;if(null===s)i=this._initialValue;else if("setTargetAtTime"!==s.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)i=s.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let t=s.value;if("setTargetAtTime"===s.type){const e=this._events.getBefore(s.time);t=null===e?this._initialValue:e.value}i="linearRampToValueAtTime"===n.type?this._linearInterpolate(s.time,t,n.time,n.value,e):this._exponentialInterpolate(s.time,t,n.time,n.value,e)}else i=s.value;else{const t=this._events.getBefore(s.time);let n;n=null===t?this._initialValue:t.value,"setTargetAtTime"===s.type&&(i=this._exponentialApproach(s.time,n,s.value,s.constant,e))}return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const n=this._fromType(t),s=this.toSeconds(e);return Or(isFinite(n)&&isFinite(s),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this._events.add({time:s,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,s),this._param.linearRampToValueAtTime(n,s),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=ro(n,0)?this._minOutput:n,this._assertRange(n);const s=this.toSeconds(e);return Or(isFinite(n)&&isFinite(s),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:s,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,s),this._param.exponentialRampToValueAtTime(n,s),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e),n=this.toSeconds(n);const s=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(t,e,s),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){const s=this._fromType(t);Or(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(s),Or(isFinite(s)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:s}),this.log(this.units,"setTargetAtTime",t,i,n),this._param.setTargetAtTime(s,i,n),this}setValueCurveAtTime(t,e,n,s=1){n=this.toSeconds(n),e=this.toSeconds(e);const i=this._fromType(t[0])*s;this.setValueAtTime(this._toType(i),e);const r=n/(t.length-1);for(let n=1;n<t.length;n++){const i=this._fromType(t[n])*s;this.linearRampToValueAtTime(this._toType(i),e+n*r)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return Or(isFinite(e),"Invalid argument to cancelScheduledValues: "+JSON.stringify(t)),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e));Or(isFinite(e),"Invalid argument to cancelAndHoldAtTime: "+JSON.stringify(t)),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n);const s=this._events.get(e),i=this._events.getAfter(e);return s&&ro(s.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const n=this._events.get(e);if(n&&"setTargetAtTime"===n.type){const s=this._events.getAfter(n.time),i=s?s.time:e+2,r=(i-e)/10;for(let n=e;n<i;n+=r)t.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)}),this}setParam(t){Or(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,s,i){return n+(e-n)*Math.exp(-(i-t)/s)}_linearInterpolate(t,e,n,s,i){return e+(i-t)/(n-t)*(s-e)}_exponentialInterpolate(t,e,n,s,i){return e*Math.pow(s/e,(i-t)/(n-t))}}class qo extends Ro{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return Rr(this.input)?zr(this.input)||this.input instanceof Po?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Rr(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return Rr(t)&&(t instanceof qo||Gr(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach(e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation})}_getChannelProperties(){const t=this._getInternalNodes();Or(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return jo(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Ir("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return function(t,e,n=0,s=0){if(Rr(e))for(;e instanceof qo;)e=e.input;for(;!Gr(t);)Rr(t.output)&&(t=t.output);zr(e)?t.disconnect(e,n):Gr(e)?t.disconnect(e,n,s):t.disconnect()}(this,t,e,n),this}chain(...t){return Fo(this,...t),this}fan(...t){return t.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),Rr(this.input)&&(this.input instanceof qo?this.input.dispose():Gr(this.input)&&this.input.disconnect()),Rr(this.output)&&(this.output instanceof qo?this.output.dispose():Gr(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Fo(...t){const e=t.shift();t.reduce((t,e)=>(t instanceof qo?t.connect(e):Gr(t)&&jo(t,e),e),e)}function jo(t,e,n=0,s=0){for(Or(Rr(t),"Cannot connect from undefined node"),Or(Rr(e),"Cannot connect to undefined node"),(e instanceof qo||Gr(e))&&Or(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Or(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof qo||e instanceof Po;)Rr(e.input)&&(e=e.input);for(;t instanceof qo;)Rr(t.output)&&(t=t.output);zr(e)?t.connect(e,n):t.connect(e,n,s)}class Lo extends qo{constructor(){super(Jr(Lo.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=Jr(Lo.getDefaults(),arguments,["gain","units"]);this.gain=new Po({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),mo(this,"gain")}static getDefaults(){return Object.assign(qo.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class $o extends qo{constructor(t){super(t),this.onended=go,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Lo({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(qo.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:go})}_startGain(t,e=1){Or(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){Or(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==go&&(this.onended(this),this.onended=go,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Or(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class Bo extends $o{constructor(){super(Jr(Bo.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=Jr(Bo.getDefaults(),arguments,["offset"]);jo(this._source,this._gainNode),this.offset=new Po({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign($o.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Wo extends qo{constructor(){super(Jr(Wo.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=Jr(Wo.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Bo({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(qo.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return Uo(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,s){return this._param.setValueCurveAtTime(t,e,n,s),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function Uo(t,e,n,s){(e instanceof Po||zr(e)||e instanceof Wo&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Wo&&(e.overridden=!0)),jo(t,e,n,s)}class zo extends Po{constructor(){super(Jr(zo.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new oo(1/0),this._multiplier=1;const t=Jr(zo.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Po.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,n){e=this.toSeconds(e),this.setRampPoint(e);const s=this._fromType(t),i=this._events.get(e),r=Math.round(Math.max(1/n,1));for(let t=0;t<=r;t++){const r=n*t+e,o=this._exponentialApproach(i.time,i.value,s,n,r);this.linearRampToValueAtTime(this._toType(o),r)}return this}setValueAtTime(t,e){const n=this.toSeconds(e);super.setValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}linearRampToValueAtTime(t,e){const n=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const n=this._fromType(t),s=this._events.get(e),i=Math.round(Math.max(10*(e-s.time),1)),r=(e-s.time)/i;for(let t=0;t<=i;t++){const i=r*t+s.time,o=this._exponentialInterpolate(s.time,s.value,e,n,i);this.linearRampToValueAtTime(this._toType(o),i)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Nr(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const n=this._fromType(this.getValueAtTime(t.time));let s=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&"setValueAtTime"===i.type&&(s=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(n+s)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),n=this._events.get(e);return Math.max(this._getTicksUntilEvent(n,e),0)}getDurationOfTicks(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(e);return this.getTimeOfTick(s+t)-n}getTimeOfTick(t){const e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){const s=this._fromType(this.getValueAtTime(e.time)),i=(this._fromType(this.getValueAtTime(n.time))-s)/(n.time-e.time),r=Math.sqrt(Math.pow(s,2)-2*i*(e.ticks-t)),o=(-s+r)/i,a=(-s-r)/i;return(o>0?o:a)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const n=this.toSeconds(e),s=this.toSeconds(t),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+s)-i}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class Go extends Wo{constructor(){super(Jr(Go.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=Jr(Go.getDefaults(),arguments,["value"]);this.input=this._param=new zo({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(Wo.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class Yo extends Ro{constructor(){super(Jr(Yo.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new Vo,this._tickOffset=new oo;const t=Jr(Yo.getDefaults(),arguments,["frequency"]);this.frequency=new Go({context:this.context,units:t.units,value:t.frequency}),mo(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Ro.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const n=this.toSeconds(t);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),Rr(e)&&this.setTicksAtTime(e,n)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),n=this._state.getLastState("stopped",e),s={state:"paused",time:e};this._state.add(s);let i=n,r=0;return this._state.forEachBetween(n.time,e+this.sampleTime,t=>{let e=i.time;const n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(r=n.ticks,e=n.time),"started"===i.state&&"started"!==t.state&&(r+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),i=t}),this._state.remove(s),r}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let s=e,i=0;return this._state.forEachBetween(e.time,t+this.sampleTime,t=>{let e=s.time;const n=this._tickOffset.get(t.time);n&&n.time>=s.time&&(i=n.seconds,e=n.time),"started"===s.state&&"started"!==t.state&&(i+=t.time-e),s=t}),this._state.remove(n),i}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const n=this._tickOffset.get(e),s=this._state.get(e),i=Math.max(n.time,s.time),r=this.frequency.getTicksAtTime(i)+t-n.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(t,e,n){let s=this._state.get(t);this._state.forEachBetween(t,e,e=>{s&&"started"===s.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(s.time,t),e.time-this.sampleTime,n),s=e});let i=null;if(s&&"started"===s.state){const r=Math.max(s.time,t),o=this.frequency.getTicksAtTime(r),a=o-this.frequency.getTicksAtTime(s.time);let c=Math.ceil(a)-a;c=ro(c,1)?0:c;let u=this.frequency.getTimeOfTick(o+c);for(;u<e;){try{n(u,Math.round(this.getTicksAtTime(u)))}catch(t){i=t;break}u+=this.frequency.getDurationOfTicks(1,u)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class Xo extends Ro{constructor(){super(Jr(Xo.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=go,this._lastUpdate=0,this._state=new Vo("stopped"),this._boundLoop=this._loop.bind(this);const t=Jr(Xo.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new Yo({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,mo(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Ro.getDefaults(),{callback:go,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){Er(this.context);const n=this.toSeconds(t);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,e),n<this._lastUpdate&&this.emit("start",n,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(s+t,n)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}}),this._tickSource.forEachTickBetween(t,e,(t,e)=>{this.callback(t,e)}))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}ho.mixin(Xo);class Zo extends eo{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=Jr(Zo.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach(e=>{this._loadingCount++;const n=t.urls[e];this.add(e,n,this._bufferLoaded.bind(this,t.onload),t.onerror)})}static getDefaults(){return{baseUrl:"",onerror:go,onload:go,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return Or(this.has(t),"ToneAudioBuffers has no buffer named: "+t),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every(([t,e])=>e.loaded)}add(t,e,n=go,s=go){return Fr(e)?this._buffers.set(t.toString(),new _o(this.baseUrl+e,n,s)):this._buffers.set(t.toString(),new _o(e,n,s)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}}class Ho extends Eo{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return ko(super._frequencyToUnits(t))}_ticksToUnits(t){return ko(super._ticksToUnits(t))}_beatsToUnits(t){return ko(super._beatsToUnits(t))}_secondsToUnits(t){return ko(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return So(this.toMidi())}transpose(t){return new Ho(this.context,this.toMidi()+t)}}class Qo extends No{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Jo extends Ro{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new oo,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}co(t=>{t.draw=new Jo({context:t})}),lo(t=>{t.draw.dispose()});class Ko extends eo{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){Or(Rr(t.time),"Events must have a time property"),Or(Rr(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new ta(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const n of e)if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,t=>this.remove(t)),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,n=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){const e=t.parent,n=t.isLeftChild(),s=t.right;s&&(t.right=s.left,s.left=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rotateRight(t){const e=t.parent,n=t.isLeftChild(),s=t.left;s&&(t.left=s.right,s.right=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let n=1;n<e.length;n++)e[n].low>t.low&&(t=e[n]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse(t=>e.push(t)),e.forEach(e=>{e.event&&t(e.event)})}return this}forEachAtTime(t,e){if(null!==this._root){const n=[];this._root.search(t,n),n.forEach(t=>{t.event&&e(t.event)})}return this}forEachFrom(t,e){if(null!==this._root){const n=[];this._root.searchAfter(t,n),n.forEach(t=>{t.event&&e(t.event)})}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse(t=>t.dispose()),this._root=null,this}}class ta{constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class ea extends qo{constructor(){super(Jr(ea.getDefaults(),arguments,["volume"])),this.name="Volume";const t=Jr(ea.getDefaults(),arguments,["volume"]);this.input=this.output=new Lo({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,mo(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(qo.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class na extends qo{constructor(){super(Jr(na.getDefaults(),arguments)),this.name="Destination",this.input=new ea({context:this.context}),this.output=new Lo({context:this.context}),this.volume=this.input.volume;const t=Jr(na.getDefaults(),arguments);Fo(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(qo.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),Fo(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}co(t=>{t.destination=new na({context:t})}),lo(t=>{t.destination.dispose()});class sa extends eo{constructor(t){super(),this.name="TimelineValue",this._timeline=new oo({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class ia{constructor(t,e){this.id=ia._eventId++;const n=Object.assign(ia.getDefaults(),e);this.transport=t,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:go,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}ia._eventId=0;class ra extends ia{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(ra.getDefaults(),e);this.duration=new Qo(t.context,n.duration).valueOf(),this._interval=new Qo(t.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},ia.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){const e=this.transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Qo(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const e=this.transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new Qo(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Qo(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class oa extends Ro{constructor(){super(Jr(oa.getDefaults(),arguments)),this.name="Transport",this._loop=new sa(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new oo,this._repeatedEvents=new Ko,this._syncedSignals=[],this._swingAmount=0;const t=Jr(oa.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new Xo({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),mo(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(Ro.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const n=e%(2*this._swingTicks)/(2*this._swingTicks),s=Math.sin(n*Math.PI)*this._swingAmount;t+=new Qo(this.context,2*this._swingTicks/3).toSeconds()*s}this._timeline.forEachAtTime(e,e=>e.invoke(t))}schedule(t,e){const n=new ia(this,{callback:t,time:new No(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(t,e,n,s=1/0){const i=new ra(this,{callback:t,duration:new Mo(this.context,s).toTicks(),interval:new Mo(this.context,e).toTicks(),time:new No(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const n=new ia(this,{callback:t,once:!0,time:new No(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,t=>this.clear(t.id)),this._repeatedEvents.forEachFrom(e,t=>this.clear(t.id)),this}_bindClockEvents(){this._clock.on("start",(t,e)=>{e=new Qo(this.context,e).toSeconds(),this.emit("start",t,e)}),this._clock.on("stop",t=>{this.emit("stop",t)}),this._clock.on("pause",t=>{this.emit("pause",t)})}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return Rr(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){qr(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Mo(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Mo(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new Qo(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new Qo(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),n=this._clock.frequency.timeToTicks(t,e);this.ticks=n}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(e),s=e+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,e);this.emit("stop",s),this._clock.setTicksAtTime(t,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),n=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(n,e)}}syncSignal(t,e){if(!e){const n=this.now();if(0!==t.getValueAtTime(n)){const s=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);e=t.getValueAtTime(n)/s}else e=0}const n=new Lo(e);return this.bpm.connect(n),n.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:n,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),function t(e,n){qr(n)?n.forEach(n=>t(e,n)):Object.defineProperty(e,n,{writable:!0})}(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}ho.mixin(oa),co(t=>{t.transport=new oa({context:t})}),lo(t=>{t.transport.dispose()});class aa extends qo{constructor(t){super(t),this.input=void 0,this._state=new Vo("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=go,this._syncedStop=go,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new ea({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,mo(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(qo.getDefaults(),{mute:!1,onstop:go,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){let s=Nr(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(s=this._clampToCurrentTime(s),this._synced||"started"!==this._state.getValueAtTime(s))if(this.log("start",s),this._state.setStateAtTime("started",s),this._synced){const t=this._state.get(s);t&&(t.offset=this.toSeconds(Kr(e,0)),t.duration=n?this.toSeconds(n):void 0);const i=this.context.transport.schedule(t=>{this._start(t,e,n)},s);this._scheduled.push(i),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>s&&this._syncedStart(this.now(),this.context.transport.seconds)}else Er(this.context),this._start(s,e,n);else Or(no(s,this._state.get(s).time),"Start time must be strictly greater than previous start time"),this._state.cancel(s),this._state.setStateAtTime("started",s),this.log("restart",s),this.restart(s,e,n);return this}stop(t){let e=Nr(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||Rr(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){const n=this._state.get(e);if(n&&"started"===n.state&&n.time!==e){const s=e-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-s),this._start(t,this.toSeconds(n.offset)+s,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=go,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class ca extends $o{constructor(){super(Jr(ca.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=Jr(ca.getDefaults(),arguments,["url","onload"]);jo(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Po({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new _o(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign($o.getDefaults(),{url:new _o,loop:!1,loopEnd:0,loopStart:0,onload:go,onerror:go,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n,s=1){Or(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,s),e=this.loop?Kr(e,this.loopStart):Kr(e,0);let r=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;so(r,t)&&(r=(r-e)%n+e),ro(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,io(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,r)),Rr(n)){let t=this.toSeconds(n);t=Math.max(t,0),this.stop(i+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function ua(t,e){return Wr(this,void 0,void 0,(function*(){const n=e/t.context.sampleRate,s=new vo(1,n,t.context.sampleRate);new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:s})).toDestination().start(0);return(yield s.render()).getChannelData(0)}))}class la extends $o{constructor(){super(Jr(la.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=Jr(la.getDefaults(),arguments,["frequency","type"]);jo(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new Po({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new Po({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),mo(this,["frequency","detune"])}static getDefaults(){return Object.assign($o.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class ha extends aa{constructor(){super(Jr(ha.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=Jr(ha.getDefaults(),arguments,["frequency","type"]);this.frequency=new Wo({context:this.context,units:"frequency",value:t.frequency}),mo(this,"frequency"),this.detune=new Wo({context:this.context,units:"cents",value:t.detune}),mo(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(aa.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),n=new la({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return ha._periodicWaveCache.find(t=>{return t.phase===this._phase&&(e=t.partials,n=this._partials,e.length===n.length&&e.every((t,e)=>n[e]===t));var e,n})}{const t=ha._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(Rr(e)){const{partials:t,wave:n}=e;this._wave=n,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,n]=this._getRealImaginary(t,this._phase),s=this.context.createPeriodicWave(e,n);this._wave=s,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),ha._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),ha._periodicWaveCache.length>100&&ha._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){Mr(t,0);let e=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach((t,n)=>e[n]=t),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let n=2048;const s=new Float32Array(n),i=new Float32Array(n);let r=1;if("custom"===t){if(r=this._partials.length+1,this._partialCount=this._partials.length,n=r,0===this._partials.length)return[s,i]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(r=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],r=Math.max(r,2),n=r):this._partialCount=0,this._partials=[]}for(let o=1;o<n;++o){const n=2/(o*Math.PI);let a;switch(t){case"sine":a=o<=r?1:0,this._partials[o-1]=a;break;case"square":a=1&o?2*n:0,this._partials[o-1]=a;break;case"sawtooth":a=n*(1&o?1:-1),this._partials[o-1]=a;break;case"triangle":a=1&o?n*n*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=a;break;case"custom":a=this._partials[o-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==a?(s[o]=-a*Math.sin(e*o),i[o]=a*Math.cos(e*o)):(s[o]=0,i[o]=0)}return[s,i]}_inverseFFT(t,e,n){let s=0;const i=t.length;for(let r=0;r<i;r++)s+=t[r]*Math.cos(r*n)+e[r]*Math.sin(r*n);return s}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let n=0;const s=2*Math.PI;for(let i=0;i<32;i++)n=Math.max(this._inverseFFT(t,e,i/32*s),n);return i=-this._inverseFFT(t,e,this._phase)/n,r=-1,o=1,Math.max(Math.min(i,o),r);var i,r,o}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return Wr(this,void 0,void 0,(function*(){return ua(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}ha._periodicWaveCache=[];class da extends qo{constructor(){super(Object.assign(Jr(da.getDefaults(),arguments,["context"])))}connect(t,e=0,n=0){return Uo(this,t,e,n),this}}class pa extends da{constructor(){super(Object.assign(Jr(pa.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=Jr(pa.getDefaults(),arguments,["mapping","length"]);qr(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):"function"==typeof t.mapping&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(Wo.getDefaults(),{length:1024})}setMap(t,e=1024){const n=new Float32Array(e);for(let s=0,i=e;s<i;s++){const e=s/(i-1)*2-1;n[s]=t(e,s)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){Or(["none","2x","4x"].some(e=>e.includes(t)),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class fa extends da{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new pa({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class ma extends Wo{constructor(){super(Object.assign(Jr(ma.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=Jr(ma.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Lo({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Wo.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class ga extends aa{constructor(){super(Jr(ga.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new fa({context:this.context}),this._modulationNode=new Lo({context:this.context});const t=Jr(ga.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ha({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ha({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new ma({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),mo(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ha.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Wr(this,void 0,void 0,(function*(){return ua(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class _a extends aa{constructor(){super(Jr(_a.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Lo({context:this.context,gain:0});const t=Jr(_a.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ha({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new Wo({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new ha({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new ma({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new ma({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),mo(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ha.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Wr(this,void 0,void 0,(function*(){return ua(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class va extends aa{constructor(){super(Jr(va.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Lo({context:this.context,gain:0}),this._thresh=new pa({context:this.context,mapping:t=>t<=0?-1:1});const t=Jr(va.getDefaults(),arguments,["frequency","width"]);this.width=new Wo({context:this.context,units:"audioRange",value:t.width}),this._triangle=new ha({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),mo(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(aa.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return Wr(this,void 0,void 0,(function*(){return ua(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class ya extends aa{constructor(){super(Jr(ya.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=Jr(ya.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Wo({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Wo({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,mo(this,["frequency","detune"])}static getDefaults(){return Object.assign(ha.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach(e=>e.start(t))}_stop(t){t=this.toSeconds(t),this._forEach(e=>e.stop(t))}_restart(t){this._forEach(e=>e.restart(t))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach(e=>e.type=t)}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,n=t/(this._oscillators.length-1);this._forEach((t,s)=>t.detune.value=e+n*s)}}get count(){return this._oscillators.length}set count(t){if(Mr(t,1),this._oscillators.length!==t){this._forEach(t=>t.dispose()),this._oscillators=[];for(let e=0;e<t;e++){const n=new ha({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):go});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[e]=n}this.spread=this._spread,"started"===this.state&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach((t,e)=>t.phase=this._phase+e/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach(e=>e.baseType=t),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach(e=>e.partials=t))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach(e=>e.partialCount=t),this._type=this._oscillators[0].type}asArray(t=1024){return Wr(this,void 0,void 0,(function*(){return ua(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}}class ba extends aa{constructor(){super(Jr(ba.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new ma({context:this.context,value:2});const t=Jr(ba.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new va({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ha({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),mo(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(aa.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return Wr(this,void 0,void 0,(function*(){return ua(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const wa={am:ga,fat:ya,fm:_a,oscillator:ha,pulse:va,pwm:ba};class xa extends aa{constructor(){super(Jr(xa.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=Jr(xa.getDefaults(),arguments,["frequency","type"]);this.frequency=new Wo({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Wo({context:this.context,units:"cents",value:t.detune}),mo(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(ha.getDefaults(),_a.getDefaults(),ga.getDefaults(),ya.getDefaults(),va.getDefaults(),ba.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=wa[t],n=this.now();if(this._oscillator){const t=this._oscillator;t.stop(n),this.context.setTimeout(()=>t.dispose(),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof wa[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&Vr(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&Vr(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Fr(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return Wr(this,void 0,void 0,(function*(){return ua(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function Ta(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Mr(s,t,e),n.set(this,s)}})}}function Ca(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Mr(this.toSeconds(s),t,e),n.set(this,s)}})}}class ka extends aa{constructor(){super(Jr(ka.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=Jr(ka.getDefaults(),arguments,["url","onload"]);this._buffer=new _o({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(aa.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:go,onerror:go,playbackRate:1,reverse:!1})}load(t){return Wr(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=go){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?Kr(e,this._loopStart):Kr(e,0);const s=this.toSeconds(e),i=n;n=Kr(n,Math.max(this._buffer.duration-s,0));let r=this.toSeconds(n);r/=this._playbackRate,t=this.toSeconds(t);const o=new ca({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+r),this._state.setStateAtTime("stopped",t+r,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&Nr(i)?o.start(t,s):o.start(t,s,r-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach(t=>t.stop(e))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}seek(t,e){const n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){const e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&Mr(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopStart=t})}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&Mr(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopEnd=t})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach(e=>{e.loop=t}),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(t=>t.cancelStop())),this._activeSources.forEach(n=>{n.playbackRate.setValueAtTime(t,e)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(t=>t.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Br([Ca(0)],ka.prototype,"fadeIn",void 0),Br([Ca(0)],ka.prototype,"fadeOut",void 0);class Aa extends qo{constructor(){super(Jr(Aa.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Wo({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=Jr(Aa.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(qo.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(Fr(t))return t;{let n;for(n in Sa)if(Sa[n][e]===t)return n;return t}}_setCurve(t,e,n){if(Fr(n)&&Reflect.has(Sa,n)){const s=Sa[n];Pr(s)?"_decayCurve"!==t&&(this[t]=s[e]):this[t]=s}else{if(!qr(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){Or(["linear","exponential"].some(e=>e===t),"Invalid envelope curve: "+t),this._decayCurve=t}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let n=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),i=this.getValueAtTime(t);if(i>0){n=(1-i)/(1/n)}if(n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,n,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,n,t);else{this._sig.cancelAndHoldAtTime(t);let s=this._attackCurve;for(let t=1;t<s.length;t++)if(s[t-1]<=i&&i<=s[t]){s=this._attackCurve.slice(t),s[0]=i;break}this._sig.setValueCurveAtTime(s,t,n,e)}if(s&&this.sustain<1){const i=e*this.sustain,r=t+n;this.log("decay",r),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(i,s+r):this._sig.exponentialApproachValueAtTime(i,r,s)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,t):(Or(qr(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,n,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return Uo(this,t,e,n),this}asArray(t=1024){return Wr(this,void 0,void 0,(function*(){const e=t/this.context.sampleRate,n=new vo(1,e,this.context.sampleRate),s=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=s+this.toSeconds(this.release),r=.1*i,o=i+r,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:n}));a._sig.toDestination(),a.triggerAttackRelease(e*(s+r)/o,0);return(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}Br([Ca(0)],Aa.prototype,"attack",void 0),Br([Ca(0)],Aa.prototype,"decay",void 0),Br([Ta(0,1)],Aa.prototype,"sustain",void 0),Br([Ca(0)],Aa.prototype,"release",void 0);const Sa=(()=>{let t,e;const n=[];for(t=0;t<128;t++)n[t]=Math.sin(t/127*(Math.PI/2));const s=[];for(t=0;t<127;t++){e=t/127;const n=Math.sin(e*(2*Math.PI)*6.4-Math.PI/2)+1;s[t]=n/10+.83*e}s[127]=1;const i=[];for(t=0;t<128;t++)i[t]=Math.ceil(t/127*5)/5;const r=[];for(t=0;t<128;t++)e=t/127,r[t]=.5*(1-Math.cos(Math.PI*e));const o=[];for(t=0;t<128;t++){e=t/127;const n=4*Math.pow(e,3)+.2,s=Math.cos(n*Math.PI*2*e);o[t]=Math.abs(s*(1-e))}function a(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}return{bounce:{In:a(o),Out:o},cosine:{In:n,Out:(c=n,c.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:s,Out:a(s)},sine:{In:r,Out:a(r)},step:{In:i,Out:a(i)}};var c})();class Oa extends qo{constructor(){super(Jr(Oa.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=Jr(Oa.getDefaults(),arguments);this._volume=this.output=new ea({context:this.context,volume:t.volume}),this.volume=this._volume.volume,mo(this,"volume")}static getDefaults(){return Object.assign(qo.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const n=this["_original_"+t]=this[t];this[t]=(...t)=>{const s=t[e],i=this.context.transport.schedule(s=>{t[e]=s,n.apply(this,t)},s);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,n,s){const i=this.toSeconds(n),r=this.toSeconds(e);return this.triggerAttack(t,i,s),this.triggerRelease(i+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Ma extends Oa{constructor(){super(Jr(Ma.getDefaults(),arguments));const t=Jr(Ma.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(Oa.getDefaults(),{detune:0,onsilence:go,portamento:0})}triggerAttack(t,e,n=1){this.log("triggerAttack",t,e,n);const s=this.toSeconds(e);return this._triggerEnvelopeAttack(s,n),this.setNote(t,s),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const n=this.toSeconds(e),s=t instanceof Eo?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(s,t,n)}else this.frequency.setValueAtTime(s,n);return this}}Br([Ca(0)],Ma.prototype,"portamento",void 0);class Ea extends Aa{constructor(){super(Jr(Ea.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Lo({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Da extends Ma{constructor(){super(Jr(Da.getDefaults(),arguments)),this.name="Synth";const t=Jr(Da.getDefaults(),arguments);this.oscillator=new xa(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Ea(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),mo(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Ma.getDefaults(),{envelope:Object.assign(to(Aa.getDefaults(),Object.keys(qo.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(to(xa.getDefaults(),[...Object.keys(aa.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Ia extends Da{constructor(){super(Jr(Ia.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=Jr(Ia.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,mo(this,["oscillator","envelope"])}static getDefaults(){return Qr(Ma.getDefaults(),Da.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const n=this.toSeconds(e),s=this.toFrequency(t instanceof Eo?t.toFrequency():t),i=s*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(s,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Br([Ta(0)],Ia.prototype,"octaves",void 0),Br([Ca(0)],Ia.prototype,"pitchDecay",void 0);const Na=new Set;function Ra(t){Na.add(t)}function Va(t,e){const n=`registerProcessor("${t}", ${e})`;Na.add(n)}Ra('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');Ra("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");Ra("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");Va("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class Pa extends Oa{constructor(){super(Jr(Pa.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;const t=Jr(Pa.getDefaults(),arguments,["voice","options"]);Or(!Vr(t.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const e=t.voice.getDefaults();this.options=Object.assign(e,t.options),this.voice=t.voice,this.maxPolyphony=t.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const n=this._voices.indexOf(this._dummyVoice);this._voices.splice(n,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Oa.getDefaults(),{maxPolyphony:32,options:{},voice:Da})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(t){this._availableVoices.push(t);const e=this._activeVoices.findIndex(e=>e.voice===t);this._activeVoices.splice(e,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return t.connect(this.output),this._voices.push(t),t}Ir("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const t=this._availableVoices.shift(),e=this._voices.indexOf(t);this._voices.splice(e,1),this.context.isOffline||t.dispose()}}_triggerAttack(t,e,n){t.forEach(t=>{const s=new Ho(this.context,t).toMidi(),i=this._getNextAvailableVoice();i&&(i.triggerAttack(t,e,n),this._activeVoices.push({midi:s,voice:i,released:!1}),this.log("triggerAttack",t,e))})}_triggerRelease(t,e){t.forEach(t=>{const n=new Ho(this.context,t).toMidi(),s=this._activeVoices.find(({midi:t,released:e})=>t===n&&!e);s&&(s.voice.triggerRelease(e),s.released=!0,this.log("triggerRelease",t,e))})}_scheduleEvent(t,e,n,s){Or(!this.disposed,"Synth was already disposed"),n<=this.now()?"attack"===t?this._triggerAttack(e,n,s):this._triggerRelease(e,n):this.context.setTimeout(()=>{this._scheduleEvent(t,e,n,s)},n-this.now())}triggerAttack(t,e,n){Array.isArray(t)||(t=[t]);const s=this.toSeconds(e);return this._scheduleEvent("attack",t,s,n),this}triggerRelease(t,e){Array.isArray(t)||(t=[t]);const n=this.toSeconds(e);return this._scheduleEvent("release",t,n),this}triggerAttackRelease(t,e,n,s){const i=this.toSeconds(n);if(this.triggerAttack(t,i,s),qr(e)){Or(qr(t),"If the duration is an array, the notes must also be an array"),t=t;for(let n=0;n<t.length;n++){const s=e[Math.min(n,e.length-1)],r=this.toSeconds(s);Or(r>0,"The duration must be greater than 0"),this.triggerRelease(t[n],i+r)}}else{const n=this.toSeconds(e);Or(n>0,"The duration must be greater than 0"),this.triggerRelease(t,i+n)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(t){const e=to(t,["onsilence","context"]);return this.options=Qr(this.options,e),this._voices.forEach(t=>t.set(e)),this._dummyVoice.set(e),this}get(){return this._dummyVoice.get()}releaseAll(t){const e=this.toSeconds(t);return this._activeVoices.forEach(({voice:t})=>{t.triggerRelease(e)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(t=>t.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class qa extends Oa{constructor(){super(Jr(qa.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=Jr(qa.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach(n=>{const s=parseInt(n,10);if(Or(jr(n)||Vr(s)&&isFinite(s),"url key is neither a note or midi pitch: "+n),jr(n)){const s=new Eo(this.context,n).toMidi();e[s]=t.urls[n]}else Vr(s)&&isFinite(s)&&(e[s]=t.urls[s])}),this._buffers=new Zo({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(Oa.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:go,onerror:go,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error("No available buffers for note: "+t)}triggerAttack(t,e,n=1){return this.log("triggerAttack",t,e,n),Array.isArray(t)||(t=[t]),t.forEach(t=>{const s=Ao(new Eo(this.context,t).toFrequency()),i=Math.round(s),r=s-i,o=this._findClosest(i),a=i-o,c=this._buffers.get(a),u=To(o+r),l=new ca({url:c,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:u}).connect(this.output);l.start(e,0,c.duration/u,n),qr(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(l),l.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){const t=this._activeSources.get(i),e=t.indexOf(l);-1!==e&&t.splice(e,1)}}}),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach(t=>{const n=new Eo(this.context,t).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const t=this._activeSources.get(n);e=this.toSeconds(e),t.forEach(t=>{t.stop(e)}),this._activeSources.set(n,[])}}),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach(t=>{for(;t.length;){t.shift().stop(e)}}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,n,s=1){const i=this.toSeconds(n);return this.triggerAttack(t,i,s),qr(e)?(Or(qr(t),"notes must be an array when duration is array"),t.forEach((t,n)=>{const s=e[Math.min(n,e.length-1)];this.triggerRelease(t,i+this.toSeconds(s))})):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,n){if(Or(jr(t)||isFinite(t),"note must be a pitch or midi: "+t),jr(t)){const s=new Eo(this.context,t).toMidi();this._buffers.add(s,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}Br([Ca(0)],qa.prototype,"attack",void 0),Br([Ca(0)],qa.prototype,"release",void 0);Va("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class Fa extends qo{constructor(){super(...arguments),this.name="Listener",this.positionX=new Po({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Po({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Po({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Po({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Po({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Po({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Po({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Po({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Po({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(qo.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}co(t=>{t.listener=new Fa({context:t})}),lo(t=>{t.listener.dispose()}),wo().transport,wo().destination,wo().destination,wo().listener,wo().draw,wo();class ja{constructor(t){this.underlying=new Pa(Da).toDestination(),this.nameStr=t}loaded(){return!0}getVolume(){return 1}setVolume(t){}name(){return this.nameStr}play(t,e,n){e?this.underlying.triggerAttackRelease(t.string(),e/1e3):this.underlying.triggerAttack(t.string())}stop(t){this.underlying.triggerRelease([t.string()])}highest(){return $}lowest(){return B}}function La(t,e){return function(t,e,n,s,i){return s(!0),new ja(e)}(0,t,0,e)}export{Ot as C,ue as P,La as n,xo as s};
